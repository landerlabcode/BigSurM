(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 13.1' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[    236032,       5250]
NotebookOptionsPosition[    231677,       5180]
NotebookOutlinePosition[    232071,       5196]
CellTagsIndexPosition[    232028,       5193]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["BigSur Visualization ", "Chapter",
 CellChangeTimes->{{3.906417256974474*^9, 3.906417266706798*^9}, 
   3.906417300911553*^9},ExpressionUUID->"3db8fb27-6483-45ce-b776-\
4108798d1d96"],

Cell["\<\
Some of these functions call functions defined in the BigSur package\
\>", "Text",
 CellChangeTimes->{{3.906462372356339*^9, 
  3.906462385845313*^9}},ExpressionUUID->"8597c54a-d859-45eb-8fc6-\
6365814bcf39"],

Cell[CellGroupData[{

Cell["CollapseCommunitesRecursive", "Subsubsection",
 CellChangeTimes->{
  3.906417858291788*^9},ExpressionUUID->"8259914b-1619-4383-8239-\
58ce18800b79"],

Cell["\<\
Sometimes, the walktrap algorithm splits communities too finely, and we want \
to aggregate communities that are highly positively correlated with each \
other into a smaller number of communities.  

The inputs to this function are (1) a gno, (2) a set of communities (list of \
lists of gene names), (3) a correlation coefficient cutoff, and optionally \
(4) a cutoff by number of links that controls the sizes of communities that \
are considered worth merging.  \
\>", "Text",
 CellChangeTimes->{{3.90646306286794*^9, 3.906463106470316*^9}, {
  3.9064637028645363`*^9, 3.9064637818071547`*^9}, {3.906464205895976*^9, 
  3.9064642283936462`*^9}},ExpressionUUID->"61c0a899-33a8-49d4-984c-\
3bd5c96c6cd8"],

Cell["\<\
This code aggregates communites based on their positive correlations.   For \
any two communities, it calculates the number of possible correlations \
between members and then calculates what fraction are actually observed, \
using  a pccCutoff.  It lowers that fraction threshold until at least two \
communities of length>1 appear.  Then it replaces them with a joined \
community.  There is a a hard threshold of 1% for the fraction of possible \
links that needs to be shared.  \
\>", "Text",
 CellChangeTimes->{{3.885912486374506*^9, 3.885912609041461*^9}, {
  3.885912715765143*^9, 3.885912746966563*^9}, {3.9064639324831553`*^9, 
  3.9064639331149054`*^9}},ExpressionUUID->"d557a322-b90b-4996-89b4-\
c79b8e514d3b"],

Cell["\<\
1. First, we generate RatioLinks:  This is a symmetric matrix where each row \
and column refers to a community, and the entry is the net positive links \
divided by the total number of possible links between the two communities.  
2. Thresholding RatioLinks at some cutoff of PCC\[CloseCurlyQuote] strength \
gives us an Adjacency Graph from which we can find communities that can be \
collapsed into each other.  
3.  Each time we condense communities we have to recalculate RatioLinks.  
\tnote:  we can avoid having to get ratio links from scratch each time if we \
find a way to condense its rows and columns.  For example, if we consider \
communities 2 and 3, then the entry for the netlinks is just the sum of the \
netlinks.  However, the entry for the Maxlinks needs to be recalculated.  \
\>", "Text",
 CellChangeTimes->{{3.886029784770277*^9, 3.886029879565516*^9}, {
  3.886029909636326*^9, 3.88602996734482*^9}, {3.886030017883252*^9, 
  3.886030164534411*^9}, {3.886030203576634*^9, 3.8860302550964737`*^9}, {
  3.9064637846099033`*^9, 3.906463785674268*^9}, {3.9064638763372393`*^9, 
  3.906463897960593*^9}},ExpressionUUID->"b0646bd8-5341-4d97-9b91-\
f5f79e1ff602"],

Cell[TextData[{
 StyleBox["MaxLinks",
  FontWeight->"Bold"],
 " is a fast function that generates the list of the maximum possible links \
between communities; it returns a matrix"
}], "Text",
 CellChangeTimes->{{3.886074321737173*^9, 3.886074358176306*^9}, {
  3.906463985545608*^9, 
  3.906463986264627*^9}},ExpressionUUID->"b7c53e66-5489-48ba-87d6-\
22dab4f0af40"],

Cell[BoxData[
 RowBox[{"MaxlinksCF", "=", 
  RowBox[{"Compile", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"{", 
      RowBox[{"lengthlist", ",", " ", "_Real", ",", " ", "1"}], " ", "}"}], 
     "}"}], ",", 
    RowBox[{"Outer", "[", 
     RowBox[{"Times", ",", "lengthlist", ",", " ", "lengthlist"}], "]"}], ",",
     " ", 
    RowBox[{"RuntimeAttributes", "->", 
     RowBox[{"{", "Listable", "}"}]}], ",", " ", 
    RowBox[{"Parallelization", "->", "True"}]}], " ", "]"}]}]], "Input",
 CellChangeTimes->{{3.886032165645797*^9, 3.886032253199028*^9}, 
   3.886032292206238*^9},
 Background->RGBColor[1, 1, 0],
 CellLabel->
  "In[165]:=",ExpressionUUID->"e6b3d604-e802-477c-a5f0-c6b1606aa65d"],

Cell[TextData[{
 StyleBox["MergeEntries",
  FontWeight->"Bold"],
 " takes a matrix and a single list of positions.  It replaces the row \
corresponding to the first of those positions with the sum of the rows \
corresponding to all of those positions; then it replaces the column \
corresponding to the first of those positions with the sum of the columns \
corresponding to all of those positions.   ",
 StyleBox["DeleteEntries",
  FontWeight->"Bold"],
 " takes all of the positions, except the first, in a list of lists of \
positions, and deletes those rows and columns.  ",
 StyleBox["CollapseEntries",
  FontWeight->"Bold"],
 " is a function that repetitively applies Merge Entries, then finally \
applies DeleteEntries.  "
}], "Text",
 CellChangeTimes->{{3.886073665758439*^9, 3.886073776199445*^9}, {
  3.886074227461784*^9, 3.8860743068347187`*^9}, {3.8860743661039877`*^9, 
  3.886074368463312*^9}},ExpressionUUID->"f85bdcaa-3f73-44e6-9374-\
4e123cbc563f"],

Cell[BoxData[
 RowBox[{"MergeEntriesCF", "=", 
  RowBox[{"Compile", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"matrix", ",", "_Real", ",", " ", "2"}], "}"}], ",", " ", 
      RowBox[{"{", 
       RowBox[{"list", ",", " ", "_Integer", ",", " ", "1"}], "}"}]}], "}"}], 
    ",", "\[IndentingNewLine]", 
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"newmat", "=", 
        RowBox[{"Transpose", "[", 
         RowBox[{"ReplacePart", "[", 
          RowBox[{"matrix", ",", " ", 
           RowBox[{
            RowBox[{"list", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "->", " ", 
            RowBox[{"Total", "[", 
             RowBox[{"matrix", "[", 
              RowBox[{"[", "list", "]"}], "]"}], "]"}]}]}], "]"}], "]"}]}], 
       "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"Transpose", "[", 
       RowBox[{"ReplacePart", "[", 
        RowBox[{"newmat", ",", " ", 
         RowBox[{
          RowBox[{"list", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "->", " ", 
          RowBox[{"Total", "[", 
           RowBox[{"newmat", "[", 
            RowBox[{"[", "list", "]"}], "]"}], "]"}]}]}], "]"}], "]"}]}], 
     "]"}], ",", " ", 
    RowBox[{"RuntimeAttributes", "->", 
     RowBox[{"{", "Listable", "}"}]}], ",", " ", 
    RowBox[{"Parallelization", "->", "True"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.8860687652668133`*^9, 3.8860689222344933`*^9}, {
  3.886068986769053*^9, 3.886069003329612*^9}, {3.8860690376438913`*^9, 
  3.886069046244347*^9}, {3.88606914649822*^9, 3.886069149219657*^9}, {
  3.886069196192984*^9, 3.886069197110957*^9}, {3.886069553276107*^9, 
  3.886069593468289*^9}, {3.8860698783782597`*^9, 3.886069907651091*^9}},
 Background->RGBColor[1, 1, 0],
 CellLabel->
  "In[166]:=",ExpressionUUID->"2c019a5a-86fb-45dc-ac5b-ec1a728bf5c0"],

Cell[BoxData[
 RowBox[{
  RowBox[{"DeleteEntries", "[", 
   RowBox[{"matrix_", ",", " ", "lists_"}], "]"}], ":=", 
  "\[IndentingNewLine]", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"newmat", "=", 
      RowBox[{"Transpose", "[", 
       RowBox[{"Delete", "[", 
        RowBox[{"matrix", ",", 
         RowBox[{"List", "/@", 
          RowBox[{"Flatten", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Drop", "[", 
              RowBox[{"#", ",", "1"}], "]"}], "&"}], "/@", "lists"}], 
           "]"}]}]}], "]"}], "]"}]}], "}"}], ",", " ", "\[IndentingNewLine]", 
    
    RowBox[{"Transpose", "[", 
     RowBox[{"Delete", "[", 
      RowBox[{"newmat", ",", " ", 
       RowBox[{"List", "/@", 
        RowBox[{"Flatten", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Drop", "[", 
            RowBox[{"#", ",", "1"}], "]"}], "&"}], "/@", "lists"}], "]"}]}]}],
       "]"}], "]"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.886069976889761*^9, 3.8860701586576*^9}, {
  3.886070195576104*^9, 3.8860701960434027`*^9}},
 Background->RGBColor[1, 1, 0],
 CellLabel->
  "In[167]:=",ExpressionUUID->"df8a50c7-64b9-48fd-a16b-5b7fbc6c7f29"],

Cell[BoxData[
 RowBox[{
  RowBox[{"CollapseEntries", "[", 
   RowBox[{"matrix_", ",", " ", "lists_"}], "]"}], ":=", " ", 
  RowBox[{"DeleteEntries", "[", 
   RowBox[{
    RowBox[{"Fold", "[", 
     RowBox[{"MergeEntriesCF", ",", " ", "matrix", ",", "lists"}], "]"}], ",",
     " ", "lists"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.88607062754468*^9, 3.886070653018407*^9}, {
  3.886070921766657*^9, 3.8860709225793247`*^9}},
 Background->RGBColor[1, 1, 0],
 CellLabel->
  "In[168]:=",ExpressionUUID->"1b1752e8-e497-4618-b9fb-a41b74338f14"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MergeComs", "[", 
   RowBox[{"comslist_", ",", " ", "list_"}], "]"}], ":=", " ", 
  "\[IndentingNewLine]", 
  RowBox[{"ReplacePart", "[", 
   RowBox[{"comslist", ",", " ", 
    RowBox[{
     RowBox[{"list", "[", 
      RowBox[{"[", "1", "]"}], "]"}], "->", " ", 
     RowBox[{"Flatten", "[", 
      RowBox[{"comslist", "[", 
       RowBox[{"[", "list", "]"}], "]"}], "]"}]}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.88615138347405*^9, 3.886151458160697*^9}, {
  3.8861515391049547`*^9, 3.886151582009303*^9}},
 Background->RGBColor[1, 1, 0],
 CellLabel->
  "In[169]:=",ExpressionUUID->"4112b786-e39a-46cd-806c-659898b40afd"],

Cell[BoxData[
 RowBox[{
  RowBox[{"DeleteComs", "[", 
   RowBox[{"comslist_", ",", " ", "output_"}], "]"}], ":=", 
  "\[IndentingNewLine]", 
  RowBox[{"Delete", "[", 
   RowBox[{"comslist", ",", " ", 
    RowBox[{"List", "/@", 
     RowBox[{"Flatten", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Drop", "[", 
         RowBox[{"#", ",", "1"}], "]"}], "&"}], "/@", "output"}], " ", 
      "]"}]}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.886151617952943*^9, 3.886151666217066*^9}},
 Background->RGBColor[1, 1, 0],
 CellLabel->
  "In[170]:=",ExpressionUUID->"faf673a4-376d-4c50-ad3a-e8da33c8959c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"CollapseComs", "[", 
   RowBox[{"comlist_", ",", " ", "output_"}], "]"}], ":=", 
  "\[IndentingNewLine]", 
  RowBox[{"DeleteComs", "[", 
   RowBox[{
    RowBox[{"Fold", "[", 
     RowBox[{"MergeComs", ",", " ", "comlist", ",", " ", "output"}], "]"}], 
    ",", " ", "output"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.886151677166814*^9, 3.886151713425022*^9}},
 Background->RGBColor[1, 1, 0],
 CellLabel->
  "In[171]:=",ExpressionUUID->"8ffc0d73-4d93-4d64-8ae2-2c8819d3e59f"],

Cell["\<\
In the recursive function, we first calculate posns; this is a representation \
of each community in terms of the position indices within gNO[[2]].  Thus \
posns is a list of lists, each representing a community.  
posmat and negmat are the positive and negative entry versions of the \
correlations between all genes.  
netlinks calculates the net number of links between all the genes in any pair \
of communities, returning the result as a strictly lower-triangularized \
sparse matrix, where every position represents a community.  
ratiomat scales netlinks by the maximum number of possible links, which is a \
function of the sizes of the communities.  
j starts at a starting position corresponding to the 99th percentile of the \
ratiomat, i.e. the threshold where only 1% of communities have a higher \
ratio.   
That is then used as a threshold to find what happens when we build a graph \
out of the ratiomat, connecting communities that have more than a certain \
level of connection.  j keeps getting reduced until we find at least 1 \
grouping of communities of length>1; then we break out of the For loop and \
retrieve an output consisting of just those groups of communities that have \
length>1.  These are the communities that we need to consolidate into each \
other.  \
\>", "Text",
 CellChangeTimes->{{3.8860743861196527`*^9, 3.886074406878079*^9}, {
   3.886074490094784*^9, 3.8860745425243807`*^9}, {3.886074714441402*^9, 
   3.886074923022163*^9}, {3.886074957664926*^9, 3.886075184413413*^9}, {
   3.886075228420623*^9, 3.886075228743123*^9}, {3.88607531966125*^9, 
   3.886075359208229*^9}, {3.8860754040989103`*^9, 3.8860754202428513`*^9}, 
   3.906464029804784*^9, {3.906464076422674*^9, 3.906464077886389*^9}, {
   3.9064641182667427`*^9, 
   3.906464138466918*^9}},ExpressionUUID->"7f3173cc-b36f-4f6f-a9ed-\
021b6005752d"],

Cell[BoxData[
 RowBox[{
  RowBox[{"CollapseCommunitesRecursive", "[", 
   RowBox[{"gNO_", ",", " ", "communities_", ",", " ", "pccCutoff_"}], "]"}], 
  ":=", "\[IndentingNewLine]", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"len", "=", 
       RowBox[{"Length", "[", "communities", "]"}]}], ",", "coms", ",", 
      "posns", ",", "posmat", ",", "negmat", ",", 
      RowBox[{"mat", "=", 
       RowBox[{"RestoreSymmetryExceptDiagonal", "[", 
        RowBox[{"gNO", "[", 
         RowBox[{"[", "3", "]"}], "]"}], "]"}]}], ",", " ", "maxlinks", ",", 
      " ", "netlinks", ",", "ratiomat", ",", " ", "i", ",", "j", ",", " ", 
      "result", ",", " ", "output", ",", " ", "temp"}], "}"}], ",", " ", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"coms", "=", "communities"}], ";", "\[IndentingNewLine]", 
     RowBox[{"posns", "=", 
      RowBox[{"Flatten", "/@", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Flatten", "@", 
           RowBox[{"Position", "[", 
            RowBox[{
             RowBox[{"gNO", "[", 
              RowBox[{"[", "2", "]"}], "]"}], ",", " ", "#"}], "]"}]}], "&"}],
          ",", "coms", ",", 
         RowBox[{"{", "2", "}"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"posmat", "=", 
      RowBox[{"SparseArray", "[", 
       RowBox[{"BoolEval", "[", 
        RowBox[{"mat", ">", "pccCutoff"}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"negmat", " ", "=", " ", 
      RowBox[{"SparseArray", "[", 
       RowBox[{"BoolEval", "[", 
        RowBox[{"mat", "<", 
         RowBox[{"-", "pccCutoff"}]}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"maxlinks", " ", "=", 
      RowBox[{"MaxlinksCF", "[", 
       RowBox[{"Length", "/@", "coms"}], "]"}]}], ";", 
     RowBox[{"netlinks", " ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"PadRight", "[", 
         RowBox[{"#", ",", " ", "len"}], "]"}], "&"}], "/@", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"posmat", "[", 
            RowBox[{"[", 
             RowBox[{
              RowBox[{"posns", "[", 
               RowBox[{"[", "i", "]"}], "]"}], ",", 
              RowBox[{"posns", "[", 
               RowBox[{"[", "j", "]"}], "]"}]}], "]"}], "]"}], "[", 
           "\"\<ExplicitLength\>\"", "]"}], "-", 
          RowBox[{
           RowBox[{"negmat", "[", 
            RowBox[{"[", 
             RowBox[{
              RowBox[{"posns", "[", 
               RowBox[{"[", "i", "]"}], "]"}], ",", 
              RowBox[{"posns", "[", 
               RowBox[{"[", "j", "]"}], "]"}]}], "]"}], "]"}], "[", 
           "\"\<ExplicitLength\>\"", "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "len"}], "}"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"j", ",", 
           RowBox[{"i", "-", "1"}]}], "}"}]}], "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"ratiomat", "=", 
      RowBox[{"SparseArray", "[", 
       RowBox[{"netlinks", "/", "maxlinks"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"temp", "=", 
      RowBox[{
      "PrintTemporary", "[", "\"\<ratiomatrix calculated\>\"", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"j", "=", 
      RowBox[{"Quantile", "[", 
       RowBox[{
        RowBox[{"ratiomat", "[", "\"\<ExplicitValues\>\"", "]"}], ",", 
        "0.99"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Print", "[", 
      RowBox[{"\"\<initial j = \>\"", ",", " ", "j"}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"While", "[", 
      RowBox[{
       RowBox[{"j", ">", "0.01"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{"i", "=", "j"}], ",", 
          RowBox[{"i", ">", "0"}], ",", 
          RowBox[{"i", "=", 
           RowBox[{"i", "-", "0.01"}]}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"result", "=", 
            RowBox[{"FindGraphCommunities", "[", 
             RowBox[{"UndirectedGraph", "[", 
              RowBox[{"AdjacencyGraph", "[", 
               RowBox[{"BoolEval", "[", 
                RowBox[{"ratiomat", ">", "i"}], "]"}], "]"}], "]"}], "]"}]}], 
           ";", "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Max", "[", 
               RowBox[{"Length", "/@", "result"}], "]"}], ">", "1"}], ",", 
             RowBox[{
              RowBox[{"j", "=", 
               RowBox[{"i", "-", "0.01"}]}], ";", " ", 
              RowBox[{"Break", "[", "]"}]}]}], "]"}]}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"output", "=", 
         RowBox[{"Select", "[", 
          RowBox[{"result", ",", " ", 
           RowBox[{
            RowBox[{
             RowBox[{"Length", "[", "#", "]"}], ">", "1"}], "&"}]}], "]"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"coms", " ", "=", 
         RowBox[{"CollapseComs", "[", 
          RowBox[{"coms", ",", " ", "output"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"NotebookDelete", "[", "temp", "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"temp", "=", 
         RowBox[{"PrintTemporary", "[", 
          RowBox[{"\"\<j = \>\"", ",", "j", ",", " ", "\"\<; \>\"", ",", 
           RowBox[{"Length", "[", "coms", "]"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"maxlinks", "=", " ", 
         RowBox[{"MaxlinksCF", "[", 
          RowBox[{"Length", "/@", "coms"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"netlinks", " ", "=", " ", 
         RowBox[{"CollapseEntries", "[", 
          RowBox[{"netlinks", ",", "output"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"ratiomat", " ", "=", " ", 
         RowBox[{"SparseArray", "[", 
          RowBox[{"netlinks", "/", "maxlinks"}], "]"}]}]}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Sort", "/@", 
      RowBox[{"ReverseSortBy", "[", 
       RowBox[{"coms", ",", " ", "Length"}], "]"}]}]}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.886036423726873*^9, 3.886036541035658*^9}, {
   3.886036579698244*^9, 3.88603659385023*^9}, {3.886036705492976*^9, 
   3.886036708256319*^9}, {3.886036900587022*^9, 3.886036938343934*^9}, {
   3.886036968849451*^9, 3.8860370193065443`*^9}, {3.886037059582062*^9, 
   3.88603708725858*^9}, {3.8860371177080584`*^9, 3.886037136818817*^9}, {
   3.886037188900525*^9, 3.88603719264132*^9}, {3.8860372233224993`*^9, 
   3.8860372260478067`*^9}, {3.88603725807724*^9, 3.886037305918826*^9}, {
   3.886037450057886*^9, 3.8860374545005827`*^9}, {3.886037488174408*^9, 
   3.886037511720305*^9}, {3.8860375851425743`*^9, 3.886037629651514*^9}, {
   3.886037661293453*^9, 3.886037664248818*^9}, {3.886037765110469*^9, 
   3.8860377843576727`*^9}, {3.886066922025301*^9, 3.886066937637033*^9}, {
   3.886067043739625*^9, 3.886067092038314*^9}, {3.88606713743718*^9, 
   3.8860671403707952`*^9}, {3.886067217395961*^9, 3.886067222064741*^9}, {
   3.8860673110057383`*^9, 3.886067342576366*^9}, {3.886067425199732*^9, 
   3.886067459770376*^9}, {3.886067497080556*^9, 3.8860675031087112`*^9}, {
   3.886067546191141*^9, 3.886067549694929*^9}, 3.886068119401215*^9, {
   3.8860681861939583`*^9, 3.8860682029038343`*^9}, {3.886068289340969*^9, 
   3.8860683103697863`*^9}, 3.886068647439487*^9, 3.886068688567231*^9, {
   3.886070770697967*^9, 3.8860708150855293`*^9}, {3.886070956607457*^9, 
   3.88607110481175*^9}, {3.886071164866424*^9, 3.88607121385376*^9}, {
   3.886071305610675*^9, 3.8860713226734324`*^9}, {3.886071422255925*^9, 
   3.886071436765999*^9}, 3.8860715475934*^9, {3.886071735670977*^9, 
   3.886071821323166*^9}, 3.886071865074211*^9, {3.8860719336987743`*^9, 
   3.8860720004028797`*^9}, {3.886072030755418*^9, 3.886072032451692*^9}, {
   3.8860721261705427`*^9, 3.886072170949148*^9}, {3.886072223413433*^9, 
   3.8860722325934267`*^9}, {3.8861176637341423`*^9, 3.886117686232562*^9}, {
   3.8861179870685787`*^9, 3.8861180093740063`*^9}, {3.886118039472682*^9, 
   3.886118041994255*^9}, {3.886118653283696*^9, 3.886118657078685*^9}, {
   3.886151781812993*^9, 3.886151784744112*^9}, {3.886152067247677*^9, 
   3.8861520686182413`*^9}},
 Background->RGBColor[1, 1, 0],
 CellLabel->
  "In[172]:=",ExpressionUUID->"e37c3025-4ef0-45de-bb1e-a548db2eca4b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"CollapseCommunitesRecursive", "[", 
   RowBox[{
   "gNO_", ",", " ", "communities_", ",", " ", "pccCutoff_", ",", " ", 
    "linkcutoff_"}], "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"len", "=", 
       RowBox[{"Length", "[", "communities", "]"}]}], ",", "coms", ",", 
      "posns", ",", "posmat", ",", "negmat", ",", 
      RowBox[{"mat", "=", 
       RowBox[{"RestoreSymmetryExceptDiagonal", "[", 
        RowBox[{"gNO", "[", 
         RowBox[{"[", "3", "]"}], "]"}], "]"}]}], ",", " ", "maxlinks", ",", 
      " ", "netlinks", ",", "ratiomat", ",", " ", "i", ",", "j", ",", " ", 
      "result", ",", " ", "output", ",", " ", "temp"}], "}"}], ",", " ", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"coms", "=", "communities"}], ";", "\[IndentingNewLine]", 
     RowBox[{"posns", "=", 
      RowBox[{"Flatten", "/@", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Flatten", "@", 
           RowBox[{"Position", "[", 
            RowBox[{
             RowBox[{"gNO", "[", 
              RowBox[{"[", "2", "]"}], "]"}], ",", " ", "#"}], "]"}]}], "&"}],
          ",", "coms", ",", 
         RowBox[{"{", "2", "}"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"posmat", "=", 
      RowBox[{"SparseArray", "[", 
       RowBox[{"BoolEval", "[", 
        RowBox[{"mat", ">", "pccCutoff"}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"negmat", " ", "=", " ", 
      RowBox[{"SparseArray", "[", 
       RowBox[{"BoolEval", "[", 
        RowBox[{"mat", "<", 
         RowBox[{"-", "pccCutoff"}]}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"maxlinks", " ", "=", 
      RowBox[{"MaxlinksCF", "[", 
       RowBox[{"Length", "/@", "coms"}], "]"}]}], ";", 
     RowBox[{"netlinks", " ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"PadRight", "[", 
         RowBox[{"#", ",", " ", "len"}], "]"}], "&"}], "/@", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"posmat", "[", 
            RowBox[{"[", 
             RowBox[{
              RowBox[{"posns", "[", 
               RowBox[{"[", "i", "]"}], "]"}], ",", 
              RowBox[{"posns", "[", 
               RowBox[{"[", "j", "]"}], "]"}]}], "]"}], "]"}], "[", 
           "\"\<ExplicitLength\>\"", "]"}], "-", 
          RowBox[{
           RowBox[{"negmat", "[", 
            RowBox[{"[", 
             RowBox[{
              RowBox[{"posns", "[", 
               RowBox[{"[", "i", "]"}], "]"}], ",", 
              RowBox[{"posns", "[", 
               RowBox[{"[", "j", "]"}], "]"}]}], "]"}], "]"}], "[", 
           "\"\<ExplicitLength\>\"", "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "len"}], "}"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"j", ",", 
           RowBox[{"i", "-", "1"}]}], "}"}]}], "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"ratiomat", "=", 
      RowBox[{"SparseArray", "[", 
       RowBox[{"netlinks", "/", "maxlinks"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"temp", "=", 
      RowBox[{
      "PrintTemporary", "[", "\"\<ratiomatrix calculated\>\"", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"j", "=", 
      RowBox[{"Quantile", "[", 
       RowBox[{
        RowBox[{"ratiomat", "[", "\"\<ExplicitValues\>\"", "]"}], ",", 
        "0.99"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Print", "[", 
      RowBox[{"\"\<initial j = \>\"", ",", " ", "j"}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"While", "[", 
      RowBox[{
       RowBox[{"j", ">", "linkcutoff"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{"i", "=", "j"}], ",", 
          RowBox[{"i", ">", "0"}], ",", 
          RowBox[{"i", "=", 
           RowBox[{"i", "-", "0.01"}]}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"result", "=", 
            RowBox[{"FindGraphCommunities", "[", 
             RowBox[{"UndirectedGraph", "[", 
              RowBox[{"AdjacencyGraph", "[", 
               RowBox[{"BoolEval", "[", 
                RowBox[{"ratiomat", ">", "i"}], "]"}], "]"}], "]"}], "]"}]}], 
           ";", "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Max", "[", 
               RowBox[{"Length", "/@", "result"}], "]"}], ">", "1"}], ",", 
             RowBox[{
              RowBox[{"j", "=", 
               RowBox[{"i", "-", "0.01"}]}], ";", " ", 
              RowBox[{"Break", "[", "]"}]}]}], "]"}]}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"output", "=", 
         RowBox[{"Select", "[", 
          RowBox[{"result", ",", " ", 
           RowBox[{
            RowBox[{
             RowBox[{"Length", "[", "#", "]"}], ">", "1"}], "&"}]}], "]"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"coms", " ", "=", 
         RowBox[{"CollapseComs", "[", 
          RowBox[{"coms", ",", " ", "output"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"NotebookDelete", "[", "temp", "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"temp", "=", 
         RowBox[{"PrintTemporary", "[", 
          RowBox[{"\"\<j = \>\"", ",", "j", ",", " ", "\"\<; \>\"", ",", 
           RowBox[{"Length", "[", "coms", "]"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"maxlinks", "=", " ", 
         RowBox[{"MaxlinksCF", "[", 
          RowBox[{"Length", "/@", "coms"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"netlinks", " ", "=", " ", 
         RowBox[{"CollapseEntries", "[", 
          RowBox[{"netlinks", ",", "output"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"ratiomat", " ", "=", " ", 
         RowBox[{"SparseArray", "[", 
          RowBox[{"netlinks", "/", "maxlinks"}], "]"}]}]}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Sort", "/@", 
      RowBox[{"ReverseSortBy", "[", 
       RowBox[{"coms", ",", " ", "Length"}], "]"}]}]}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.886036423726873*^9, 3.886036541035658*^9}, {
   3.886036579698244*^9, 3.88603659385023*^9}, {3.886036705492976*^9, 
   3.886036708256319*^9}, {3.886036900587022*^9, 3.886036938343934*^9}, {
   3.886036968849451*^9, 3.8860370193065443`*^9}, {3.886037059582062*^9, 
   3.88603708725858*^9}, {3.8860371177080584`*^9, 3.886037136818817*^9}, {
   3.886037188900525*^9, 3.88603719264132*^9}, {3.8860372233224993`*^9, 
   3.8860372260478067`*^9}, {3.88603725807724*^9, 3.886037305918826*^9}, {
   3.886037450057886*^9, 3.8860374545005827`*^9}, {3.886037488174408*^9, 
   3.886037511720305*^9}, {3.8860375851425743`*^9, 3.886037629651514*^9}, {
   3.886037661293453*^9, 3.886037664248818*^9}, {3.886037765110469*^9, 
   3.8860377843576727`*^9}, {3.886066922025301*^9, 3.886066937637033*^9}, {
   3.886067043739625*^9, 3.886067092038314*^9}, {3.88606713743718*^9, 
   3.8860671403707952`*^9}, {3.886067217395961*^9, 3.886067222064741*^9}, {
   3.8860673110057383`*^9, 3.886067342576366*^9}, {3.886067425199732*^9, 
   3.886067459770376*^9}, {3.886067497080556*^9, 3.8860675031087112`*^9}, {
   3.886067546191141*^9, 3.886067549694929*^9}, 3.886068119401215*^9, {
   3.8860681861939583`*^9, 3.8860682029038343`*^9}, {3.886068289340969*^9, 
   3.8860683103697863`*^9}, 3.886068647439487*^9, 3.886068688567231*^9, {
   3.886070770697967*^9, 3.8860708150855293`*^9}, {3.886070956607457*^9, 
   3.88607110481175*^9}, {3.886071164866424*^9, 3.88607121385376*^9}, {
   3.886071305610675*^9, 3.8860713226734324`*^9}, {3.886071422255925*^9, 
   3.886071436765999*^9}, 3.8860715475934*^9, {3.886071735670977*^9, 
   3.886071821323166*^9}, 3.886071865074211*^9, {3.8860719336987743`*^9, 
   3.8860720004028797`*^9}, {3.886072030755418*^9, 3.886072032451692*^9}, {
   3.8860721261705427`*^9, 3.886072170949148*^9}, {3.886072223413433*^9, 
   3.8860722325934267`*^9}, {3.8861176637341423`*^9, 3.886117686232562*^9}, {
   3.8861179870685787`*^9, 3.8861180093740063`*^9}, {3.886118039472682*^9, 
   3.886118041994255*^9}, {3.886118653283696*^9, 3.886118691689547*^9}, 
   3.886151790247015*^9, 3.886152074006917*^9},
 Background->RGBColor[1, 1, 0],
 CellLabel->
  "In[173]:=",ExpressionUUID->"0d4eef79-aa67-4ef2-a4bd-a20b6a102801"]
}, Closed]],

Cell[CellGroupData[{

Cell["InterCommunityCorrelations2", "Subsubsection",
 CellChangeTimes->{{3.884598347473834*^9, 
  3.88459835384501*^9}},ExpressionUUID->"8ab7d9f5-ac1e-4ee7-ba79-\
7967dcd65e28"],

Cell[TextData[{
 "This measures inter community correlations, counting numbers of links \
(rather than strength of links) and separating out negative and positive \
correlations.  A square table is generated where the labels of the rows and \
columns are the communities, and the entries give a graphical representation \
of intercommunity correlation.  \nSpecifically, the areas of the circles \
indicate how many possible correlations there can be between any two \
communities.  The area is scaled to the grid box dimensions, so that the \
community pair with the most possible correlations has a disk that fills the \
whole box. \nThe depth of color of the circles indicate what ",
 StyleBox["fraction",
  FontSlant->"Italic"],
 " of the possible correlations are observed in the data;  Green = positive \
correlations; Red = negative correlations.  \nThe default colors are \
arbitrary.\nThe second version of the function allows one to specify exactly \
which communities one wants to look at, keeping the labeling correct.  that \
can be provided in the form of a consecutive list {3,4,5, ...}  or a span \
3;;8 as an optional third argument.\n\nThe explicit options \
\[OpenCurlyDoubleQuote]MaxPosFraction\[CloseCurlyDoubleQuote] and  \
\[OpenCurlyDoubleQuote]MaxNegFraction\[CloseCurlyDoubleQuote] allow one to \
control the color strength associated with observing different proportions of \
positive and negative links.  "
}], "Text",
 CellChangeTimes->{{3.884598357304159*^9, 3.884598383610422*^9}, {
  3.8845985253514423`*^9, 3.884598536459476*^9}, {3.884606524072233*^9, 
  3.8846065898363447`*^9}, {3.8846066305223503`*^9, 3.8846066895431957`*^9}, {
  3.884608095305744*^9, 3.8846081706309233`*^9}, {3.88460929557623*^9, 
  3.884609298316918*^9}, {3.884611202007823*^9, 3.884611213819805*^9}, {
  3.9064642497139883`*^9, 3.906464323918079*^9}, {3.906464371181892*^9, 
  3.906464464282527*^9}},ExpressionUUID->"e4b91d1a-40b4-43f3-beb0-\
47b8f68bb2cf"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "InterCommunityCorrelations2", "]"}], " ", "=", 
    "  ", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"\"\<MaxPosFraction\>\"", "->", "0.02"}], ",", " ", 
      RowBox[{"\"\<MaxNegFraction\>\"", "->", " ", "0.02"}]}], "}"}]}], ";"}],
   "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"InterCommunityCorrelations2", "[", " ", 
     RowBox[{"gNO_", ",", "communities_", ",", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
    "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"len", "=", 
         RowBox[{"Length", "[", "communities", "]"}]}], ",", "posns", ",", 
        RowBox[{"mat", "=", 
         RowBox[{"RestoreSymmetryExceptDiagonal", "[", 
          RowBox[{"gNO", "[", 
           RowBox[{"[", "3", "]"}], "]"}], "]"}]}], ",", " ", "posmat", ",", 
        " ", "negmat", ",", " ", "maxlengths", ",", " ", "poslengths", ",", 
        " ", "neglengths", ",", " ", "backgroundstyle"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"posns", "=", 
        RowBox[{"Flatten", "/@", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Flatten", "@", 
             RowBox[{"Position", "[", 
              RowBox[{
               RowBox[{"gNO", "[", 
                RowBox[{"[", "2", "]"}], "]"}], ",", " ", "#"}], "]"}]}], 
            "&"}], ",", "communities", ",", 
           RowBox[{"{", "2", "}"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"posmat", "=", 
        RowBox[{"SparseArray", "[", 
         RowBox[{"BoolEval", "[", 
          RowBox[{"mat", ">", "0"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"negmat", " ", "=", " ", 
        RowBox[{"SparseArray", "[", 
         RowBox[{"BoolEval", "[", 
          RowBox[{"mat", "<", "0"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"maxlengths", " ", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"i", "==", "j"}], ",", " ", 
            RowBox[{"Binomial", "[", 
             RowBox[{
              RowBox[{"Length", "[", 
               RowBox[{"communities", "[", 
                RowBox[{"[", "i", "]"}], "]"}], "]"}], ",", "2"}], "]"}], ",", 
            RowBox[{
             RowBox[{"Length", "[", 
              RowBox[{"communities", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "]"}], "*", " ", 
             RowBox[{"Length", "[", 
              RowBox[{"communities", "[", 
               RowBox[{"[", "j", "]"}], "]"}], "]"}]}]}], " ", "]"}], " ", 
          ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "len"}], "}"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{"j", ",", "len"}], "}"}]}], "]"}]}], " ", ";", 
       "\[IndentingNewLine]", 
       RowBox[{"poslengths", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"posmat", "[", 
            RowBox[{"[", 
             RowBox[{
              RowBox[{"posns", "[", 
               RowBox[{"[", "i", "]"}], "]"}], ",", 
              RowBox[{"posns", "[", 
               RowBox[{"[", "j", "]"}], "]"}]}], "]"}], "]"}], "[", 
           "\"\<ExplicitLength\>\"", "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "len"}], "}"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{"j", ",", "len"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"neglengths", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"negmat", "[", 
            RowBox[{"[", 
             RowBox[{
              RowBox[{"posns", "[", 
               RowBox[{"[", "i", "]"}], "]"}], ",", 
              RowBox[{"posns", "[", 
               RowBox[{"[", "j", "]"}], "]"}]}], "]"}], "]"}], "[", 
           "\"\<ExplicitLength\>\"", "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "len"}], "}"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{"j", ",", "len"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"backgroundstyle", "=", 
        RowBox[{"Lighter", "[", 
         RowBox[{"Gray", ",", "0.97"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Grid", "[", 
        RowBox[{"{", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Grid", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"MapThread", "[", 
              RowBox[{"Join", ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"Append", "[", 
                  RowBox[{
                   RowBox[{"Table", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"Style", "[", 
                    RowBox[{"i", ",", " ", 
                    RowBox[{"FontFamily", "->", "\"\<Arial\>\""}]}], "]"}], 
                    "}"}], ",", " ", 
                    RowBox[{"{", 
                    RowBox[{"i", ",", " ", "len"}], "}"}]}], "]"}], ",", 
                   RowBox[{"{", "Null", "}"}]}], "]"}], ",", 
                 "\[IndentingNewLine]", 
                 RowBox[{"Join", "[", 
                  RowBox[{
                   RowBox[{"Table", "[", 
                    RowBox[{
                    RowBox[{"Graphics", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"Green", ",", " ", 
                    RowBox[{"Opacity", "[", 
                    RowBox[{
                    FractionBox["1", 
                    RowBox[{
                    "OptionValue", "[", "\"\<MaxPosFraction\>\"", "]"}]], 
                    FractionBox[
                    RowBox[{"poslengths", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "j"}], "]"}], "]"}], 
                    RowBox[{"maxlengths", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "j"}], "]"}], "]"}]]}], "]"}], ",", 
                    RowBox[{"Disk", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"0", ",", "0"}], "}"}], ",", 
                    RowBox[{"Scaled", "[", 
                    SqrtBox[
                    FractionBox[
                    RowBox[{"maxlengths", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "j"}], "]"}], "]"}], 
                    RowBox[{"Max", "[", 
                    RowBox[{"Flatten", "[", "maxlengths", "]"}], "]"}]]], 
                    "]"}]}], "]"}]}], "}"}], ",", " ", 
                    RowBox[{"ImageSize", "->", " ", "30"}]}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"i", ",", "len"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"j", ",", " ", "1", ",", "i"}], "}"}]}], "]"}], 
                   ",", 
                   RowBox[{"{", 
                    RowBox[{"Table", "[", 
                    RowBox[{
                    RowBox[{"Style", "[", 
                    RowBox[{"i", ",", " ", 
                    RowBox[{"FontFamily", "->", "\"\<Arial\>\""}]}], "]"}], 
                    ",", " ", 
                    RowBox[{"{", 
                    RowBox[{"i", ",", "len"}], "}"}]}], "]"}], "}"}]}], 
                  "]"}]}], "}"}]}], "]"}], ",", "  ", 
             RowBox[{"Background", "->", " ", "backgroundstyle"}], ",", 
             RowBox[{"Dividers", "->", " ", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"Join", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"2", "->", " ", "Gray"}], "}"}], ",", 
                  RowBox[{"Table", "[", 
                   RowBox[{
                    RowBox[{"i", "->", " ", "White"}], ",", " ", 
                    RowBox[{"{", 
                    RowBox[{"i", ",", " ", "3", ",", " ", 
                    RowBox[{"len", "+", "1"}]}], "}"}]}], "]"}]}], "]"}], ",", 
                RowBox[{"Join", "[", 
                 RowBox[{
                  RowBox[{"Table", "[", 
                   RowBox[{
                    RowBox[{"i", "->", " ", "White"}], ",", " ", 
                    RowBox[{"{", 
                    RowBox[{"i", ",", " ", "2", ",", " ", "len"}], "}"}]}], 
                   "]"}], ",", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"-", "2"}], "->", " ", "Gray"}], "}"}]}], " ", 
                 "]"}]}], "}"}]}]}], "]"}], ",", "\[IndentingNewLine]", 
           RowBox[{"Grid", "[", 
            RowBox[{
             RowBox[{"Join", "[", 
              RowBox[{
               RowBox[{"Table", "[", 
                RowBox[{
                 RowBox[{"Graphics", "[", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{"Red", ",", " ", 
                    RowBox[{"Opacity", "[", 
                    RowBox[{
                    FractionBox["1", 
                    RowBox[{
                    "OptionValue", "[", "\"\<MaxNegFraction\>\"", "]"}]], 
                    FractionBox[
                    RowBox[{"neglengths", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "j"}], "]"}], "]"}], 
                    RowBox[{"maxlengths", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "j"}], "]"}], "]"}]]}], "]"}], ",", 
                    RowBox[{"Disk", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"0", ",", "0"}], "}"}], ",", 
                    RowBox[{"Scaled", "[", 
                    SqrtBox[
                    FractionBox[
                    RowBox[{"maxlengths", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "j"}], "]"}], "]"}], 
                    RowBox[{"Max", "[", 
                    RowBox[{"Flatten", "[", "maxlengths", "]"}], "]"}]]], 
                    "]"}]}], "]"}]}], "}"}], ",", " ", 
                   RowBox[{"ImageSize", "->", " ", "30"}]}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"i", ",", "len"}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"j", ",", " ", "1", ",", "i"}], "}"}]}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"Table", "[", 
                 RowBox[{
                  RowBox[{"Style", "[", 
                   RowBox[{"i", ",", " ", 
                    RowBox[{"FontFamily", "->", "\"\<Arial\>\""}]}], "]"}], 
                  ",", " ", 
                  RowBox[{"{", 
                   RowBox[{"i", ",", "len"}], "}"}]}], "]"}], "}"}]}], "]"}], 
             ",", " ", 
             RowBox[{"Background", "->", " ", "backgroundstyle"}], ",", " ", 
             RowBox[{"Dividers", "->", " ", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"Join", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"1", "->", " ", "Gray"}], "}"}], ",", 
                  RowBox[{"Table", "[", 
                   RowBox[{
                    RowBox[{"i", "->", " ", "White"}], ",", " ", 
                    RowBox[{"{", 
                    RowBox[{"i", ",", " ", "2", ",", " ", 
                    RowBox[{"len", "+", "1"}]}], "}"}]}], "]"}]}], "]"}], ",", 
                RowBox[{"Join", "[", 
                 RowBox[{
                  RowBox[{"Table", "[", 
                   RowBox[{
                    RowBox[{"i", "->", " ", "White"}], ",", " ", 
                    RowBox[{"{", 
                    RowBox[{"i", ",", " ", "2", ",", " ", "len"}], "}"}]}], 
                   "]"}], ",", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"-", "2"}], "->", " ", "Gray"}], "}"}]}], " ", 
                 "]"}]}], "}"}]}]}], "]"}], ",", "\[IndentingNewLine]", 
           RowBox[{"Grid", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"\"\<Observed\>\"", ",", "\"\<Fraction\>\""}], "}"}], 
               ",", 
               RowBox[{"{", 
                RowBox[{"Green", ",", " ", 
                 RowBox[{"\"\<=\>\"", "<>", 
                  RowBox[{"ToString", "[", 
                   RowBox[{
                   "OptionValue", "[", "\"\<MaxPosFraction\>\"", "]"}], 
                   "]"}]}]}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"Red", ",", " ", 
                 RowBox[{"\"\<=\>\"", "<>", 
                  RowBox[{"ToString", "[", " ", 
                   RowBox[{
                   "OptionValue", "[", "\"\<MaxNegFraction\>\"", "]"}], 
                   "]"}]}]}], "}"}]}], "}"}], ",", " ", 
             RowBox[{"Alignment", "->", " ", "Right"}]}], "]"}]}], "}"}], 
         "}"}], "]"}]}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"InterCommunityCorrelations2", "[", " ", 
    RowBox[{"gNO_", ",", "communities_", ",", "span_", ",", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"newcoms", "=", " ", 
        RowBox[{"communities", "[", 
         RowBox[{"[", "span", "]"}], "]"}]}], ",", "len", ",", "listspan", 
       ",", " ", "posns", ",", 
       RowBox[{"mat", "=", 
        RowBox[{"RestoreSymmetryExceptDiagonal", "[", 
         RowBox[{"gNO", "[", 
          RowBox[{"[", "3", "]"}], "]"}], "]"}]}], ",", " ", "posmat", ",", 
       " ", "negmat", ",", " ", "maxlengths", ",", " ", "poslengths", ",", 
       " ", "neglengths", ",", " ", "backgroundstyle"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"len", "=", 
       RowBox[{"Length", "[", "newcoms", "]"}]}], ";", "\[IndentingNewLine]", 
      
      RowBox[{"listspan", "=", 
       RowBox[{
        RowBox[{"Range", "[", 
         RowBox[{"Length", "[", "communities", "]"}], "]"}], "[", 
        RowBox[{"[", "span", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"posns", "=", 
       RowBox[{"Flatten", "/@", 
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Flatten", "@", 
            RowBox[{"Position", "[", 
             RowBox[{
              RowBox[{"gNO", "[", 
               RowBox[{"[", "2", "]"}], "]"}], ",", " ", "#"}], "]"}]}], 
           "&"}], ",", "newcoms", ",", 
          RowBox[{"{", "2", "}"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"posmat", "=", 
       RowBox[{"SparseArray", "[", 
        RowBox[{"BoolEval", "[", 
         RowBox[{"mat", ">", "0"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"negmat", " ", "=", " ", 
       RowBox[{"SparseArray", "[", 
        RowBox[{"BoolEval", "[", 
         RowBox[{"mat", "<", "0"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"maxlengths", " ", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"i", "==", "j"}], ",", " ", 
           RowBox[{"Binomial", "[", 
            RowBox[{
             RowBox[{"Length", "[", 
              RowBox[{"newcoms", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "]"}], ",", "2"}], "]"}], ",", 
           
           RowBox[{
            RowBox[{"Length", "[", 
             RowBox[{"newcoms", "[", 
              RowBox[{"[", "i", "]"}], "]"}], "]"}], "*", " ", 
            RowBox[{"Length", "[", 
             RowBox[{"newcoms", "[", 
              RowBox[{"[", "j", "]"}], "]"}], "]"}]}]}], " ", "]"}], " ", ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "len"}], "}"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"j", ",", "len"}], "}"}]}], "]"}]}], " ", ";", 
      "\[IndentingNewLine]", 
      RowBox[{"poslengths", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"posmat", "[", 
           RowBox[{"[", 
            RowBox[{
             RowBox[{"posns", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", 
             RowBox[{"posns", "[", 
              RowBox[{"[", "j", "]"}], "]"}]}], "]"}], "]"}], "[", 
          "\"\<ExplicitLength\>\"", "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "len"}], "}"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"j", ",", "len"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"neglengths", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"negmat", "[", 
           RowBox[{"[", 
            RowBox[{
             RowBox[{"posns", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", 
             RowBox[{"posns", "[", 
              RowBox[{"[", "j", "]"}], "]"}]}], "]"}], "]"}], "[", 
          "\"\<ExplicitLength\>\"", "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "len"}], "}"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"j", ",", "len"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"backgroundstyle", "=", 
       RowBox[{"Lighter", "[", 
        RowBox[{"Gray", ",", "0.95"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Grid", "[", 
       RowBox[{"{", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Grid", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"MapThread", "[", 
             RowBox[{"Join", ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"Append", "[", 
                 RowBox[{
                  RowBox[{"Table", "[", 
                   RowBox[{
                    RowBox[{"{", 
                    RowBox[{"Style", "[", 
                    RowBox[{"i", ",", " ", 
                    RowBox[{"FontFamily", "->", "\"\<Arial\>\""}]}], "]"}], 
                    "}"}], ",", " ", 
                    RowBox[{"{", 
                    RowBox[{"i", ",", " ", "listspan"}], "}"}]}], "]"}], ",", 
                  
                  RowBox[{"{", "Null", "}"}]}], "]"}], ",", 
                "\[IndentingNewLine]", 
                RowBox[{"Join", "[", 
                 RowBox[{
                  RowBox[{"Table", "[", 
                   RowBox[{
                    RowBox[{"Graphics", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"Green", ",", " ", 
                    RowBox[{"Opacity", "[", 
                    RowBox[{
                    FractionBox["1", 
                    RowBox[{
                    "OptionValue", "[", "\"\<MaxPosFraction\>\"", "]"}]], 
                    FractionBox[
                    RowBox[{"poslengths", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "j"}], "]"}], "]"}], 
                    RowBox[{"maxlengths", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "j"}], "]"}], "]"}]]}], "]"}], ",", 
                    RowBox[{"Disk", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"0", ",", "0"}], "}"}], ",", 
                    RowBox[{"Scaled", "[", 
                    SqrtBox[
                    FractionBox[
                    RowBox[{"maxlengths", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "j"}], "]"}], "]"}], 
                    RowBox[{"Max", "[", 
                    RowBox[{"Flatten", "[", "maxlengths", "]"}], "]"}]]], 
                    "]"}]}], "]"}]}], "}"}], ",", " ", 
                    RowBox[{"ImageSize", "->", " ", "30"}]}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"i", ",", "len"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"j", ",", " ", "1", ",", "i"}], "}"}]}], "]"}], 
                  ",", 
                  RowBox[{"{", 
                   RowBox[{"Table", "[", 
                    RowBox[{
                    RowBox[{"Style", "[", 
                    RowBox[{"i", ",", " ", 
                    RowBox[{"FontFamily", "->", "\"\<Arial\>\""}]}], "]"}], 
                    ",", " ", 
                    RowBox[{"{", 
                    RowBox[{"i", ",", "listspan"}], "}"}]}], "]"}], "}"}]}], 
                 "]"}]}], "}"}]}], "]"}], ",", "  ", 
            RowBox[{"Background", "->", " ", "backgroundstyle"}], ",", 
            RowBox[{"Dividers", "->", " ", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Join", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"2", "->", " ", "Gray"}], "}"}], ",", 
                 RowBox[{"Table", "[", 
                  RowBox[{
                   RowBox[{"i", "->", " ", "White"}], ",", " ", 
                   RowBox[{"{", 
                    RowBox[{"i", ",", " ", "3", ",", " ", 
                    RowBox[{"len", "+", "1"}]}], "}"}]}], "]"}]}], "]"}], ",", 
               RowBox[{"Join", "[", 
                RowBox[{
                 RowBox[{"Table", "[", 
                  RowBox[{
                   RowBox[{"i", "->", " ", "White"}], ",", " ", 
                   RowBox[{"{", 
                    RowBox[{"i", ",", " ", "2", ",", " ", "len"}], "}"}]}], 
                  "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "2"}], "->", " ", "Gray"}], "}"}]}], " ", 
                "]"}]}], "}"}]}]}], "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Grid", "[", 
           RowBox[{
            RowBox[{"Join", "[", 
             RowBox[{
              RowBox[{"Table", "[", 
               RowBox[{
                RowBox[{"Graphics", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"Red", ",", " ", 
                    RowBox[{"Opacity", "[", 
                    RowBox[{
                    FractionBox["1", 
                    RowBox[{
                    "OptionValue", "[", "\"\<MaxNegFraction\>\"", "]"}]], 
                    FractionBox[
                    RowBox[{"neglengths", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "j"}], "]"}], "]"}], 
                    RowBox[{"maxlengths", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "j"}], "]"}], "]"}]]}], "]"}], ",", 
                    RowBox[{"Disk", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"0", ",", "0"}], "}"}], ",", 
                    RowBox[{"Scaled", "[", 
                    SqrtBox[
                    FractionBox[
                    RowBox[{"maxlengths", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "j"}], "]"}], "]"}], 
                    RowBox[{"Max", "[", 
                    RowBox[{"Flatten", "[", "maxlengths", "]"}], "]"}]]], 
                    "]"}]}], "]"}]}], "}"}], ",", " ", 
                  RowBox[{"ImageSize", "->", " ", "30"}]}], "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{"i", ",", "len"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"j", ",", " ", "1", ",", "i"}], "}"}]}], "]"}], ",", 
              
              RowBox[{"{", 
               RowBox[{"Table", "[", 
                RowBox[{
                 RowBox[{"Style", "[", 
                  RowBox[{"i", ",", " ", 
                   RowBox[{"FontFamily", "->", "\"\<Arial\>\""}]}], "]"}], 
                 ",", " ", 
                 RowBox[{"{", 
                  RowBox[{"i", ",", "listspan"}], "}"}]}], "]"}], "}"}]}], 
             "]"}], ",", " ", 
            RowBox[{"Background", "->", " ", "backgroundstyle"}], ",", " ", 
            RowBox[{"Dividers", "->", " ", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Join", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"1", "->", " ", "Gray"}], "}"}], ",", 
                 RowBox[{"Table", "[", 
                  RowBox[{
                   RowBox[{"i", "->", " ", "White"}], ",", " ", 
                   RowBox[{"{", 
                    RowBox[{"i", ",", " ", "2", ",", " ", 
                    RowBox[{"len", "+", "1"}]}], "}"}]}], "]"}]}], "]"}], ",", 
               RowBox[{"Join", "[", 
                RowBox[{
                 RowBox[{"Table", "[", 
                  RowBox[{
                   RowBox[{"i", "->", " ", "White"}], ",", " ", 
                   RowBox[{"{", 
                    RowBox[{"i", ",", " ", "2", ",", " ", "len"}], "}"}]}], 
                  "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "2"}], "->", " ", "Gray"}], "}"}]}], " ", 
                "]"}]}], "}"}]}]}], "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Grid", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"\"\<Observed\>\"", ",", "\"\<Fraction\>\""}], "}"}], 
              ",", 
              RowBox[{"{", 
               RowBox[{"Green", ",", " ", 
                RowBox[{"\"\<=\>\"", "<>", 
                 RowBox[{"ToString", "[", 
                  RowBox[{"OptionValue", "[", "\"\<MaxPosFraction\>\"", "]"}],
                   "]"}]}]}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"Red", ",", " ", 
                RowBox[{"\"\<=\>\"", "<>", 
                 RowBox[{"ToString", "[", " ", 
                  RowBox[{"OptionValue", "[", "\"\<MaxNegFraction\>\"", "]"}],
                   "]"}]}]}], "}"}]}], "}"}], ",", " ", 
            RowBox[{"Alignment", "->", " ", "Right"}]}], "]"}]}], "}"}], 
        "}"}], "]"}]}]}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.8845984062590027`*^9, 3.884598406587564*^9}, {
   3.884598489974679*^9, 3.884598490152114*^9}, {3.884598560840804*^9, 
   3.8845985705870533`*^9}, {3.884598746880041*^9, 3.884598819222822*^9}, {
   3.884598868165604*^9, 3.884598870126552*^9}, {3.8845989035466843`*^9, 
   3.8845990894429083`*^9}, {3.884599149492228*^9, 3.884599259295686*^9}, {
   3.8845993111532516`*^9, 3.8845995019688873`*^9}, {3.884599668251253*^9, 
   3.8845997339042253`*^9}, {3.88459977486516*^9, 3.8845998595466833`*^9}, {
   3.8845999187617397`*^9, 3.88459992732626*^9}, {3.8846000588582277`*^9, 
   3.884600090519724*^9}, {3.8846001435867767`*^9, 3.8846003183937798`*^9}, {
   3.8846003510701523`*^9, 3.884600372456849*^9}, {3.884600430535424*^9, 
   3.884600441439857*^9}, {3.884600471491622*^9, 3.884600473385346*^9}, {
   3.884600585833997*^9, 3.884600588319788*^9}, {3.8846006536898203`*^9, 
   3.8846006676672173`*^9}, {3.884600698699728*^9, 3.8846007856865997`*^9}, {
   3.884600923262458*^9, 3.884600960225806*^9}, {3.8846010450192137`*^9, 
   3.884601192992943*^9}, {3.884601232967045*^9, 3.8846013278445377`*^9}, {
   3.884601402448627*^9, 3.884601443521007*^9}, {3.884601487701701*^9, 
   3.884601646470016*^9}, {3.8846018233217077`*^9, 3.8846018352671623`*^9}, {
   3.884601877544301*^9, 3.884601929168503*^9}, {3.884601982217597*^9, 
   3.884602019767816*^9}, {3.8846020517783937`*^9, 3.8846021080665293`*^9}, {
   3.884602157953617*^9, 3.8846021939040337`*^9}, {3.884602367957416*^9, 
   3.88460240853398*^9}, {3.884602442744007*^9, 3.884602550882648*^9}, {
   3.884602607706614*^9, 3.8846027157226467`*^9}, {3.88460275474905*^9, 
   3.884602807144841*^9}, {3.8846028452201366`*^9, 3.884602892075718*^9}, {
   3.884602927213005*^9, 3.884602974320917*^9}, {3.884603013366434*^9, 
   3.884603126889833*^9}, {3.884603188335219*^9, 3.8846033100176773`*^9}, {
   3.884603364256317*^9, 3.884603595742899*^9}, {3.884603672119866*^9, 
   3.88460368744422*^9}, {3.8846037621261*^9, 3.884603762401725*^9}, 
   3.884603799020522*^9, {3.88460426287052*^9, 3.8846044172910557`*^9}, {
   3.8846045702947397`*^9, 3.884604884897251*^9}, {3.8846049581738033`*^9, 
   3.884604980212289*^9}, {3.8846051210913267`*^9, 3.8846052356924763`*^9}, {
   3.884605290863755*^9, 3.884605342095551*^9}, {3.884605390074843*^9, 
   3.88460545434512*^9}, {3.8846054853640413`*^9, 3.884605494112341*^9}, {
   3.884605578460792*^9, 3.884605781686224*^9}, {3.884605825841874*^9, 
   3.8846058757220793`*^9}, {3.884605922941478*^9, 3.884606102032051*^9}, {
   3.884606134643166*^9, 3.884606169080233*^9}, {3.884606223676305*^9, 
   3.884606261794424*^9}, {3.884606367842602*^9, 3.884606370416979*^9}, {
   3.884606738450129*^9, 3.884606793198248*^9}, {3.884606874492731*^9, 
   3.884606926847787*^9}, {3.884606998676264*^9, 3.884607158311049*^9}, {
   3.884607202770104*^9, 3.884607205683597*^9}, {3.8846072420081463`*^9, 
   3.884607271716856*^9}, {3.8846073232916117`*^9, 3.8846074282460814`*^9}, {
   3.8846074964952583`*^9, 3.884607502735837*^9}, {3.884607545716097*^9, 
   3.8846076294941587`*^9}, {3.8846076713916273`*^9, 3.884607704658046*^9}, {
   3.8846080588268127`*^9, 3.884608082687728*^9}, {3.884608459402478*^9, 
   3.884608471042255*^9}, {3.884608562957232*^9, 3.8846085651977167`*^9}, 
   3.884608600327553*^9, {3.884608643342107*^9, 3.8846086670126*^9}, {
   3.8846088191820803`*^9, 3.8846089257475243`*^9}, {3.88460897932502*^9, 
   3.884609031556569*^9}, {3.884609156266747*^9, 3.884609171939392*^9}, {
   3.884609378007867*^9, 3.8846093845059547`*^9}, {3.8846094361176023`*^9, 
   3.8846094372642803`*^9}, {3.884609475123313*^9, 3.88460960367278*^9}, {
   3.8846098081732597`*^9, 3.8846098089477167`*^9}, {3.8846098640875883`*^9, 
   3.884609919122695*^9}, {3.8846100222024107`*^9, 3.8846100379123583`*^9}, {
   3.884610077672228*^9, 3.884610123089918*^9}, {3.884610164302944*^9, 
   3.8846101646139297`*^9}, {3.8846102112155647`*^9, 
   3.8846102186612473`*^9}, {3.88461031103659*^9, 3.8846103734170113`*^9}, {
   3.8846111294733953`*^9, 3.8846111470387383`*^9}, 3.884611285150564*^9},
 Background->RGBColor[1, 1, 0],
 CellLabel->
  "In[162]:=",ExpressionUUID->"6b01a9a2-5756-485a-832e-1755ef844e5a"]
}, Closed]],

Cell[CellGroupData[{

Cell["CreateNormalizedDataset", "Subsubsection",
 CellChangeTimes->{{3.906462490436429*^9, 
  3.906462495367835*^9}},ExpressionUUID->"514a1ec5-a59e-43ca-b0aa-\
4071fb8dff6b"],

Cell["\<\
In calculating residuals, fano factors, and correlation coefficients, BigSur \
always avoids the explicit normalization of gene expression values.  However, \
in visualizing gene regulatory interactions, it is sometimes helpful to also \
represent the approximate, relative expression levels of genes by varying the \
sizes of symbols that are used to represent nodes.  To obtain these values, \
we perform \[OpenCurlyDoubleQuote]default\[CloseCurlyDoubleQuote] \
normalization of the matrix in a matpac (i.e. scaling each gene expression \
value to the relative total UMI in that cell).  The output is in the form of \
a Dataset, a Mathematica data structure that allows for easy retrieval of \
results.  \
\>", "Text",
 CellChangeTimes->{{3.906462498851799*^9, 3.906462605243903*^9}, {
  3.906462641838315*^9, 3.90646268585291*^9}, {3.9064627255165043`*^9, 
  3.906462751034186*^9}, {3.906462803745363*^9, 
  3.906462808698462*^9}},ExpressionUUID->"3bb22392-91b9-4eed-9bfb-\
817ef3a228cd"],

Cell[BoxData[
 RowBox[{
  RowBox[{"CreateNormalizedDataset", "[", "matpac_", "]"}], ":=", 
  "\[IndentingNewLine]", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"scalingmatrix", ",", " ", "matpacDN"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"scalingmatrix", " ", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"Evaluate", "[", 
         RowBox[{"N", "[", 
          SuperscriptBox[
           RowBox[{"(", 
            FractionBox[
             RowBox[{"Total", "/@", 
              RowBox[{"Transpose", "[", 
               RowBox[{"matpac", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "]"}]}], 
             RowBox[{"Mean", "[", 
              RowBox[{"Total", "/@", 
               RowBox[{"Transpose", "[", 
                RowBox[{"matpac", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "]"}]], ")"}], 
           RowBox[{"-", "1"}]], "]"}], "]"}], ",", 
        RowBox[{"Length", "[", 
         RowBox[{"matpac", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "]"}]}], " ", ";", 
     "\[IndentingNewLine]", 
     RowBox[{"matpacDN", "=", 
      RowBox[{"ReplacePart", "[", 
       RowBox[{"matpac", ",", " ", 
        RowBox[{"1", "->", " ", 
         RowBox[{"SparseArray", "[", 
          RowBox[{
           RowBox[{"scalingmatrix", "*", 
            RowBox[{"matpac", "[", 
             RowBox[{"[", "1", "]"}], "]"}]}], ",", " ", 
           RowBox[{"Dimensions", "[", 
            RowBox[{"matpac", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "]"}]}]}], "]"}]}], ";",
      "\[IndentingNewLine]", 
     RowBox[{"Dataset", "[", 
      RowBox[{"AssociationThread", "[", 
       RowBox[{
        RowBox[{"matpacDN", "[", 
         RowBox[{"[", "2", "]"}], "]"}], "->", " ", 
        RowBox[{"Mean", "/@", 
         RowBox[{"matpacDN", "[", 
          RowBox[{"[", "1", "]"}], "]"}]}]}], "]"}], "]"}]}]}], 
   "]"}]}]], "Input",
 CellChangeTimes->{
  3.906462765231842*^9, {3.9064628380490103`*^9, 3.906462900353243*^9}},
 Background->RGBColor[
  1, 1, 0],ExpressionUUID->"d050fbbc-79e9-412c-b656-e7f529dd8238"]
}, Closed]],

Cell[CellGroupData[{

Cell["NewPlot", "Subsubsection",
 CellChangeTimes->{{3.88289669794552*^9, 
  3.882896700032009*^9}},ExpressionUUID->"3ffc28a5-ff89-4ba7-8b8e-\
9f4c7665ddb8"],

Cell["\<\
This gives a flexible visualization of correlation structure; which first \
structures a plot based on the positive correlations, but then places the \
negative correlations on top of them.

It uses Mathematica\[CloseCurlyQuote]s Manipulate function to allow drop down \
menus to be used to continually update the appearance of a graph.  As a \
default it first displays only those correlations that are strongest.  By \
adjusting with the dropdown menu, one can then fill in progressively weaker \
and weaker sets of correlations.  The numbers of the menu are threshold \
values of the equivalent PCCs.  

Other menus allow one to control zoom, pan, and image size, as well as \
whether negative correlations should be shown or not.  

Options allow one to specify genes to highlight and how to display them, the \
method Mathematica uses to place genes, an--if an expression dataset is used \
as a third input--what relative size to use for the vertex shapes, as a \
function of gene expression.  

A potential inconvenience encountered in an earlier version of NewPlot is it \
divides up the menu of which genes  to display by the quantiles of the \
correlations, meaning that genes get included as soon as they have any \
correlations within a given interval.  The result we find is that the first \
quantiles tend to have a very large number of genes and span a very wide \
range of correlations.  A better way to do this could be to sort the genes by \
their strongest correlation, and divide into intervals based on equal numbers \
of genes in each group.  However, for big communities, another approach is to \
break up into groups of 25 genes at a time, whereas for small groups, we may \
want to stick with 10 partitions, regardless of size.  Thus there is an \
option, \[OpenCurlyDoubleQuote]Automatic \
Partitioning\[CloseCurlyDoubleQuote]:  when it is set to True (default), it \
selects whichever gives a longer list--25 gene bins, or 10 quantiles, and \
chooses that.

SizeScaling is set at 25, but one can put in any number or one can put in \
\[OpenCurlyDoubleQuote]None\[CloseCurlyDoubleQuote]\
\>", "Text",
 CellChangeTimes->{{3.8828967179765387`*^9, 3.882896742031969*^9}, {
  3.883294591617605*^9, 3.883294619183942*^9}, {3.8834779085055027`*^9, 
  3.883478068611096*^9}, {3.883479485701968*^9, 3.883479511297368*^9}, {
  3.8834866721783123`*^9, 3.883486867667789*^9}, {3.883585869019911*^9, 
  3.8835858908534822`*^9}, {3.906464541529517*^9, 3.9064648994573107`*^9}, {
  3.9064650681570272`*^9, 
  3.906465179990879*^9}},ExpressionUUID->"01ffef5a-d68a-4b41-bb41-\
4d3a199611e3"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "NewPlot", "]"}], "=", 
    RowBox[{"{", " ", 
     RowBox[{
      RowBox[{"\"\<Highlight\>\"", "->", " ", 
       RowBox[{"{", "}"}]}], ",", " ", 
      RowBox[{"\"\<Layout\>\"", "->", " ", "\"\<SpringEmbedding\>\""}], ",", 
      " ", 
      RowBox[{"\"\<Size Scaling\>\"", "->", " ", "25"}], ",", " ", 
      RowBox[{"\"\<Automatic Partitioning\>\"", "->", " ", "True"}], ",", " ", 
      RowBox[{"\"\<HighlightLabelStyle\>\"", "->", 
       RowBox[{"Directive", "[", 
        RowBox[{"Blue", ",", " ", "Larger"}], "]"}]}], ",", " ", 
      RowBox[{"\"\<HighlightShape\>\"", "->", " ", "\"\<Square\>\""}]}], 
     "}"}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ef1", "[", 
     RowBox[{"el_", ",", "___"}], "]"}], ":=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"Arrowheads", "[", "0", "]"}], ",", 
      RowBox[{"Arrow", "[", 
       RowBox[{"el", ",", "0"}], "]"}]}], "}"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"NewPlot", "[", 
    RowBox[{"gNO_", ",", " ", "genes_", ",", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"gno", "=", 
        RowBox[{"GeneSubsetGNO", "[", 
         RowBox[{"gNO", ",", " ", 
          RowBox[{"Flatten", "[", "genes", "]"}], ",", " ", 
          RowBox[{"\"\<Purge\>\"", "->", " ", "True"}]}], "]"}]}], ",", " ", 
       "fullmat", ",", "posmatrix", ",", "posposns", ",", " ", "posplot", ",",
        " ", "vertexcoords", ",", " ", "allyellowvertices", ",", " ", 
       "allvertexlabels", ",", " ", "vertexsizes", ",", " ", "quantiles"}], 
      "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"fullmat", "=", 
       RowBox[{"gno", "[", 
        RowBox[{"[", "3", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"quantiles", "=", 
       RowBox[{"With", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"list", "=", 
           RowBox[{"ReverseSort", "[", 
            RowBox[{"Max", "/@", 
             RowBox[{"RestoreSymmetryExceptDiagonal", "[", 
              RowBox[{"Abs", "[", "fullmat", "]"}], "]"}]}], "]"}]}], "}"}], 
         ",", 
         RowBox[{
          RowBox[{
           RowBox[{"Floor", "[", 
            RowBox[{"#", ",", "0.001"}], "]"}], "&"}], "/@", 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
            "OptionValue", "[", "\"\<Automatic Partitioning\>\"", "]"}], ",", 
            
            RowBox[{"First", "[", 
             RowBox[{"ReverseSortBy", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"Last", "/@", 
                  RowBox[{"Partition", "[", 
                   RowBox[{"list", ",", "25"}], "]"}]}], ",", 
                 RowBox[{"Quantile", "[", 
                  RowBox[{"list", ",", 
                   RowBox[{"Reverse", "[", 
                    RowBox[{"Table", "[", 
                    RowBox[{"i", ",", 
                    RowBox[{"{", 
                    RowBox[{
                    "i", ",", " ", "0", ",", " ", "0.9", ",", " ", "0.1"}], 
                    "}"}]}], "]"}], "]"}]}], "]"}]}], "}"}], ",", "Length"}], 
              "]"}], "]"}], ",", 
            RowBox[{"Quantile", "[", 
             RowBox[{"list", ",", 
              RowBox[{"Reverse", "[", 
               RowBox[{"Table", "[", 
                RowBox[{"i", ",", 
                 RowBox[{"{", 
                  RowBox[{
                  "i", ",", " ", "0", ",", " ", "0.9", ",", " ", "0.1"}], 
                  "}"}]}], "]"}], "]"}]}], "]"}]}], "\[IndentingNewLine]", 
           "]"}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"posmatrix", "=", " ", 
       RowBox[{"SparseArray", "[", 
        RowBox[{"BoolEval", "[", 
         RowBox[{"fullmat", ">", "0"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"posposns", " ", "=", " ", 
       RowBox[{"Sort", "[", 
        RowBox[{"Union", "[", 
         RowBox[{"Flatten", "[", 
          RowBox[{"posmatrix", "[", "\"\<ExplicitPositions\>\"", "]"}], "]"}],
          "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"posplot", "=", 
       RowBox[{"UndirectedGraph", "[", 
        RowBox[{"AdjacencyGraph", "[", 
         RowBox[{"posmatrix", ",", 
          RowBox[{"GraphLayout", "->", 
           RowBox[{"OptionValue", "[", "\"\<Layout\>\"", "]"}]}]}], "]"}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"vertexcoords", " ", "=", " ", 
       RowBox[{"Thread", "[", 
        RowBox[{"posposns", "->", " ", 
         RowBox[{
          RowBox[{"GraphEmbedding", "[", "posplot", "]"}], "[", 
          RowBox[{"[", "posposns", "]"}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"allyellowvertices", "=", " ", 
       RowBox[{"Flatten", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Position", "[", 
           RowBox[{
            RowBox[{"gno", "[", 
             RowBox[{"[", "2", "]"}], "]"}], ",", "#"}], "]"}], "&"}], "/@", 
         RowBox[{"OptionValue", "[", "\"\<Highlight\>\"", "]"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"allvertexlabels", "=", 
       RowBox[{"Thread", "[", 
        RowBox[{
         RowBox[{"Range", "[", 
          RowBox[{"Length", "[", 
           RowBox[{"gno", "[", 
            RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], "->", "  ", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"Placed", "[", 
             RowBox[{"#", ",", "Center"}], "]"}], "&"}], "/@", 
           RowBox[{"gno", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], ")"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"With", "[", 
       RowBox[{
        RowBox[{"{", " ", 
         RowBox[{
          RowBox[{"mat", "=", "fullmat"}], ",", " ", 
          RowBox[{"q", "=", "quantiles"}], ",", 
          RowBox[{"vc", "=", "vertexcoords"}], ",", " ", 
          RowBox[{"yv", "=", "allyellowvertices"}], ",", " ", 
          RowBox[{"vl", "=", "allvertexlabels"}]}], "}"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"Manipulate", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Module", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
             "workingmat", ",", "es", ",", " ", "workingvertices", ",", " ", 
              "yellowvertices", ",", "bluevertices", ",", " ", 
              "newvertexcoords", ",", "newvertexlabels", ",", "datarange", 
              ",", "centerpoint", ",", "\[Delta]x", ",", "\[Delta]y", ",", 
              " ", "newallposns", ",", "newnegposns", ",", "  ", "greenedges",
               ",", " ", "rededges", ",", "cp"}], "}"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{"positiveOnly", ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"workingmat", " ", "=", "  ", 
                 RowBox[{"SparseArray", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"BoolEval", "[", 
                    RowBox[{"mat", ">", "cutoff"}], "]"}], "*", "mat"}], ",", 
                   " ", 
                   RowBox[{"Dimensions", "[", "mat", "]"}]}], "]"}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"rededges", "=", 
                 RowBox[{"{", "}"}]}], ";", 
                RowBox[{"greenedges", "=", 
                 RowBox[{"EdgeList", "[", 
                  RowBox[{"Graph", "[", 
                   RowBox[{
                   "workingmat", "[", "\"\<ExplicitPositions\>\"", "]"}], 
                   "]"}], "]"}]}], ";", 
                RowBox[{"es", " ", "=", 
                 RowBox[{"Directive", "[", 
                  RowBox[{"{", 
                   RowBox[{"Green", ",", " ", 
                    RowBox[{"Opacity", "[", "0.5", "]"}]}], "}"}], "]"}]}]}], 
               " ", ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"workingmat", " ", "=", " ", 
                 RowBox[{"SparseArray", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"BoolEval", "[", 
                    RowBox[{
                    RowBox[{"Abs", "[", "mat", "]"}], ">", "cutoff"}], "]"}], 
                    "*", "mat"}], ",", " ", 
                   RowBox[{"Dimensions", "[", "mat", "]"}]}], "]"}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"rededges", "=", 
                 RowBox[{"EdgeList", "[", 
                  RowBox[{"Graph", "[", 
                   RowBox[{
                    RowBox[{"SparseArray", "[", 
                    RowBox[{"BoolEval", "[", 
                    RowBox[{"workingmat", "<", "0"}], "]"}], "]"}], "[", 
                    "\"\<ExplicitPositions\>\"", "]"}], "]"}], "]"}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"greenedges", "=", 
                 RowBox[{"EdgeList", "[", 
                  RowBox[{"Graph", "[", 
                   RowBox[{
                    RowBox[{"SparseArray", "[", 
                    RowBox[{"BoolEval", "[", 
                    RowBox[{"workingmat", ">", "0"}], "]"}], "]"}], "[", 
                    "\"\<ExplicitPositions\>\"", "]"}], "]"}], "]"}]}], ";", 
                " ", "\[IndentingNewLine]", 
                RowBox[{"es", " ", "=", " ", 
                 RowBox[{"Join", "[", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"#", "->", " ", 
                    RowBox[{"Directive", "[", 
                    RowBox[{"{", 
                    RowBox[{"Green", ",", " ", 
                    RowBox[{"Opacity", "[", "0.5", "]"}]}], "}"}], "]"}]}], 
                    "&"}], "/@", "greenedges"}], ")"}], ",", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"#", "->", " ", 
                    RowBox[{"Directive", "[", 
                    RowBox[{"{", 
                    RowBox[{"Pink", ",", " ", 
                    RowBox[{"Opacity", "[", "0.2", "]"}]}], "}"}], "]"}]}], 
                    "&"}], "/@", "rededges"}], ")"}]}], "]"}]}]}]}], " ", 
              "]"}], ";", "\[IndentingNewLine]", 
             RowBox[{"workingvertices", "=", 
              RowBox[{"Sort", "[", 
               RowBox[{"Union", "[", 
                RowBox[{"Flatten", "[", 
                 RowBox[{
                 "workingmat", "[", "\"\<ExplicitPositions\>\"", "]"}], "]"}],
                 "]"}], "]"}]}], ";", "\[IndentingNewLine]", "\t", 
             RowBox[{"yellowvertices", "=", 
              RowBox[{"Intersection", "[", 
               RowBox[{"workingvertices", ",", " ", "yv"}], "]"}]}], ";", 
             "\[IndentingNewLine]", "\t", 
             RowBox[{"bluevertices", "=", " ", 
              RowBox[{"Complement", "[", 
               RowBox[{"workingvertices", ",", " ", "yellowvertices"}], 
               "]"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"newvertexcoords", " ", "=", " ", 
              RowBox[{"Select", "[", 
               RowBox[{"vc", ",", " ", 
                RowBox[{
                 RowBox[{"MemberQ", "[", 
                  RowBox[{"workingvertices", ",", " ", 
                   RowBox[{"First", "[", "#", "]"}]}], "]"}], "&"}]}], 
               "]"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"newvertexlabels", "=", 
              RowBox[{"Select", "[", 
               RowBox[{"vl", ",", " ", 
                RowBox[{
                 RowBox[{"MemberQ", "[", 
                  RowBox[{"workingvertices", ",", " ", 
                   RowBox[{"First", "[", "#", "]"}]}], "]"}], "&"}]}], 
               "]"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"datarange", "=", 
              RowBox[{"MinMax", "/@", 
               RowBox[{"Transpose", "[", 
                RowBox[{"Values", "[", "vc", "]"}], "]"}]}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"centerpoint", "=", 
              RowBox[{"Mean", "/@", "datarange"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"\[Delta]x", ",", "\[Delta]y"}], "}"}], "=", 
              RowBox[{
               RowBox[{"Last", "/@", "datarange"}], " ", "-", " ", 
               "centerpoint"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"GraphPlot", "[", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"Graph", "[", 
                RowBox[{
                 RowBox[{
                 "workingmat", "[", "\"\<ExplicitPositions\>\"", "]"}], ",", 
                 "\[IndentingNewLine]", 
                 RowBox[{"VertexCoordinates", "->", "newvertexcoords"}], ",", 
                 "\[IndentingNewLine]", 
                 RowBox[{"VertexLabels", "->", " ", "newvertexlabels"}], ",", 
                 "\[IndentingNewLine]", 
                 RowBox[{"VertexLabelStyle", "\[Rule]", " ", 
                  RowBox[{"Join", "[", " ", 
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"#", "\[Rule]", 
                    RowBox[{
                    "OptionValue", "[", "\"\<HighlightLabelStyle\>\"", 
                    "]"}]}], ")"}], "&"}], "/@", "yellowvertices"}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"#", "\[Rule]", "Automatic"}], ")"}], "&"}], "/@",
                     " ", "bluevertices"}]}], "]"}]}], ",", 
                 "\[IndentingNewLine]", 
                 RowBox[{"VertexStyle", "->", 
                  RowBox[{"Join", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"#", "->", " ", 
                    RowBox[{"Directive", "[", 
                    RowBox[{
                    RowBox[{"EdgeForm", "[", "None", "]"}], ",", "Blue", ",", 
                    
                    RowBox[{"Opacity", "[", "0.05", "]"}]}], "]"}]}], ")"}], 
                    "&"}], "/@", "bluevertices"}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"#", "->", " ", 
                    RowBox[{"Directive", "[", 
                    RowBox[{
                    RowBox[{"EdgeForm", "[", "None", "]"}], ",", "Yellow", 
                    ",", 
                    RowBox[{"Opacity", "[", "0.5", "]"}]}], "]"}]}], ")"}], 
                    "&"}], "/@", "yellowvertices"}]}], "]"}]}], " ", ",", 
                 "\[IndentingNewLine]", 
                 RowBox[{"VertexShapeFunction", "\[Rule]", 
                  RowBox[{"Join", "[", 
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"#", "\[Rule]", " ", 
                    RowBox[{
                    "OptionValue", "[", " ", "\"\<HighlightShape\>\"", 
                    "]"}]}], "&"}], "/@", "yellowvertices"}], ")"}], ",", " ", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"#", "\[Rule]", " ", "Automatic"}], "&"}], "/@", 
                    "bluevertices"}], ")"}]}], "]"}]}], ",", 
                 RowBox[{"EdgeWeight", "->", " ", 
                  RowBox[{"1", "+", " ", 
                   RowBox[{"Abs", "[", 
                    RowBox[{
                    "workingmat", "[", "\"\<ExplicitValues\>\"", "]"}], 
                    "]"}]}]}], ",", "\[IndentingNewLine]", 
                 RowBox[{"EdgeStyle", "->", "es"}], ",", 
                 "\[IndentingNewLine]", 
                 RowBox[{"EdgeShapeFunction", "\[Rule]", "ef1"}]}], "]"}], 
               ",", "\[IndentingNewLine]", 
               RowBox[{"PlotRange", "->", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"centerpoint", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "+", 
                    RowBox[{
                    RowBox[{"pan", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "\[Delta]x"}], "-", " ", 
                    FractionBox["\[Delta]x", 
                    RowBox[{"10", "^", "logzoom"}]]}], ",", " ", 
                    RowBox[{
                    RowBox[{"centerpoint", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "+", 
                    RowBox[{
                    RowBox[{"pan", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "\[Delta]x"}], "+", 
                    FractionBox["\[Delta]x", 
                    RowBox[{"10", "^", "logzoom"}]]}]}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"centerpoint", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "+", 
                    RowBox[{
                    RowBox[{"pan", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "\[Delta]y"}], "-", " ", 
                    FractionBox["\[Delta]y", 
                    RowBox[{"10", "^", "logzoom"}]]}], ",", " ", 
                    RowBox[{
                    RowBox[{"centerpoint", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "+", 
                    RowBox[{
                    RowBox[{"pan", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "\[Delta]y"}], "+", " ", 
                    FractionBox["\[Delta]y", 
                    RowBox[{"10", "^", "logzoom"}]]}]}], "}"}]}], "}"}]}], 
               " ", ",", " ", 
               RowBox[{"ImageSize", "->", " ", "is"}]}], "]"}]}]}], "]"}], 
          ",", 
          RowBox[{"Row", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Column", "[", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"Control", "[", 
                 RowBox[{"{", 
                  RowBox[{"cutoff", ",", "q"}], "}"}], "]"}], ",", 
                RowBox[{"Control", "[", 
                 RowBox[{"{", 
                  RowBox[{"positiveOnly", ",", " ", 
                   RowBox[{"{", 
                    RowBox[{"True", ",", " ", "False"}], "}"}]}], "}"}], 
                 "]"}], ",", 
                RowBox[{"Control", "[", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{"logzoom", ",", "0", ",", "\"\<zoom\>\""}], "}"}],
                    ",", 
                   RowBox[{"Log10", "[", "0.25", "]"}], ",", 
                   RowBox[{"Log10", "[", "5", "]"}]}], "}"}], "]"}], ",", 
                RowBox[{"Control", "[", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{
                    "is", ",", "400", ",", " ", "\"\<image size\>\""}], "}"}],
                    ",", "50", ",", " ", "8000"}], "}"}], "]"}]}], "}"}], 
              "]"}], ",", 
             RowBox[{"Column", "[", 
              RowBox[{"{", 
               RowBox[{"Control", "[", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"pan", ",", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", "0"}], "}"}]}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "}"}], "]"}], 
               "}"}], "]"}]}], "}"}], "]"}]}], "\[IndentingNewLine]", "]"}]}],
        "]"}]}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"NewPlot", "[", 
   RowBox[{"gNO_", ",", " ", "genes_", ",", "expressiondata_", ",", " ", 
    RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
  "\[IndentingNewLine]", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"gno", "=", 
       RowBox[{"GeneSubsetGNO", "[", 
        RowBox[{"gNO", ",", " ", 
         RowBox[{"Flatten", "[", "genes", "]"}], ",", " ", 
         RowBox[{"\"\<Purge\>\"", "->", " ", "True"}]}], "]"}]}], ",", " ", 
      "fullmat", ",", "posmatrix", ",", "posposns", ",", " ", "posplot", ",", 
      " ", "vertexcoords", ",", " ", "allyellowvertices", ",", " ", 
      "allvertexlabels", ",", " ", "vertexsizes", ",", " ", "quantiles"}], 
     "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"fullmat", "=", 
      RowBox[{"gno", "[", 
       RowBox[{"[", "3", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"quantiles", "=", 
      RowBox[{"With", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"list", "=", 
          RowBox[{"ReverseSort", "[", 
           RowBox[{"Max", "/@", 
            RowBox[{"RestoreSymmetryExceptDiagonal", "[", 
             RowBox[{"Abs", "[", 
              RowBox[{"gno", "[", 
               RowBox[{"[", "3", "]"}], "]"}], "]"}], "]"}]}], "]"}]}], "}"}],
         ",", 
        RowBox[{
         RowBox[{
          RowBox[{"Floor", "[", 
           RowBox[{"#", ",", "0.001"}], "]"}], "&"}], "/@", 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
           "OptionValue", "[", "\"\<Automatic Partitioning\>\"", "]"}], ",", 
           RowBox[{"First", "[", 
            RowBox[{"ReverseSortBy", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"Last", "/@", 
                 RowBox[{"Partition", "[", 
                  RowBox[{"list", ",", "25"}], "]"}]}], ",", 
                RowBox[{"Quantile", "[", 
                 RowBox[{"list", ",", 
                  RowBox[{"Reverse", "[", 
                   RowBox[{"Table", "[", 
                    RowBox[{"i", ",", 
                    RowBox[{"{", 
                    RowBox[{
                    "i", ",", " ", "0", ",", " ", "0.9", ",", " ", "0.1"}], 
                    "}"}]}], "]"}], "]"}]}], "]"}]}], "}"}], ",", "Length"}], 
             "]"}], "]"}], ",", 
           RowBox[{"Quantile", "[", 
            RowBox[{"list", ",", 
             RowBox[{"Reverse", "[", 
              RowBox[{"Table", "[", 
               RowBox[{"i", ",", 
                RowBox[{"{", 
                 RowBox[{
                 "i", ",", " ", "0", ",", " ", "0.9", ",", " ", "0.1"}], 
                 "}"}]}], "]"}], "]"}]}], "]"}]}], "\[IndentingNewLine]", 
          "]"}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"posmatrix", "=", " ", 
      RowBox[{"SparseArray", "[", 
       RowBox[{"BoolEval", "[", 
        RowBox[{"fullmat", ">", "0"}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"posposns", " ", "=", " ", 
      RowBox[{"Sort", "[", 
       RowBox[{"Union", "[", 
        RowBox[{"Flatten", "[", 
         RowBox[{"posmatrix", "[", "\"\<ExplicitPositions\>\"", "]"}], "]"}], 
        "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"posplot", "=", 
      RowBox[{"UndirectedGraph", "[", 
       RowBox[{"AdjacencyGraph", "[", 
        RowBox[{"posmatrix", ",", 
         RowBox[{"GraphLayout", "->", 
          RowBox[{"OptionValue", "[", "\"\<Layout\>\"", "]"}]}]}], "]"}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"vertexcoords", " ", "=", " ", 
      RowBox[{"Thread", "[", 
       RowBox[{"posposns", "->", " ", 
        RowBox[{
         RowBox[{"GraphEmbedding", "[", "posplot", "]"}], "[", 
         RowBox[{"[", "posposns", "]"}], "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"vertexsizes", "=", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"NumberQ", "[", 
         RowBox[{"OptionValue", "[", "\"\<Size Scaling\>\"", "]"}], "]"}], 
        ",", 
        RowBox[{"Thread", "[", 
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"Length", "[", 
            RowBox[{"gno", "[", 
             RowBox[{"[", "2", "]"}], "]"}], "]"}], " ", "]"}], "->", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"OptionValue", "[", "\"\<Size Scaling\>\"", "]"}], 
              SqrtBox[
               RowBox[{"expressiondata", "[", "#", "]"}]]}], "&"}], "/@", 
            RowBox[{"gno", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], ")"}]}], "]"}], ",", 
        RowBox[{"{", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"allyellowvertices", "=", " ", 
      RowBox[{"Flatten", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Position", "[", 
          RowBox[{
           RowBox[{"gno", "[", 
            RowBox[{"[", "2", "]"}], "]"}], ",", "#"}], "]"}], "&"}], "/@", 
        RowBox[{"OptionValue", "[", "\"\<Highlight\>\"", "]"}]}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"allvertexlabels", "=", 
      RowBox[{"Thread", "[", 
       RowBox[{
        RowBox[{"Range", "[", 
         RowBox[{"Length", "[", 
          RowBox[{"gno", "[", 
           RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], "->", "  ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"Placed", "[", 
            RowBox[{"#", ",", "Center"}], "]"}], "&"}], "/@", 
          RowBox[{"gno", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}], ")"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"With", "[", 
      RowBox[{
       RowBox[{"{", " ", 
        RowBox[{
         RowBox[{"mat", "=", "fullmat"}], ",", " ", 
         RowBox[{"q", "=", "quantiles"}], ",", 
         RowBox[{"vc", "=", "vertexcoords"}], ",", " ", 
         RowBox[{"yv", "=", "allyellowvertices"}], ",", " ", 
         RowBox[{"vl", "=", "allvertexlabels"}], ",", " ", 
         RowBox[{"vs", "=", "vertexsizes"}]}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"Manipulate", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Module", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
            "workingmat", ",", "es", ",", " ", "workingvertices", ",", " ", 
             "yellowvertices", ",", "bluevertices", ",", " ", 
             "newvertexcoords", ",", "newvertexlabels", ",", "datarange", ",",
              "centerpoint", ",", "\[Delta]x", ",", "\[Delta]y", ",", " ", 
             "newallposns", ",", "newnegposns", ",", "  ", "greenedges", ",", 
             " ", "rededges", ",", "cp"}], "}"}], ",", "\[IndentingNewLine]", 
           
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{"positiveOnly", ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"workingmat", " ", "=", "  ", 
                RowBox[{"SparseArray", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"BoolEval", "[", 
                    RowBox[{"mat", ">", "cutoff"}], "]"}], "*", "mat"}], ",", 
                  " ", 
                  RowBox[{"Dimensions", "[", "mat", "]"}]}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"rededges", "=", 
                RowBox[{"{", "}"}]}], ";", 
               RowBox[{"greenedges", "=", 
                RowBox[{"EdgeList", "[", 
                 RowBox[{"Graph", "[", 
                  RowBox[{
                  "workingmat", "[", "\"\<ExplicitPositions\>\"", "]"}], 
                  "]"}], "]"}]}], ";", 
               RowBox[{"es", " ", "=", 
                RowBox[{"Directive", "[", 
                 RowBox[{"{", 
                  RowBox[{"Green", ",", " ", 
                   RowBox[{"Opacity", "[", "0.5", "]"}]}], "}"}], "]"}]}]}], 
              " ", ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"workingmat", " ", "=", " ", 
                RowBox[{"SparseArray", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"BoolEval", "[", 
                    RowBox[{
                    RowBox[{"Abs", "[", "mat", "]"}], ">", "cutoff"}], "]"}], 
                   "*", "mat"}], ",", " ", 
                  RowBox[{"Dimensions", "[", "mat", "]"}]}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"rededges", "=", 
                RowBox[{"EdgeList", "[", 
                 RowBox[{"Graph", "[", 
                  RowBox[{
                   RowBox[{"SparseArray", "[", 
                    RowBox[{"BoolEval", "[", 
                    RowBox[{"workingmat", "<", "0"}], "]"}], "]"}], "[", 
                   "\"\<ExplicitPositions\>\"", "]"}], "]"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"greenedges", "=", 
                RowBox[{"EdgeList", "[", 
                 RowBox[{"Graph", "[", 
                  RowBox[{
                   RowBox[{"SparseArray", "[", 
                    RowBox[{"BoolEval", "[", 
                    RowBox[{"workingmat", ">", "0"}], "]"}], "]"}], "[", 
                   "\"\<ExplicitPositions\>\"", "]"}], "]"}], "]"}]}], ";", 
               " ", "\[IndentingNewLine]", 
               RowBox[{"es", " ", "=", " ", 
                RowBox[{"Join", "[", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"#", "->", " ", 
                    RowBox[{"Directive", "[", 
                    RowBox[{"{", 
                    RowBox[{"Green", ",", " ", 
                    RowBox[{"Opacity", "[", "0.5", "]"}]}], "}"}], "]"}]}], 
                    "&"}], "/@", "greenedges"}], ")"}], ",", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"#", "->", " ", 
                    RowBox[{"Directive", "[", 
                    RowBox[{"{", 
                    RowBox[{"Pink", ",", " ", 
                    RowBox[{"Opacity", "[", "0.2", "]"}]}], "}"}], "]"}]}], 
                    "&"}], "/@", "rededges"}], ")"}]}], "]"}]}]}]}], " ", 
             "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"workingvertices", "=", 
             RowBox[{"Sort", "[", 
              RowBox[{"Union", "[", 
               RowBox[{"Flatten", "[", 
                RowBox[{"workingmat", "[", "\"\<ExplicitPositions\>\"", "]"}],
                 "]"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", "\t", 
            RowBox[{"yellowvertices", "=", 
             RowBox[{"Intersection", "[", 
              RowBox[{"workingvertices", ",", " ", "yv"}], "]"}]}], ";", 
            "\[IndentingNewLine]", "\t", 
            RowBox[{"bluevertices", "=", " ", 
             RowBox[{"Complement", "[", 
              RowBox[{"workingvertices", ",", " ", "yellowvertices"}], 
              "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"newvertexcoords", " ", "=", " ", 
             RowBox[{"Select", "[", 
              RowBox[{"vc", ",", " ", 
               RowBox[{
                RowBox[{"MemberQ", "[", 
                 RowBox[{"workingvertices", ",", " ", 
                  RowBox[{"First", "[", "#", "]"}]}], "]"}], "&"}]}], "]"}]}],
             ";", "\[IndentingNewLine]", 
            RowBox[{"newvertexlabels", "=", 
             RowBox[{"Select", "[", 
              RowBox[{"vl", ",", " ", 
               RowBox[{
                RowBox[{"MemberQ", "[", 
                 RowBox[{"workingvertices", ",", " ", 
                  RowBox[{"First", "[", "#", "]"}]}], "]"}], "&"}]}], "]"}]}],
             ";", "\[IndentingNewLine]", 
            RowBox[{"datarange", "=", 
             RowBox[{"MinMax", "/@", 
              RowBox[{"Transpose", "[", 
               RowBox[{"Values", "[", "vc", "]"}], "]"}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"centerpoint", "=", 
             RowBox[{"Mean", "/@", "datarange"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"\[Delta]x", ",", "\[Delta]y"}], "}"}], "=", 
             RowBox[{
              RowBox[{"Last", "/@", "datarange"}], " ", "-", " ", 
              "centerpoint"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"GraphPlot", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"Graph", "[", 
               RowBox[{
                RowBox[{"workingmat", "[", "\"\<ExplicitPositions\>\"", "]"}],
                 ",", "\[IndentingNewLine]", 
                RowBox[{"VertexCoordinates", "->", "newvertexcoords"}], ",", 
                "\[IndentingNewLine]", 
                RowBox[{"VertexLabels", "->", " ", "newvertexlabels"}], ",", 
                "\[IndentingNewLine]", 
                RowBox[{"VertexLabelStyle", "\[Rule]", " ", 
                 RowBox[{"Join", "[", " ", 
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"#", "\[Rule]", 
                    RowBox[{
                    "OptionValue", "[", "\"\<HighlightLabelStyle\>\"", 
                    "]"}]}], ")"}], "&"}], "/@", "yellowvertices"}], ",", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"#", "\[Rule]", "Automatic"}], ")"}], "&"}], "/@",
                     " ", "bluevertices"}]}], "]"}]}], ",", 
                "\[IndentingNewLine]", 
                RowBox[{"VertexSize", "->", 
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{"NumberQ", "[", 
                    RowBox[{"OptionValue", "[", "\"\<Size Scaling\>\"", "]"}],
                     "]"}], ",", 
                   RowBox[{"Select", "[", 
                    RowBox[{"vs", ",", 
                    RowBox[{
                    RowBox[{"MemberQ", "[", 
                    RowBox[{"workingvertices", ",", " ", 
                    RowBox[{"First", "[", "#", "]"}]}], "]"}], "&"}]}], "]"}],
                    ",", "Automatic"}], "]"}]}], ",", "\[IndentingNewLine]", 
                RowBox[{"VertexStyle", "->", 
                 RowBox[{"Join", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"#", "->", " ", 
                    RowBox[{"Directive", "[", 
                    RowBox[{
                    RowBox[{"EdgeForm", "[", "None", "]"}], ",", "Blue", ",", 
                    
                    RowBox[{"Opacity", "[", "0.05", "]"}]}], "]"}]}], ")"}], 
                    "&"}], "/@", "bluevertices"}], ",", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"#", "->", " ", 
                    RowBox[{"Directive", "[", 
                    RowBox[{
                    RowBox[{"EdgeForm", "[", "None", "]"}], ",", "Yellow", 
                    ",", 
                    RowBox[{"Opacity", "[", "0.5", "]"}]}], "]"}]}], ")"}], 
                    "&"}], "/@", "yellowvertices"}]}], "]"}]}], " ", ",", 
                "\[IndentingNewLine]", 
                RowBox[{"VertexShapeFunction", "\[Rule]", 
                 RowBox[{"Join", "[", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"#", "\[Rule]", "  ", 
                    RowBox[{
                    "OptionValue", "[", " ", "\"\<HighlightShape\>\"", 
                    "]"}]}], "&"}], "/@", "yellowvertices"}], ")"}], ",", " ", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"#", "\[Rule]", " ", "Automatic"}], "&"}], "/@", 
                    "bluevertices"}], ")"}]}], "]"}]}], ",", 
                "\[IndentingNewLine]", 
                RowBox[{"EdgeWeight", "->", " ", 
                 RowBox[{"1", "+", " ", 
                  RowBox[{"Abs", "[", 
                   RowBox[{"workingmat", "[", "\"\<ExplicitValues\>\"", "]"}],
                    "]"}]}]}], ",", "\[IndentingNewLine]", 
                RowBox[{"EdgeStyle", "->", "es"}], ",", "\[IndentingNewLine]", 
                RowBox[{"EdgeShapeFunction", "\[Rule]", "ef1"}]}], "]"}], ",",
               "\[IndentingNewLine]", 
              RowBox[{"PlotRange", "->", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"centerpoint", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "+", 
                    RowBox[{
                    RowBox[{"pan", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "\[Delta]x"}], "-", " ", 
                    FractionBox["\[Delta]x", 
                    RowBox[{"10", "^", "logzoom"}]]}], ",", " ", 
                   RowBox[{
                    RowBox[{"centerpoint", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "+", 
                    RowBox[{
                    RowBox[{"pan", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "\[Delta]x"}], "+", 
                    FractionBox["\[Delta]x", 
                    RowBox[{"10", "^", "logzoom"}]]}]}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"centerpoint", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "+", 
                    RowBox[{
                    RowBox[{"pan", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "\[Delta]y"}], "-", " ", 
                    FractionBox["\[Delta]y", 
                    RowBox[{"10", "^", "logzoom"}]]}], ",", " ", 
                   RowBox[{
                    RowBox[{"centerpoint", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "+", 
                    RowBox[{
                    RowBox[{"pan", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "\[Delta]y"}], "+", " ", 
                    FractionBox["\[Delta]y", 
                    RowBox[{"10", "^", "logzoom"}]]}]}], "}"}]}], "}"}]}], 
              " ", ",", " ", 
              RowBox[{"ImageSize", "->", " ", "is"}]}], "]"}]}]}], "]"}], ",",
          "\[IndentingNewLine]", 
         RowBox[{"Row", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Column", "[", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Control", "[", 
                RowBox[{"{", 
                 RowBox[{"cutoff", ",", "q"}], "}"}], "]"}], ",", 
               RowBox[{"Control", "[", 
                RowBox[{"{", 
                 RowBox[{"positiveOnly", ",", " ", 
                  RowBox[{"{", 
                   RowBox[{"True", ",", " ", "False"}], "}"}]}], "}"}], "]"}],
                ",", 
               RowBox[{"Control", "[", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"logzoom", ",", "0", ",", "\"\<zoom\>\""}], "}"}], 
                  ",", 
                  RowBox[{"Log10", "[", "0.25", "]"}], ",", 
                  RowBox[{"Log10", "[", "5", "]"}]}], "}"}], "]"}], ",", 
               RowBox[{"Control", "[", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"is", ",", "400", ",", " ", "\"\<image size\>\""}],
                    "}"}], ",", "50", ",", " ", "8000"}], "}"}], "]"}]}], 
              "}"}], "]"}], ",", 
            RowBox[{"Column", "[", 
             RowBox[{"{", 
              RowBox[{"Control", "[", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"pan", ",", 
                   RowBox[{"{", 
                    RowBox[{"0", ",", "0"}], "}"}]}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "}"}], "]"}], 
              "}"}], "]"}]}], "}"}], "]"}]}], "\[IndentingNewLine]", "]"}]}], 
      "]"}]}]}], "]"}]}]}], "Input",
 CellChangeTimes->{{3.883201225917623*^9, 3.883201252950534*^9}, 
   3.883201312741091*^9, {3.883201353433324*^9, 3.883201356776845*^9}, {
   3.8832013868604097`*^9, 3.883201415990326*^9}, {3.88320144818403*^9, 
   3.88320154840558*^9}, {3.883201607596208*^9, 3.883201652551071*^9}, {
   3.883201735081502*^9, 3.883201760276821*^9}, {3.883201792247123*^9, 
   3.883201854214505*^9}, {3.883201903023486*^9, 3.883201948502438*^9}, {
   3.883201982379232*^9, 3.883202163799109*^9}, {3.88320221362753*^9, 
   3.883202249103838*^9}, {3.8832022871076307`*^9, 3.883202288909778*^9}, {
   3.8832023371793337`*^9, 3.883202340811707*^9}, {3.8832023743082457`*^9, 
   3.883202431693077*^9}, {3.883202468500141*^9, 3.88320266976005*^9}, {
   3.883202708257831*^9, 3.883202978973674*^9}, {3.883203054925151*^9, 
   3.8832031089850483`*^9}, {3.883203141792696*^9, 3.883203367773835*^9}, 
   3.8832034455933943`*^9, {3.8832035347446423`*^9, 3.88320357017616*^9}, {
   3.883203668084154*^9, 3.88320367245516*^9}, {3.883203846323085*^9, 
   3.883203983425969*^9}, {3.8832040438741007`*^9, 3.883204050312766*^9}, 
   3.883204088846979*^9, {3.883204159852405*^9, 3.8832042044107847`*^9}, 
   3.883204241687594*^9, {3.883204332773177*^9, 3.883204395146668*^9}, {
   3.8832044624210157`*^9, 3.883204474105771*^9}, {3.8832056240500298`*^9, 
   3.883205627334725*^9}, {3.8832059617569513`*^9, 3.883205962803083*^9}, 
   3.883206049712163*^9, {3.883207172073612*^9, 3.883207173828871*^9}, {
   3.8832072407561893`*^9, 3.8832072716757593`*^9}, 3.883207312580124*^9, {
   3.883207393058263*^9, 3.8832074009105*^9}, {3.88320744594241*^9, 
   3.8832074577279367`*^9}, {3.8832075672025557`*^9, 3.883207606940481*^9}, {
   3.883207810806254*^9, 3.883207873157489*^9}, {3.8832079255017023`*^9, 
   3.8832079636321774`*^9}, {3.8832082048300467`*^9, 
   3.8832082072434397`*^9}, {3.883210832870088*^9, 3.883210832950634*^9}, {
   3.883211060442213*^9, 3.883211109351589*^9}, {3.883211142542302*^9, 
   3.883211213519608*^9}, {3.883225110839889*^9, 3.883225140978795*^9}, {
   3.8832252389417953`*^9, 3.883225242574387*^9}, {3.883225298556458*^9, 
   3.883225301514381*^9}, {3.883225356806801*^9, 3.883225383761656*^9}, {
   3.883225555059163*^9, 3.883225557786159*^9}, {3.8832259080390863`*^9, 
   3.883225961714192*^9}, 3.883226035609137*^9, 3.883226088660104*^9, {
   3.883249065729739*^9, 3.883249070584437*^9}, {3.883249141509108*^9, 
   3.883249176458398*^9}, {3.8832504974169807`*^9, 3.8832505671774817`*^9}, {
   3.883250598586381*^9, 3.883250627329722*^9}, {3.883252553984827*^9, 
   3.883252557485589*^9}, {3.88325259242873*^9, 3.8832526018712177`*^9}, 
   3.883252948681991*^9, {3.883253005238302*^9, 3.883253012762748*^9}, {
   3.883253057183381*^9, 3.883253148300898*^9}, {3.883253554767707*^9, 
   3.883253564568516*^9}, {3.8832536251542997`*^9, 3.8832536779577093`*^9}, {
   3.883253709001761*^9, 3.883253719283688*^9}, {3.8832537841675873`*^9, 
   3.8832538190993757`*^9}, {3.883253862292984*^9, 3.883253862681231*^9}, {
   3.8832982338722153`*^9, 3.883298255934463*^9}, {3.883486871092332*^9, 
   3.883486955315319*^9}, {3.883487056777437*^9, 3.883487118068801*^9}, 
   3.883487386526026*^9, {3.88358582587306*^9, 3.8835858544839897`*^9}, {
   3.883585955069922*^9, 3.88358600908314*^9}, {3.884091957879158*^9, 
   3.8840919845850353`*^9}, {3.884191297066621*^9, 3.8841912975822783`*^9}, {
   3.8843696278787622`*^9, 3.884369628929069*^9}, {3.884373951661519*^9, 
   3.884373967691248*^9}, {3.8843741177576427`*^9, 3.884374207832416*^9}, {
   3.884374272457116*^9, 3.884374320009658*^9}, {3.884374354486763*^9, 
   3.884374360525839*^9}, {3.884374518123103*^9, 3.88437460541232*^9}, {
   3.884652673885385*^9, 3.8846526810256367`*^9}, {3.885688962025586*^9, 
   3.885688976756542*^9}, {3.8857412903937893`*^9, 3.885741315490507*^9}, {
   3.885741512415859*^9, 3.885741518627851*^9}, {3.885741686736668*^9, 
   3.8857417052192373`*^9}},
 Background->RGBColor[1, 1, 0],
 CellLabel->
  "In[106]:=",ExpressionUUID->"c3468fe6-c60c-4841-8a4a-7c98cf15a8e9"]
}, Closed]],

Cell[CellGroupData[{

Cell["NewPlotSingle", "Subsubsection",
 CellChangeTimes->{{3.884515656744285*^9, 
  3.884515660167211*^9}},ExpressionUUID->"659368af-ce92-4dca-ba1b-\
8d5782bc9930"],

Cell["\<\
This is a simpler form of \[OpenCurlyDoubleQuote]NewPlot\
\[CloseCurlyDoubleQuote], where one explicitly gives an equivalent PCC cutoff \
for correlations that should be shown.  As with NewPlot one can include an \
expression dataset if one wants to scale the vertex sizes to gene expression. \
 Many options allow for adjustments to how things are displayed.  \
\>", "Text",
 CellChangeTimes->{{3.906465200099597*^9, 
  3.906465309138502*^9}},ExpressionUUID->"dbc55a1b-38a8-492c-b576-\
f40b166283f1"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "NewPlotSingle", "]"}], "=", 
    RowBox[{"{", " ", 
     RowBox[{
      RowBox[{"\"\<Show Graph\>\"", "->", " ", "True"}], ",", 
      RowBox[{"\"\<Highlight\>\"", "->", " ", 
       RowBox[{"{", "}"}]}], ",", " ", 
      RowBox[{"\"\<Layout\>\"", "->", " ", "\"\<SpringEmbedding\>\""}], ",", 
      " ", 
      RowBox[{"\"\<Size Scaling\>\"", "->", " ", "25"}], ",", " ", 
      RowBox[{"\"\<Automatic Partitioning\>\"", "->", " ", "True"}], ",", 
      RowBox[{"\"\<Vertex Labeling\>\"", "->", " ", "True"}], ",", 
      RowBox[{"\"\<LabelColor\>\"", "->", " ", "Black"}], ",", "  ", 
      RowBox[{"\"\<LabelSize\>\"", "->", "Automatic"}], ",", "  ", 
      RowBox[{"\"\<HighlightLabelColor\>\"", "->", " ", "Blue"}], ",", 
      RowBox[{"\"\<HighlightLabelSize\>\"", "->", "Larger"}], ",", 
      RowBox[{"\"\<FontSizeScaling\>\"", "->", "2"}], ",", " ", 
      RowBox[{"\"\<HighlightShape\>\"", "->", " ", "\"\<Square\>\""}], ",", 
      RowBox[{"\"\<HighlightColor\>\"", "->", " ", "Yellow"}], ",", " ", 
      RowBox[{"\"\<Base Vertex Opacity\>\"", "->", " ", "0.05"}], ",", 
      RowBox[{"\"\<Positive Only\>\"", "->", " ", "True"}], ",", 
      RowBox[{"\"\<GreenOpacity\>\"", "->", " ", "0.5"}], ",", " ", 
      RowBox[{"\"\<PinkOpacity\>\"", "->", "0.5"}], " ", ",", 
      RowBox[{"\"\<EdgeThickness\>\"", "->", " ", "0.003"}], ",", " ", 
      RowBox[{"ImageSize", "->", " ", "Automatic"}], ",", 
      RowBox[{"\"\<Zoom In\>\"", "->", " ", "1"}], ",", " ", 
      RowBox[{"\"\<Pan x\>\"", "->", " ", "0"}], ",", " ", 
      RowBox[{"\"\<Pan y\>\"", "->", " ", "0"}]}], "}"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ef1", "[", 
     RowBox[{"el_", ",", "___"}], "]"}], ":=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"Arrowheads", "[", "0", "]"}], ",", 
      RowBox[{"Arrow", "[", 
       RowBox[{"el", ",", "0"}], "]"}]}], "}"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"NewPlotSingle", "[", 
     RowBox[{"gNO_", ",", " ", "genes_", ",", "cutoff_", ",", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
    "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"gno", "=", 
         RowBox[{"GeneSubsetGNO", "[", 
          RowBox[{"gNO", ",", " ", 
           RowBox[{"Flatten", "[", "genes", "]"}], ",", " ", 
           RowBox[{"\"\<Purge\>\"", "->", " ", "True"}]}], "]"}]}], ",", " ", 
        "fullmat", ",", "posmatrix", ",", "posposns", ",", " ", "posplot", 
        ",", " ", "vertexcoords", ",", " ", "allyellowvertices", ",", " ", 
        "allvertexlabels", ",", "alllabelsizes", ",", " ", "vertexsizes", ",",
         "workingmat", ",", "es", ",", " ", "workingvertices", ",", " ", 
        "yellowvertices", ",", "bluevertices", ",", " ", "newvertexcoords", 
        ",", "newvertexlabels", ",", "datarange", ",", "centerpoint", ",", 
        "\[Delta]x", ",", "\[Delta]y", ",", " ", "newallposns", ",", 
        "newnegposns", ",", "  ", "greenedges", ",", " ", "rededges", ",", 
        "cp"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"fullmat", "=", 
        RowBox[{"gno", "[", 
         RowBox[{"[", "3", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"posmatrix", "=", " ", 
        RowBox[{"SparseArray", "[", 
         RowBox[{"BoolEval", "[", 
          RowBox[{"fullmat", ">", "0"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"posposns", " ", "=", " ", 
        RowBox[{"Sort", "[", 
         RowBox[{"Union", "[", 
          RowBox[{"Flatten", "[", 
           RowBox[{"posmatrix", "[", "\"\<ExplicitPositions\>\"", "]"}], 
           "]"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"posplot", "=", 
        RowBox[{"UndirectedGraph", "[", 
         RowBox[{"AdjacencyGraph", "[", 
          RowBox[{"posmatrix", ",", 
           RowBox[{"GraphLayout", "->", 
            RowBox[{"OptionValue", "[", "\"\<Layout\>\"", "]"}]}]}], "]"}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"vertexcoords", " ", "=", " ", 
        RowBox[{"Thread", "[", 
         RowBox[{"posposns", "->", " ", 
          RowBox[{
           RowBox[{"GraphEmbedding", "[", "posplot", "]"}], "[", 
           RowBox[{"[", "posposns", "]"}], "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"allyellowvertices", "=", " ", 
        RowBox[{"Flatten", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Position", "[", 
            RowBox[{
             RowBox[{"gno", "[", 
              RowBox[{"[", "2", "]"}], "]"}], ",", "#"}], "]"}], "&"}], "/@", 
          
          RowBox[{"OptionValue", "[", "\"\<Highlight\>\"", "]"}]}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"allvertexlabels", "=", 
        RowBox[{"Thread", "[", 
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"Length", "[", 
            RowBox[{"gno", "[", 
             RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], "->", "  ", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"Placed", "[", 
              RowBox[{"#", ",", "Center"}], "]"}], "&"}], "/@", 
            RowBox[{"gno", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], ")"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"alllabelsizes", "=", 
        RowBox[{"Thread", "[", 
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"Length", "[", 
            RowBox[{"gno", "[", 
             RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], "->", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"#", "&"}], "/@", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"OptionValue", "[", "\"\<FontSizeScaling\>\"", "]"}], 
              "*", 
              RowBox[{
              "OptionValue", "[", " ", "\"\<Size Scaling\>\"", "]"}]}], 
             ")"}]}], ")"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"OptionValue", "[", "\"\<Positive Only\>\"", "]"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"workingmat", " ", "=", "  ", 
           RowBox[{"SparseArray", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"BoolEval", "[", 
               RowBox[{"fullmat", ">", "cutoff"}], "]"}], "*", "fullmat"}], 
             ",", " ", 
             RowBox[{"Dimensions", "[", "fullmat", "]"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"rededges", "=", 
           RowBox[{"{", "}"}]}], ";", 
          RowBox[{"greenedges", "=", 
           RowBox[{"EdgeList", "[", 
            RowBox[{"Graph", "[", 
             RowBox[{"workingmat", "[", "\"\<ExplicitPositions\>\"", "]"}], 
             "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"es", " ", "=", 
           RowBox[{"Directive", "[", 
            RowBox[{"{", 
             RowBox[{"Green", ",", " ", 
              RowBox[{"Opacity", "[", 
               RowBox[{"OptionValue", "[", "\"\<GreenOpacity\>\"", "]"}], 
               "]"}], ",", " ", 
              RowBox[{"Thickness", "[", 
               RowBox[{"OptionValue", "[", "\"\<EdgeThickness\>\"", "]"}], 
               "]"}]}], "}"}], "]"}]}]}], " ", ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"workingmat", " ", "=", " ", 
           RowBox[{"SparseArray", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"BoolEval", "[", 
               RowBox[{
                RowBox[{"Abs", "[", "fullmat", "]"}], ">", "cutoff"}], "]"}], 
              "*", "fullmat"}], ",", " ", 
             RowBox[{"Dimensions", "[", "fullmat", "]"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"rededges", "=", 
           RowBox[{"EdgeList", "[", 
            RowBox[{"Graph", "[", 
             RowBox[{
              RowBox[{"SparseArray", "[", 
               RowBox[{"BoolEval", "[", 
                RowBox[{"workingmat", "<", "0"}], "]"}], "]"}], "[", 
              "\"\<ExplicitPositions\>\"", "]"}], "]"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"greenedges", "=", 
           RowBox[{"EdgeList", "[", 
            RowBox[{"Graph", "[", 
             RowBox[{
              RowBox[{"SparseArray", "[", 
               RowBox[{"BoolEval", "[", 
                RowBox[{"workingmat", ">", "0"}], "]"}], "]"}], "[", 
              "\"\<ExplicitPositions\>\"", "]"}], "]"}], "]"}]}], ";", " ", 
          "\[IndentingNewLine]", 
          RowBox[{"es", " ", "=", " ", 
           RowBox[{"Join", "[", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"#", "->", " ", 
                 RowBox[{"Directive", "[", 
                  RowBox[{"{", 
                   RowBox[{"Green", ",", " ", 
                    RowBox[{"Opacity", "[", 
                    RowBox[{"OptionValue", "[", "\"\<GreenOpacity\>\"", "]"}],
                     "]"}], ",", " ", 
                    RowBox[{"Thickness", "[", 
                    RowBox[{
                    "OptionValue", "[", "\"\<EdgeThickness\>\"", "]"}], 
                    "]"}]}], "}"}], "]"}]}], "&"}], "/@", "greenedges"}], 
              ")"}], ",", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"#", "->", " ", 
                 RowBox[{"Directive", "[", 
                  RowBox[{"{", 
                   RowBox[{"Pink", ",", " ", 
                    RowBox[{"Opacity", "[", 
                    RowBox[{"OptionValue", "[", "\"\<PinkOpacity\>\"", "]"}], 
                    "]"}], ",", " ", 
                    RowBox[{"Thickness", "[", 
                    RowBox[{
                    "OptionValue", "[", "\"\<EdgeThickness\>\"", "]"}], 
                    "]"}]}], "}"}], "]"}]}], "&"}], "/@", "rededges"}], 
              ")"}]}], "]"}]}]}]}], " ", "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"workingvertices", "=", 
        RowBox[{"Sort", "[", 
         RowBox[{"Union", "[", 
          RowBox[{"Flatten", "[", 
           RowBox[{"workingmat", "[", "\"\<ExplicitPositions\>\"", "]"}], 
           "]"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", "\t", 
       RowBox[{"yellowvertices", "=", 
        RowBox[{"Intersection", "[", 
         RowBox[{"workingvertices", ",", " ", "allyellowvertices"}], "]"}]}], 
       ";", "\[IndentingNewLine]", "\t", 
       RowBox[{"bluevertices", "=", " ", 
        RowBox[{"Complement", "[", 
         RowBox[{"workingvertices", ",", " ", "yellowvertices"}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"newvertexcoords", " ", "=", " ", 
        RowBox[{"Select", "[", 
         RowBox[{"vertexcoords", ",", " ", 
          RowBox[{
           RowBox[{"MemberQ", "[", 
            RowBox[{"workingvertices", ",", " ", 
             RowBox[{"First", "[", "#", "]"}]}], "]"}], "&"}]}], "]"}]}], ";",
        "\[IndentingNewLine]", 
       RowBox[{"newvertexlabels", "=", 
        RowBox[{"Select", "[", 
         RowBox[{"allvertexlabels", ",", " ", 
          RowBox[{
           RowBox[{"MemberQ", "[", 
            RowBox[{"workingvertices", ",", " ", 
             RowBox[{"First", "[", "#", "]"}]}], "]"}], "&"}]}], "]"}]}], ";",
        "\[IndentingNewLine]", 
       RowBox[{"datarange", "=", 
        RowBox[{"MinMax", "/@", 
         RowBox[{"Transpose", "[", 
          RowBox[{"Values", "[", "vertexcoords", "]"}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"centerpoint", "=", 
        RowBox[{"Mean", "/@", "datarange"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"\[Delta]x", ",", "\[Delta]y"}], "}"}], "=", 
        RowBox[{
         RowBox[{"Last", "/@", "datarange"}], " ", "-", " ", 
         "centerpoint"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"OptionValue", "[", "\"\<Show Graph\>\"", "]"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Print", "[", 
           RowBox[{"First", "/@", 
            RowBox[{"Values", "[", "newvertexlabels", "]"}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"GraphPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Graph", "[", 
             RowBox[{
              RowBox[{"workingmat", "[", "\"\<ExplicitPositions\>\"", "]"}], 
              ",", "\[IndentingNewLine]", 
              RowBox[{"VertexCoordinates", "->", "newvertexcoords"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"VertexLabels", "->", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{"OptionValue", "[", "\"\<Vertex Labeling\>\"", "]"}],
                  ",", " ", "newvertexlabels", ",", "None"}], "]"}]}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"VertexLabelStyle", "\[Rule]", " ", 
               RowBox[{"Join", "[", 
                RowBox[{
                 RowBox[{"Thread", "[", 
                  RowBox[{"yellowvertices", "->", " ", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Directive", "[", 
                    RowBox[{
                    RowBox[{
                    "OptionValue", "[", "\"\<HighlightLabelColor\>\"", "]"}], 
                    ",", "#"}], "]"}], "&"}], "/@", 
                    RowBox[{"(", 
                    RowBox[{"yellowvertices", "/.", "alllabelsizes"}], 
                    ")"}]}], ")"}]}], "]"}], ",", 
                 RowBox[{"Thread", "[", 
                  RowBox[{"bluevertices", "->", " ", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Directive", "[", 
                    RowBox[{
                    RowBox[{"OptionValue", "[", "\"\<LabelColor\>\"", "]"}], 
                    ",", "#"}], "]"}], "&"}], "/@", 
                    RowBox[{"(", 
                    RowBox[{"bluevertices", "/.", "alllabelsizes"}], ")"}]}], 
                    ")"}]}], "]"}]}], "]"}]}], ",", "\[IndentingNewLine]", 
              RowBox[{"VertexSize", "->", "\[IndentingNewLine]", 
               RowBox[{"Which", "[", 
                RowBox[{
                 RowBox[{"NumberQ", "[", 
                  RowBox[{"OptionValue", "[", "\"\<Size Scaling\>\"", "]"}], 
                  "]"}], ",", 
                 RowBox[{"OptionValue", "[", "\"\<Size Scaling\>\"", "]"}], 
                 ",", "\[IndentingNewLine]", 
                 RowBox[{"ListQ", "[", 
                  RowBox[{"OptionValue", "[", "\"\<Size Scaling\>\"", "]"}], 
                  "]"}], ",", 
                 RowBox[{"Select", "[", 
                  RowBox[{
                   RowBox[{"Thread", "[", 
                    RowBox[{
                    RowBox[{"Range", "[", 
                    RowBox[{"Length", "[", 
                    RowBox[{"gno", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "]"}], " ", "]"}], "->", 
                    " ", 
                    RowBox[{
                    "OptionValue", "[", "\"\<Size Scaling\>\"", "]"}]}], 
                    "]"}], ",", 
                   RowBox[{
                    RowBox[{"MemberQ", "[", 
                    RowBox[{"workingvertices", ",", " ", 
                    RowBox[{"First", "[", "#", "]"}]}], "]"}], "&"}]}], "]"}],
                  ",", "True", ",", "Automatic"}], "]"}]}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"VertexStyle", "->", 
               RowBox[{"Join", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{"#", "->", " ", 
                    RowBox[{"Directive", "[", 
                    RowBox[{
                    RowBox[{"EdgeForm", "[", "None", "]"}], ",", "Blue", ",", 
                    
                    RowBox[{"Opacity", "[", 
                    RowBox[{
                    "OptionValue", "[", "\"\<Base Vertex Opacity\>\"", "]"}], 
                    "]"}]}], "]"}]}], ")"}], "&"}], "/@", "bluevertices"}], 
                 ",", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{"#", "->", " ", 
                    RowBox[{"Directive", "[", 
                    RowBox[{
                    RowBox[{"EdgeForm", "[", "None", "]"}], ",", 
                    RowBox[{
                    "OptionValue", "[", "\"\<HighlightColor\>\"", "]"}], ",", 
                    
                    RowBox[{"Opacity", "[", "0.5", "]"}]}], "]"}]}], ")"}], 
                   "&"}], "/@", "yellowvertices"}]}], "]"}]}], " ", ",", 
              "\[IndentingNewLine]", 
              RowBox[{"VertexShapeFunction", "\[Rule]", 
               RowBox[{"Join", "[", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"#", "\[Rule]", "  ", 
                    RowBox[{
                    "OptionValue", "[", " ", "\"\<HighlightShape\>\"", 
                    "]"}]}], "&"}], "/@", "yellowvertices"}], ")"}], ",", " ", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"#", "\[Rule]", " ", "Automatic"}], "&"}], "/@", 
                   "bluevertices"}], ")"}]}], "]"}]}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"EdgeStyle", "->", "es"}], ",", "\[IndentingNewLine]", 
              RowBox[{"EdgeShapeFunction", "\[Rule]", "ef1"}]}], "]"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"PlotRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{
                  RowBox[{"centerpoint", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "+", 
                  RowBox[{
                   RowBox[{"OptionValue", "[", "\"\<Pan x\>\"", "]"}], 
                   "\[Delta]x"}], "-", " ", 
                  FractionBox["\[Delta]x", 
                   RowBox[{"OptionValue", "[", "\"\<Zoom In\>\"", "]"}]]}], 
                 ",", " ", 
                 RowBox[{
                  RowBox[{"centerpoint", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "+", 
                  RowBox[{
                   RowBox[{"OptionValue", "[", "\"\<Pan x\>\"", "]"}], 
                   "\[Delta]x"}], "+", 
                  FractionBox["\[Delta]x", 
                   RowBox[{"OptionValue", "[", "\"\<Zoom In\>\"", "]"}]]}]}], 
                "}"}], ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{
                  RowBox[{"centerpoint", "[", 
                   RowBox[{"[", "2", "]"}], "]"}], "+", 
                  RowBox[{
                   RowBox[{"OptionValue", "[", "\"\<Pan y\>\"", "]"}], 
                   "\[Delta]y"}], "-", " ", 
                  FractionBox["\[Delta]y", 
                   RowBox[{"OptionValue", "[", "\"\<Zoom In\>\"", "]"}]]}], 
                 ",", " ", 
                 RowBox[{
                  RowBox[{"centerpoint", "[", 
                   RowBox[{"[", "2", "]"}], "]"}], "+", 
                  RowBox[{
                   RowBox[{"OptionValue", "[", "\"\<Pan y\>\"", "]"}], 
                   "\[Delta]y"}], "+", " ", 
                  FractionBox["\[Delta]y", 
                   RowBox[{"OptionValue", "[", "\"\<Zoom In\>\"", "]"}]]}]}], 
                "}"}]}], "}"}]}], " ", ",", " ", 
            RowBox[{"ImageSize", "->", " ", 
             RowBox[{"OptionValue", "[", "ImageSize", "]"}]}]}], "]"}]}], ",", 
         RowBox[{"First", "/@", 
          RowBox[{"Values", "[", "newvertexlabels", "]"}]}]}], "]"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"NewPlotSingle", "[", 
   RowBox[{
   "gNO_", ",", " ", "genes_", ",", "expressiondata_", ",", "cutoff_", ",", 
    " ", 
    RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
  "\[IndentingNewLine]", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"gno", "=", 
       RowBox[{"GeneSubsetGNO", "[", 
        RowBox[{"gNO", ",", " ", 
         RowBox[{"Flatten", "[", "genes", "]"}], ",", " ", 
         RowBox[{"\"\<Purge\>\"", "->", " ", "True"}]}], "]"}]}], ",", " ", 
      "fullmat", ",", "posmatrix", ",", "posposns", ",", " ", "posplot", ",", 
      " ", "vertexcoords", ",", " ", "allyellowvertices", ",", " ", 
      "allvertexlabels", ",", " ", "vertexsizes", ",", "workingmat", ",", 
      "es", ",", " ", "workingvertices", ",", " ", "yellowvertices", ",", 
      "bluevertices", ",", " ", "newvertexcoords", ",", "newvertexlabels", 
      ",", "datarange", ",", "centerpoint", ",", "\[Delta]x", ",", 
      "\[Delta]y", ",", " ", "newallposns", ",", "newnegposns", ",", "  ", 
      "greenedges", ",", " ", "rededges", ",", "cp", ",", " ", "ls", ",", " ",
       "hls"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"fullmat", "=", 
      RowBox[{"gno", "[", 
       RowBox[{"[", "3", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"posmatrix", "=", " ", 
      RowBox[{"SparseArray", "[", 
       RowBox[{"BoolEval", "[", 
        RowBox[{"fullmat", ">", "0"}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"posposns", " ", "=", " ", 
      RowBox[{"Sort", "[", 
       RowBox[{"Union", "[", 
        RowBox[{"Flatten", "[", 
         RowBox[{"posmatrix", "[", "\"\<ExplicitPositions\>\"", "]"}], "]"}], 
        "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"posplot", "=", 
      RowBox[{"UndirectedGraph", "[", 
       RowBox[{"AdjacencyGraph", "[", 
        RowBox[{"posmatrix", ",", 
         RowBox[{"GraphLayout", "->", 
          RowBox[{"OptionValue", "[", "\"\<Layout\>\"", "]"}]}]}], "]"}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"vertexcoords", " ", "=", " ", 
      RowBox[{"Thread", "[", 
       RowBox[{"posposns", "->", " ", 
        RowBox[{
         RowBox[{"GraphEmbedding", "[", "posplot", "]"}], "[", 
         RowBox[{"[", "posposns", "]"}], "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"vertexsizes", "=", "\[IndentingNewLine]", 
      RowBox[{"Which", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"NumberQ", "[", 
         RowBox[{"OptionValue", "[", "\"\<Size Scaling\>\"", "]"}], "]"}], 
        ",", 
        RowBox[{"Thread", "[", 
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"Length", "[", 
            RowBox[{"gno", "[", 
             RowBox[{"[", "2", "]"}], "]"}], "]"}], " ", "]"}], "->", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"OptionValue", "[", "\"\<Size Scaling\>\"", "]"}], 
              SqrtBox[
               RowBox[{"expressiondata", "[", "#", "]"}]]}], "&"}], "/@", 
            RowBox[{"gno", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], ")"}]}], "]"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"ListQ", "[", 
         RowBox[{"OptionValue", "[", "\"\<Size Scaling\>\"", "]"}], "]"}], 
        ",", 
        RowBox[{"Thread", "[", 
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"Length", "[", 
            RowBox[{"gno", "[", 
             RowBox[{"[", "2", "]"}], "]"}], "]"}], " ", "]"}], "->", 
          RowBox[{"OptionValue", "[", "\"\<Size Scaling\>\"", "]"}]}], "]"}], 
        ",", "\[IndentingNewLine]", "True", ",", 
        RowBox[{"{", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"allyellowvertices", "=", " ", 
      RowBox[{"Flatten", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Position", "[", 
          RowBox[{
           RowBox[{"gno", "[", 
            RowBox[{"[", "2", "]"}], "]"}], ",", "#"}], "]"}], "&"}], "/@", 
        RowBox[{"OptionValue", "[", "\"\<Highlight\>\"", "]"}]}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"allvertexlabels", "=", 
      RowBox[{"Thread", "[", 
       RowBox[{
        RowBox[{"Range", "[", 
         RowBox[{"Length", "[", 
          RowBox[{"gno", "[", 
           RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], "->", "  ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"Placed", "[", 
            RowBox[{"#", ",", "Center"}], "]"}], "&"}], "/@", 
          RowBox[{"gno", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}], ")"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"OptionValue", "[", "\"\<Positive Only\>\"", "]"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"workingmat", " ", "=", "  ", 
         RowBox[{"SparseArray", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"BoolEval", "[", 
             RowBox[{"fullmat", ">", "cutoff"}], "]"}], "*", "fullmat"}], ",",
            " ", 
           RowBox[{"Dimensions", "[", "fullmat", "]"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"rededges", "=", 
         RowBox[{"{", "}"}]}], ";", 
        RowBox[{"greenedges", "=", 
         RowBox[{"EdgeList", "[", 
          RowBox[{"Graph", "[", 
           RowBox[{"workingmat", "[", "\"\<ExplicitPositions\>\"", "]"}], 
           "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"es", " ", "=", 
         RowBox[{"Directive", "[", 
          RowBox[{"{", 
           RowBox[{"Green", ",", " ", 
            RowBox[{"Opacity", "[", 
             RowBox[{"OptionValue", "[", "\"\<GreenOpacity\>\"", "]"}], "]"}],
             ",", " ", 
            RowBox[{"Thickness", "[", 
             RowBox[{"OptionValue", "[", "\"\<EdgeThickness\>\"", "]"}], 
             "]"}]}], "}"}], "]"}]}]}], " ", ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"workingmat", " ", "=", " ", 
         RowBox[{"SparseArray", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"BoolEval", "[", 
             RowBox[{
              RowBox[{"Abs", "[", "fullmat", "]"}], ">", "cutoff"}], "]"}], 
            "*", "fullmat"}], ",", " ", 
           RowBox[{"Dimensions", "[", "fullmat", "]"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"rededges", "=", 
         RowBox[{"EdgeList", "[", 
          RowBox[{"Graph", "[", 
           RowBox[{
            RowBox[{"SparseArray", "[", 
             RowBox[{"BoolEval", "[", 
              RowBox[{"workingmat", "<", "0"}], "]"}], "]"}], "[", 
            "\"\<ExplicitPositions\>\"", "]"}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"greenedges", "=", 
         RowBox[{"EdgeList", "[", 
          RowBox[{"Graph", "[", 
           RowBox[{
            RowBox[{"SparseArray", "[", 
             RowBox[{"BoolEval", "[", 
              RowBox[{"workingmat", ">", "0"}], "]"}], "]"}], "[", 
            "\"\<ExplicitPositions\>\"", "]"}], "]"}], "]"}]}], ";", " ", 
        "\[IndentingNewLine]", 
        RowBox[{"es", " ", "=", " ", 
         RowBox[{"Join", "[", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{"#", "->", " ", 
               RowBox[{"Directive", "[", 
                RowBox[{"{", 
                 RowBox[{"Green", ",", " ", 
                  RowBox[{"Opacity", "[", 
                   RowBox[{"OptionValue", "[", "\"\<GreenOpacity\>\"", "]"}], 
                   "]"}], ",", " ", 
                  RowBox[{"Thickness", "[", 
                   RowBox[{"OptionValue", "[", "\"\<EdgeThickness\>\"", "]"}],
                    "]"}]}], "}"}], "]"}]}], "&"}], "/@", "greenedges"}], 
            ")"}], ",", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{"#", "->", " ", 
               RowBox[{"Directive", "[", 
                RowBox[{"{", 
                 RowBox[{"Pink", ",", " ", 
                  RowBox[{"Opacity", "[", 
                   RowBox[{"OptionValue", "[", "\"\<PinkOpacity\>\"", "]"}], 
                   "]"}], ",", " ", 
                  RowBox[{"Thickness", "[", 
                   RowBox[{"OptionValue", "[", "\"\<EdgeThickness\>\"", "]"}],
                    "]"}]}], "}"}], "]"}]}], "&"}], "/@", "rededges"}], 
            ")"}]}], "]"}]}]}]}], " ", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"workingvertices", "=", 
      RowBox[{"Sort", "[", 
       RowBox[{"Union", "[", 
        RowBox[{"Flatten", "[", 
         RowBox[{"workingmat", "[", "\"\<ExplicitPositions\>\"", "]"}], "]"}],
         "]"}], "]"}]}], ";", "\[IndentingNewLine]", "\t", 
     RowBox[{"yellowvertices", "=", 
      RowBox[{"Intersection", "[", 
       RowBox[{"workingvertices", ",", " ", "allyellowvertices"}], "]"}]}], 
     ";", "\[IndentingNewLine]", "\t", 
     RowBox[{"bluevertices", "=", " ", 
      RowBox[{"Complement", "[", 
       RowBox[{"workingvertices", ",", " ", "yellowvertices"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"ls", " ", "=", 
      RowBox[{"Directive", "[", 
       RowBox[{
        RowBox[{"OptionValue", "[", "\"\<LabelColor\>\"", "]"}], ",", " ", 
        RowBox[{"OptionValue", "[", "\"\<LabelSize\>\"", "]"}]}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"hls", "=", 
      RowBox[{"Directive", "[", 
       RowBox[{
        RowBox[{"OptionValue", "[", "\"\<HighlightLabelColor\>\"", "]"}], ",",
         " ", 
        RowBox[{"OptionValue", "[", "\"\<HighlightLabelSize\>\"", "]"}]}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"newvertexcoords", " ", "=", " ", 
      RowBox[{"Select", "[", 
       RowBox[{"vertexcoords", ",", " ", 
        RowBox[{
         RowBox[{"MemberQ", "[", 
          RowBox[{"workingvertices", ",", " ", 
           RowBox[{"First", "[", "#", "]"}]}], "]"}], "&"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"newvertexlabels", "=", 
      RowBox[{"Select", "[", 
       RowBox[{"allvertexlabels", ",", " ", 
        RowBox[{
         RowBox[{"MemberQ", "[", 
          RowBox[{"workingvertices", ",", " ", 
           RowBox[{"First", "[", "#", "]"}]}], "]"}], "&"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"datarange", "=", 
      RowBox[{"MinMax", "/@", 
       RowBox[{"Transpose", "[", 
        RowBox[{"Values", "[", "vertexcoords", "]"}], "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"centerpoint", "=", 
      RowBox[{"Mean", "/@", "datarange"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"\[Delta]x", ",", "\[Delta]y"}], "}"}], "=", 
      RowBox[{
       RowBox[{"Last", "/@", "datarange"}], " ", "-", " ", "centerpoint"}]}], 
     ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"OptionValue", "[", "\"\<Show Graph\>\"", "]"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Print", "[", 
         RowBox[{"First", "/@", 
          RowBox[{"Values", "[", "newvertexlabels", "]"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"GraphPlot", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Graph", "[", 
           RowBox[{
            RowBox[{"workingmat", "[", "\"\<ExplicitPositions\>\"", "]"}], 
            ",", "\[IndentingNewLine]", 
            RowBox[{"VertexCoordinates", "->", "newvertexcoords"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"VertexLabels", "->", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"OptionValue", "[", "\"\<Vertex Labeling\>\"", "]"}], 
               ",", " ", "newvertexlabels", ",", "None"}], "]"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"VertexLabelStyle", "\[Rule]", " ", 
             RowBox[{"Join", "[", " ", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"#", "\[Rule]", "hls"}], ")"}], "&"}], "/@", 
                "yellowvertices"}], ",", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"#", "\[Rule]", "ls"}], ")"}], "&"}], "/@", " ", 
                "bluevertices"}]}], "]"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"VertexSize", "->", "\[IndentingNewLine]", 
             RowBox[{"Which", "[", 
              RowBox[{
               RowBox[{"NumberQ", "[", 
                RowBox[{"OptionValue", "[", "\"\<Size Scaling\>\"", "]"}], 
                "]"}], ",", 
               RowBox[{"Select", "[", 
                RowBox[{
                 RowBox[{"Thread", "[", 
                  RowBox[{
                   RowBox[{"Range", "[", 
                    RowBox[{"Length", "[", 
                    RowBox[{"gno", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "]"}], " ", "]"}], "->", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"OptionValue", "[", "\"\<Size Scaling\>\"", "]"}], 
                    SqrtBox[
                    RowBox[{"expressiondata", "[", "#", "]"}]]}], "&"}], "/@", 
                    RowBox[{"gno", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], ")"}]}], "]"}], ",", 
                 RowBox[{
                  RowBox[{"MemberQ", "[", 
                   RowBox[{"workingvertices", ",", " ", 
                    RowBox[{"First", "[", "#", "]"}]}], "]"}], "&"}]}], "]"}],
                ",", "\[IndentingNewLine]", 
               RowBox[{"ListQ", "[", 
                RowBox[{"OptionValue", "[", "\"\<Size Scaling\>\"", "]"}], 
                "]"}], ",", 
               RowBox[{"Select", "[", 
                RowBox[{
                 RowBox[{"Thread", "[", 
                  RowBox[{
                   RowBox[{"Range", "[", 
                    RowBox[{"Length", "[", 
                    RowBox[{"gno", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "]"}], " ", "]"}], "->", 
                   " ", 
                   RowBox[{
                   "OptionValue", "[", "\"\<Size Scaling\>\"", "]"}]}], "]"}],
                  ",", 
                 RowBox[{
                  RowBox[{"MemberQ", "[", 
                   RowBox[{"workingvertices", ",", " ", 
                    RowBox[{"First", "[", "#", "]"}]}], "]"}], "&"}]}], "]"}],
                ",", "True", ",", "Automatic"}], "]"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"VertexStyle", "->", 
             RowBox[{"Join", "[", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"#", "->", " ", 
                   RowBox[{"Directive", "[", 
                    RowBox[{
                    RowBox[{"EdgeForm", "[", "None", "]"}], ",", "Blue", ",", 
                    
                    RowBox[{"Opacity", "[", 
                    RowBox[{
                    "OptionValue", "[", "\"\<Base Vertex Opacity\>\"", "]"}], 
                    "]"}]}], "]"}]}], ")"}], "&"}], "/@", "bluevertices"}], 
               ",", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"#", "->", " ", 
                   RowBox[{"Directive", "[", 
                    RowBox[{
                    RowBox[{"EdgeForm", "[", "None", "]"}], ",", 
                    RowBox[{
                    "OptionValue", "[", "\"\<HighlightColor\>\"", "]"}], ",", 
                    
                    RowBox[{"Opacity", "[", "0.5", "]"}]}], "]"}]}], ")"}], 
                 "&"}], "/@", "yellowvertices"}]}], "]"}]}], " ", ",", 
            "\[IndentingNewLine]", 
            RowBox[{"VertexShapeFunction", "\[Rule]", 
             RowBox[{"Join", "[", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{"#", "\[Rule]", "  ", 
                   RowBox[{
                   "OptionValue", "[", " ", "\"\<HighlightShape\>\"", "]"}]}],
                   "&"}], "/@", "yellowvertices"}], ")"}], ",", " ", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{"#", "\[Rule]", " ", "Automatic"}], "&"}], "/@", 
                 "bluevertices"}], ")"}]}], "]"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"EdgeStyle", "->", "es"}], ",", "\[IndentingNewLine]", 
            RowBox[{"EdgeShapeFunction", "\[Rule]", "ef1"}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"PlotRange", "->", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{"centerpoint", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "+", 
                RowBox[{
                 RowBox[{"OptionValue", "[", "\"\<Pan x\>\"", "]"}], 
                 "\[Delta]x"}], "-", " ", 
                FractionBox["\[Delta]x", 
                 RowBox[{"OptionValue", "[", "\"\<Zoom In\>\"", "]"}]]}], ",",
                " ", 
               RowBox[{
                RowBox[{"centerpoint", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "+", 
                RowBox[{
                 RowBox[{"OptionValue", "[", "\"\<Pan x\>\"", "]"}], 
                 "\[Delta]x"}], "+", 
                FractionBox["\[Delta]x", 
                 RowBox[{"OptionValue", "[", "\"\<Zoom In\>\"", "]"}]]}]}], 
              "}"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{"centerpoint", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], "+", 
                RowBox[{
                 RowBox[{"OptionValue", "[", "\"\<Pan y\>\"", "]"}], 
                 "\[Delta]y"}], "-", " ", 
                FractionBox["\[Delta]y", 
                 RowBox[{"OptionValue", "[", "\"\<Zoom In\>\"", "]"}]]}], ",",
                " ", 
               RowBox[{
                RowBox[{"centerpoint", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], "+", 
                RowBox[{
                 RowBox[{"OptionValue", "[", "\"\<Pan y\>\"", "]"}], 
                 "\[Delta]y"}], "+", " ", 
                FractionBox["\[Delta]y", 
                 RowBox[{"OptionValue", "[", "\"\<Zoom In\>\"", "]"}]]}]}], 
              "}"}]}], "}"}]}], " ", ",", " ", 
          RowBox[{"ImageSize", "->", " ", 
           RowBox[{"OptionValue", "[", "ImageSize", "]"}]}]}], "]"}]}], ",", 
       RowBox[{"First", "/@", 
        RowBox[{"Values", "[", "newvertexlabels", "]"}]}]}], 
      "\[IndentingNewLine]", "]"}]}]}], "]"}]}]}], "Input",
 CellChangeTimes->{{3.883201225917623*^9, 3.883201252950534*^9}, 
   3.883201312741091*^9, {3.883201353433324*^9, 3.883201356776845*^9}, {
   3.8832013868604097`*^9, 3.883201415990326*^9}, {3.88320144818403*^9, 
   3.88320154840558*^9}, {3.883201607596208*^9, 3.883201652551071*^9}, {
   3.883201735081502*^9, 3.883201760276821*^9}, {3.883201792247123*^9, 
   3.883201854214505*^9}, {3.883201903023486*^9, 3.883201948502438*^9}, {
   3.883201982379232*^9, 3.883202163799109*^9}, {3.88320221362753*^9, 
   3.883202249103838*^9}, {3.8832022871076307`*^9, 3.883202288909778*^9}, {
   3.8832023371793337`*^9, 3.883202340811707*^9}, {3.8832023743082457`*^9, 
   3.883202431693077*^9}, {3.883202468500141*^9, 3.88320266976005*^9}, {
   3.883202708257831*^9, 3.883202978973674*^9}, {3.883203054925151*^9, 
   3.8832031089850483`*^9}, {3.883203141792696*^9, 3.883203367773835*^9}, 
   3.8832034455933943`*^9, {3.8832035347446423`*^9, 3.88320357017616*^9}, {
   3.883203668084154*^9, 3.88320367245516*^9}, {3.883203846323085*^9, 
   3.883203983425969*^9}, {3.8832040438741007`*^9, 3.883204050312766*^9}, 
   3.883204088846979*^9, {3.883204159852405*^9, 3.8832042044107847`*^9}, 
   3.883204241687594*^9, {3.883204332773177*^9, 3.883204395146668*^9}, {
   3.8832044624210157`*^9, 3.883204474105771*^9}, {3.8832056240500298`*^9, 
   3.883205627334725*^9}, {3.8832059617569513`*^9, 3.883205962803083*^9}, 
   3.883206049712163*^9, {3.883207172073612*^9, 3.883207173828871*^9}, {
   3.8832072407561893`*^9, 3.8832072716757593`*^9}, 3.883207312580124*^9, {
   3.883207393058263*^9, 3.8832074009105*^9}, {3.88320744594241*^9, 
   3.8832074577279367`*^9}, {3.8832075672025557`*^9, 3.883207606940481*^9}, {
   3.883207810806254*^9, 3.883207873157489*^9}, {3.8832079255017023`*^9, 
   3.8832079636321774`*^9}, {3.8832082048300467`*^9, 
   3.8832082072434397`*^9}, {3.883210832870088*^9, 3.883210832950634*^9}, {
   3.883211060442213*^9, 3.883211109351589*^9}, {3.883211142542302*^9, 
   3.883211213519608*^9}, {3.883225110839889*^9, 3.883225140978795*^9}, {
   3.8832252389417953`*^9, 3.883225242574387*^9}, {3.883225298556458*^9, 
   3.883225301514381*^9}, {3.883225356806801*^9, 3.883225383761656*^9}, {
   3.883225555059163*^9, 3.883225557786159*^9}, {3.8832259080390863`*^9, 
   3.883225961714192*^9}, 3.883226035609137*^9, 3.883226088660104*^9, {
   3.883249065729739*^9, 3.883249070584437*^9}, {3.883249141509108*^9, 
   3.883249176458398*^9}, {3.8832504974169807`*^9, 3.8832505671774817`*^9}, {
   3.883250598586381*^9, 3.883250627329722*^9}, {3.883252553984827*^9, 
   3.883252557485589*^9}, {3.88325259242873*^9, 3.8832526018712177`*^9}, 
   3.883252948681991*^9, {3.883253005238302*^9, 3.883253012762748*^9}, {
   3.883253057183381*^9, 3.883253148300898*^9}, {3.883253554767707*^9, 
   3.883253564568516*^9}, {3.8832536251542997`*^9, 3.8832536779577093`*^9}, {
   3.883253709001761*^9, 3.883253719283688*^9}, {3.8832537841675873`*^9, 
   3.8832538190993757`*^9}, {3.883253862292984*^9, 3.883253862681231*^9}, {
   3.8832982338722153`*^9, 3.883298255934463*^9}, {3.883486871092332*^9, 
   3.883486955315319*^9}, {3.883487056777437*^9, 3.883487118068801*^9}, 
   3.883487386526026*^9, {3.88358582587306*^9, 3.8835858544839897`*^9}, {
   3.883585955069922*^9, 3.88358600908314*^9}, {3.884091957879158*^9, 
   3.8840919845850353`*^9}, {3.884191297066621*^9, 3.8841912975822783`*^9}, {
   3.8843696278787622`*^9, 3.884369628929069*^9}, {3.884373951661519*^9, 
   3.884373967691248*^9}, {3.8843741177576427`*^9, 3.884374207832416*^9}, {
   3.884374272457116*^9, 3.884374320009658*^9}, {3.884374354486763*^9, 
   3.884374360525839*^9}, {3.884374518123103*^9, 3.88437460541232*^9}, {
   3.884510878585099*^9, 3.884510978364189*^9}, {3.8845110123105793`*^9, 
   3.8845110526912947`*^9}, {3.884511100056781*^9, 3.884511150956419*^9}, {
   3.884511193016028*^9, 3.884511306877974*^9}, {3.8845113617457857`*^9, 
   3.8845113788186626`*^9}, {3.884511577328163*^9, 3.88451161449501*^9}, {
   3.884512029869356*^9, 3.884512073974478*^9}, {3.88451211166434*^9, 
   3.884512339190219*^9}, 3.8845124589048567`*^9, {3.884512602275798*^9, 
   3.884512691596212*^9}, {3.8845127589730377`*^9, 3.884512784882226*^9}, {
   3.884512855415984*^9, 3.884512868539662*^9}, 3.884513112123452*^9, {
   3.884513351022971*^9, 3.884513412295336*^9}, {3.884513455517275*^9, 
   3.88451353812702*^9}, {3.884513577137617*^9, 3.884513673180923*^9}, {
   3.884513720604013*^9, 3.884513721122381*^9}, {3.884513756358282*^9, 
   3.884513823031246*^9}, 3.8845138582302027`*^9, {3.8845139012699347`*^9, 
   3.8845141188987427`*^9}, {3.884514158466504*^9, 3.8845141752447243`*^9}, {
   3.884514232443974*^9, 3.8845142355297728`*^9}, {3.884515710411027*^9, 
   3.8845157258772917`*^9}, {3.884515807971828*^9, 3.884515811238446*^9}, {
   3.884515842407877*^9, 3.884515853563635*^9}, {3.884518090714587*^9, 
   3.884518193253139*^9}, {3.8845185004624023`*^9, 3.8845185642849092`*^9}, 
   3.884518627057234*^9, {3.885688894919783*^9, 3.8856889145478163`*^9}, {
   3.88574104581708*^9, 3.8857410573779383`*^9}, {3.8858223244108477`*^9, 
   3.885822406332685*^9}, {3.885823480225329*^9, 3.8858235395256433`*^9}, {
   3.903099962784452*^9, 3.903099965623219*^9}, {3.903100003871571*^9, 
   3.903100091847188*^9}, {3.903100125804638*^9, 3.9031001605169563`*^9}, {
   3.903100228632277*^9, 3.903100245977849*^9}, {3.903100308095695*^9, 
   3.9031003100913677`*^9}, {3.903100350380467*^9, 3.903100399303959*^9}, {
   3.9031014265498943`*^9, 3.903101445880273*^9}, {3.9031036163223867`*^9, 
   3.903103624732592*^9}, {3.903103659116117*^9, 3.903103660918689*^9}, {
   3.903105570340185*^9, 3.903105604365468*^9}, 3.903105636567707*^9, {
   3.903105866234531*^9, 3.9031059134954987`*^9}, {3.903105957955392*^9, 
   3.903106027758169*^9}, {3.903106082314789*^9, 3.903106082882812*^9}, {
   3.9031061204451723`*^9, 3.90310615200324*^9}, {3.9031062462173023`*^9, 
   3.903106248729686*^9}, {3.9031062835732594`*^9, 3.9031063477001047`*^9}, {
   3.903106595201846*^9, 3.903106605343226*^9}, {3.903106717927712*^9, 
   3.9031067307153*^9}, {3.9031068108367767`*^9, 3.9031068556763477`*^9}, {
   3.903107779427347*^9, 3.903107789059799*^9}, {3.903107886932824*^9, 
   3.903107949667921*^9}, {3.903107993627833*^9, 3.9031080469623747`*^9}, {
   3.9031080809900017`*^9, 3.903108195428114*^9}, {3.903108250948388*^9, 
   3.903108392153758*^9}, {3.903108473366332*^9, 3.903108489672612*^9}, {
   3.903108593435404*^9, 3.9031086129534607`*^9}, 3.903108649276017*^9, {
   3.9031088040135117`*^9, 3.9031088158706417`*^9}, 3.903108918831574*^9, {
   3.903108951779187*^9, 3.903108982576079*^9}, {3.9031090289362593`*^9, 
   3.903109055602187*^9}, {3.9031090933783503`*^9, 3.903109115164694*^9}, {
   3.903109276544859*^9, 3.9031092785451193`*^9}, {3.9031093189953213`*^9, 
   3.9031094074536858`*^9}, {3.9031094477654943`*^9, 3.903109520578032*^9}, 
   3.9031095718826113`*^9, {3.903109652424326*^9, 3.903109665224716*^9}, {
   3.903109749150128*^9, 3.903109796454711*^9}, {3.903109843791274*^9, 
   3.903109871848514*^9}},
 Background->RGBColor[1, 1, 0],
 CellLabel->
  "In[110]:=",ExpressionUUID->"65aa8ff4-495a-4fb0-828f-8932a24fc6ea"]
}, Closed]],

Cell[CellGroupData[{

Cell["NewPlotDouble", "Subsubsection",
 CellChangeTimes->{{3.884515656744285*^9, 3.884515660167211*^9}, {
  3.891561552097084*^9, 
  3.8915615527723837`*^9}},ExpressionUUID->"880e16f2-797b-4218-8188-\
e321db80382d"],

Cell["\<\
This works similarly to NewPlotSingle, but is used when you have two \
communities and you wish to format them so that they are physically displaced \
from one another.  One may also use the Highlight option to change the shape \
or coloring of the vertices associated with a single community.  Other \
options are similar to NewPlotSingle.

This is a useful visualization when one wants to focus on the links between \
communities rather than those within them.  If one put the two communities \
together and used NewPlotSingle, the genes might end up being intermingled on \
the plot, and it would harder to visualize the inter-community links. \
\>", "Text",
 CellChangeTimes->{{3.90646532006709*^9, 3.9064654232267303`*^9}, {
  3.906465565530325*^9, 
  3.906465640668028*^9}},ExpressionUUID->"2cc3286a-9f91-4b9a-be0b-\
3080e716c0d4"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "NewPlotDouble", "]"}], "=", 
    RowBox[{"{", " ", 
     RowBox[{
      RowBox[{"\"\<Show Graph\>\"", "->", " ", "True"}], ",", 
      RowBox[{"\"\<Highlight\>\"", "->", " ", 
       RowBox[{"{", "}"}]}], ",", " ", 
      RowBox[{"\"\<Layout\>\"", "->", " ", "\"\<SpringEmbedding\>\""}], ",", 
      " ", 
      RowBox[{"\"\<Size Scaling\>\"", "->", " ", "25"}], ",", " ", 
      RowBox[{"\"\<Automatic Partitioning\>\"", "->", " ", "True"}], ",", 
      RowBox[{"\"\<Vertex Labeling\>\"", "->", " ", "True"}], ",", " ", 
      RowBox[{"\"\<LabelStyle\>\"", "->", "Automatic"}], ",", 
      RowBox[{"\"\<HighlightLabelStyle\>\"", "->", 
       RowBox[{"Directive", "[", 
        RowBox[{"Blue", ",", " ", "Larger"}], "]"}]}], ",", " ", 
      RowBox[{"\"\<HighlightShape\>\"", "->", " ", "\"\<Square\>\""}], ",", 
      RowBox[{"\"\<HighlightColor\>\"", "->", " ", "Yellow"}], ",", " ", 
      RowBox[{"\"\<Base Vertex Opacity\>\"", "->", " ", "0.05"}], ",", 
      RowBox[{"\"\<Positive Only\>\"", "->", " ", "True"}], ",", 
      RowBox[{"\"\<GreenOpacity\>\"", "->", " ", "0.5"}], ",", " ", 
      RowBox[{"\"\<PinkOpacity\>\"", "->", "0.5"}], " ", ",", 
      RowBox[{"\"\<EdgeThickness\>\"", "->", " ", "0.003"}], ",", " ", 
      RowBox[{"ImageSize", "->", " ", "Automatic"}], ",", 
      RowBox[{"\"\<Zoom In\>\"", "->", " ", "1"}], ",", " ", 
      RowBox[{"\"\<Pan x\>\"", "->", " ", "0"}], ",", " ", 
      RowBox[{"\"\<Pan y\>\"", "->", " ", "0"}]}], "}"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ef1", "[", 
     RowBox[{"el_", ",", "___"}], "]"}], ":=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"Arrowheads", "[", "0", "]"}], ",", 
      RowBox[{"Arrow", "[", 
       RowBox[{"el", ",", "0"}], "]"}]}], "}"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"NewPlotDouble", "[", 
     RowBox[{
     "gNO_", ",", " ", "genes1_", ",", "genes2_", ",", "cutoff_", ",", 
      "shift_", ",", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
    "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"gno", "=", 
         RowBox[{"GeneSubsetGNO", "[", 
          RowBox[{"gNO", ",", " ", 
           RowBox[{"Flatten", "[", 
            RowBox[{"{", 
             RowBox[{"genes1", ",", " ", "genes2"}], "}"}], "]"}], ",", " ", 
           RowBox[{"\"\<Purge\>\"", "->", " ", "True"}]}], "]"}]}], ",", 
        RowBox[{"gno1", "=", 
         RowBox[{"GeneSubsetGNO", "[", 
          RowBox[{"gNO", ",", " ", 
           RowBox[{"Flatten", "[", "genes1", "]"}], ",", " ", 
           RowBox[{"\"\<Purge\>\"", "->", " ", "True"}]}], "]"}]}], ",", 
        RowBox[{"gno2", "=", 
         RowBox[{"GeneSubsetGNO", "[", 
          RowBox[{"gNO", ",", " ", "genes2", ",", " ", 
           RowBox[{"\"\<Purge\>\"", "->", " ", "True"}]}], "]"}]}], ",", 
        "fullmat", ",", "fullmat1", ",", " ", "fullmat2", ",", "indices1", 
        ",", " ", "indices2", ",", "posmatrix1", ",", "posposns1", ",", 
        "posgenes1", ",", " ", "posplot1", ",", " ", "vertexcoords1", ",", 
        "posmatrix2", ",", " ", "posposns2", ",", "posgenes2", ",", 
        "posplot2", ",", "vertexcoords2", ",", "vertexcoords", ",", "  ", 
        "allyellowvertices", ",", " ", "allvertexlabels", ",", " ", 
        "vertexsizes", ",", "workingmat", ",", "es", ",", " ", 
        "workingvertices", ",", " ", "yellowvertices", ",", "bluevertices", 
        ",", " ", "newvertexcoords", ",", "newvertexlabels", ",", "datarange",
         ",", "centerpoint", ",", "\[Delta]x", ",", "\[Delta]y", ",", " ", 
        "newallposns", ",", "newnegposns", ",", "  ", "greenedges", ",", " ", 
        "rededges", ",", "cp"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"fullmat", "=", 
        RowBox[{"gno", "[", 
         RowBox[{"[", "3", "]"}], "]"}]}], ";", 
       RowBox[{"fullmat1", "=", 
        RowBox[{"gno1", "[", 
         RowBox[{"[", "3", "]"}], "]"}]}], ";", " ", 
       RowBox[{"fullmat2", "=", 
        RowBox[{"gno2", "[", 
         RowBox[{"[", "3", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"posmatrix1", "=", " ", 
        RowBox[{"SparseArray", "[", 
         RowBox[{"BoolEval", "[", 
          RowBox[{"fullmat1", ">", "0"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"posposns1", " ", "=", " ", 
        RowBox[{"Sort", "[", 
         RowBox[{"Union", "[", 
          RowBox[{"Flatten", "[", 
           RowBox[{"posmatrix1", "[", "\"\<ExplicitPositions\>\"", "]"}], 
           "]"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"posgenes1", "=", 
        RowBox[{
         RowBox[{"gno1", "[", 
          RowBox[{"[", "2", "]"}], "]"}], "[", 
         RowBox[{"[", "posposns1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"posplot1", "=", 
        RowBox[{"UndirectedGraph", "[", 
         RowBox[{"AdjacencyGraph", "[", 
          RowBox[{"posmatrix1", ",", 
           RowBox[{"GraphLayout", "->", 
            RowBox[{"OptionValue", "[", "\"\<Layout\>\"", "]"}]}]}], "]"}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"vertexcoords1", " ", "=", " ", 
        RowBox[{"Thread", "[", 
         RowBox[{"posgenes1", "->", " ", 
          RowBox[{
           RowBox[{"GraphEmbedding", "[", "posplot1", "]"}], "[", 
           RowBox[{"[", "posposns1", "]"}], "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"posmatrix2", "=", " ", 
        RowBox[{"SparseArray", "[", 
         RowBox[{"BoolEval", "[", 
          RowBox[{"fullmat2", ">", "0"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"posposns2", " ", "=", " ", 
        RowBox[{"Sort", "[", 
         RowBox[{"Union", "[", 
          RowBox[{"Flatten", "[", 
           RowBox[{"posmatrix2", "[", "\"\<ExplicitPositions\>\"", "]"}], 
           "]"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"posgenes2", "=", 
        RowBox[{
         RowBox[{"gno2", "[", 
          RowBox[{"[", "2", "]"}], "]"}], "[", 
         RowBox[{"[", "posposns2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"posplot2", "=", 
        RowBox[{"UndirectedGraph", "[", 
         RowBox[{"AdjacencyGraph", "[", 
          RowBox[{"posmatrix2", ",", 
           RowBox[{"GraphLayout", "->", 
            RowBox[{"OptionValue", "[", "\"\<Layout\>\"", "]"}]}]}], "]"}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"vertexcoords2", " ", "=", " ", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "shift", "]"}], "==", "2"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"Thread", "[", 
           RowBox[{"posgenes2", "->", " ", 
            RowBox[{"Map", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Plus", "[", 
                RowBox[{"#", ",", "shift"}], "]"}], "&"}], ",", 
              RowBox[{
               RowBox[{"GraphEmbedding", "[", "posplot2", "]"}], "[", 
               RowBox[{"[", "posposns2", "]"}], "]"}]}], "]"}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"Thread", "[", 
           RowBox[{"posgenes2", "->", " ", 
            RowBox[{"MapAt", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Plus", "[", 
                RowBox[{"#", ",", "shift"}], "]"}], "&"}], ",", 
              RowBox[{
               RowBox[{"GraphEmbedding", "[", "posplot2", "]"}], "[", 
               RowBox[{"[", "posposns2", "]"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"All", ",", "1"}], "}"}]}], "]"}]}], "]"}]}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"vertexcoords", " ", "=", " ", 
        RowBox[{
         RowBox[{"Join", "[", 
          RowBox[{"vertexcoords1", ",", " ", "vertexcoords2"}], "]"}], "/.", 
         RowBox[{"Thread", "[", 
          RowBox[{
           RowBox[{"gno", "[", 
            RowBox[{"[", "2", "]"}], "]"}], "->", " ", 
           RowBox[{"Range", "[", 
            RowBox[{"Length", "[", 
             RowBox[{"gno", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}]}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"allyellowvertices", "=", " ", 
        RowBox[{"Flatten", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Position", "[", 
            RowBox[{
             RowBox[{"gno", "[", 
              RowBox[{"[", "2", "]"}], "]"}], ",", "#"}], "]"}], "&"}], "/@", 
          
          RowBox[{"OptionValue", "[", "\"\<Highlight\>\"", "]"}]}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"allvertexlabels", "=", 
        RowBox[{"Thread", "[", 
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"Length", "[", 
            RowBox[{"gno", "[", 
             RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], "->", "  ", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"Placed", "[", 
              RowBox[{"#", ",", "Center"}], "]"}], "&"}], "/@", 
            RowBox[{"gno", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], ")"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"OptionValue", "[", "\"\<Positive Only\>\"", "]"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"workingmat", " ", "=", "  ", 
           RowBox[{"SparseArray", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"BoolEval", "[", 
               RowBox[{"fullmat", ">", "cutoff"}], "]"}], "*", "fullmat"}], 
             ",", " ", 
             RowBox[{"Dimensions", "[", "fullmat", "]"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"rededges", "=", 
           RowBox[{"{", "}"}]}], ";", 
          RowBox[{"greenedges", "=", 
           RowBox[{"EdgeList", "[", 
            RowBox[{"Graph", "[", 
             RowBox[{"workingmat", "[", "\"\<ExplicitPositions\>\"", "]"}], 
             "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"es", " ", "=", 
           RowBox[{"Directive", "[", 
            RowBox[{"{", 
             RowBox[{"Green", ",", " ", 
              RowBox[{"Opacity", "[", 
               RowBox[{"OptionValue", "[", "\"\<GreenOpacity\>\"", "]"}], 
               "]"}], ",", " ", 
              RowBox[{"Thickness", "[", 
               RowBox[{"OptionValue", "[", "\"\<EdgeThickness\>\"", "]"}], 
               "]"}]}], "}"}], "]"}]}]}], " ", ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"workingmat", " ", "=", " ", 
           RowBox[{"SparseArray", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"BoolEval", "[", 
               RowBox[{
                RowBox[{"Abs", "[", "fullmat", "]"}], ">", "cutoff"}], "]"}], 
              "*", "fullmat"}], ",", " ", 
             RowBox[{"Dimensions", "[", "fullmat", "]"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"rededges", "=", 
           RowBox[{"EdgeList", "[", 
            RowBox[{"Graph", "[", 
             RowBox[{
              RowBox[{"SparseArray", "[", 
               RowBox[{"BoolEval", "[", 
                RowBox[{"workingmat", "<", "0"}], "]"}], "]"}], "[", 
              "\"\<ExplicitPositions\>\"", "]"}], "]"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"greenedges", "=", 
           RowBox[{"EdgeList", "[", 
            RowBox[{"Graph", "[", 
             RowBox[{
              RowBox[{"SparseArray", "[", 
               RowBox[{"BoolEval", "[", 
                RowBox[{"workingmat", ">", "0"}], "]"}], "]"}], "[", 
              "\"\<ExplicitPositions\>\"", "]"}], "]"}], "]"}]}], ";", " ", 
          "\[IndentingNewLine]", 
          RowBox[{"es", " ", "=", " ", 
           RowBox[{"Join", "[", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"#", "->", " ", 
                 RowBox[{"Directive", "[", 
                  RowBox[{"{", 
                   RowBox[{"Green", ",", " ", 
                    RowBox[{"Opacity", "[", 
                    RowBox[{"OptionValue", "[", "\"\<GreenOpacity\>\"", "]"}],
                     "]"}], ",", " ", 
                    RowBox[{"Thickness", "[", 
                    RowBox[{
                    "OptionValue", "[", "\"\<EdgeThickness\>\"", "]"}], 
                    "]"}]}], "}"}], "]"}]}], "&"}], "/@", "greenedges"}], 
              ")"}], ",", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"#", "->", " ", 
                 RowBox[{"Directive", "[", 
                  RowBox[{"{", 
                   RowBox[{"Pink", ",", " ", 
                    RowBox[{"Opacity", "[", 
                    RowBox[{"OptionValue", "[", "\"\<PinkOpacity\>\"", "]"}], 
                    "]"}], ",", " ", 
                    RowBox[{"Thickness", "[", 
                    RowBox[{
                    "OptionValue", "[", "\"\<EdgeThickness\>\"", "]"}], 
                    "]"}]}], "}"}], "]"}]}], "&"}], "/@", "rededges"}], 
              ")"}]}], "]"}]}]}]}], " ", "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"workingvertices", "=", 
        RowBox[{"Sort", "[", 
         RowBox[{"Union", "[", 
          RowBox[{"Flatten", "[", 
           RowBox[{"workingmat", "[", "\"\<ExplicitPositions\>\"", "]"}], 
           "]"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", "\t", 
       RowBox[{"yellowvertices", "=", 
        RowBox[{"Intersection", "[", 
         RowBox[{"workingvertices", ",", " ", "allyellowvertices"}], "]"}]}], 
       ";", "\[IndentingNewLine]", "\t", 
       RowBox[{"bluevertices", "=", " ", 
        RowBox[{"Complement", "[", 
         RowBox[{"workingvertices", ",", " ", "yellowvertices"}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"newvertexcoords", " ", "=", " ", 
        RowBox[{"Select", "[", 
         RowBox[{"vertexcoords", ",", " ", 
          RowBox[{
           RowBox[{"MemberQ", "[", 
            RowBox[{"workingvertices", ",", " ", 
             RowBox[{"First", "[", "#", "]"}]}], "]"}], "&"}]}], "]"}]}], ";",
        "\[IndentingNewLine]", 
       RowBox[{"newvertexlabels", "=", 
        RowBox[{"Select", "[", 
         RowBox[{"allvertexlabels", ",", " ", 
          RowBox[{
           RowBox[{"MemberQ", "[", 
            RowBox[{"workingvertices", ",", " ", 
             RowBox[{"First", "[", "#", "]"}]}], "]"}], "&"}]}], "]"}]}], ";",
        "\[IndentingNewLine]", 
       RowBox[{"datarange", "=", 
        RowBox[{"MinMax", "/@", 
         RowBox[{"Transpose", "[", 
          RowBox[{"Values", "[", "vertexcoords", "]"}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"centerpoint", "=", 
        RowBox[{"Mean", "/@", "datarange"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"\[Delta]x", ",", "\[Delta]y"}], "}"}], "=", 
        RowBox[{
         RowBox[{"Last", "/@", "datarange"}], " ", "-", " ", 
         "centerpoint"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"OptionValue", "[", "\"\<Show Graph\>\"", "]"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"GraphPlot", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Graph", "[", 
            RowBox[{
             RowBox[{"workingmat", "[", "\"\<ExplicitPositions\>\"", "]"}], 
             ",", "\[IndentingNewLine]", 
             RowBox[{"VertexCoordinates", "->", "newvertexcoords"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"VertexLabels", "->", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"OptionValue", "[", "\"\<Vertex Labeling\>\"", "]"}], 
                ",", " ", "newvertexlabels", ",", "None"}], "]"}]}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"VertexLabelStyle", "\[Rule]", " ", 
              RowBox[{"Join", "[", " ", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"#", "\[Rule]", 
                    RowBox[{
                    "OptionValue", "[", "\"\<HighlightLabelStyle\>\"", 
                    "]"}]}], ")"}], "&"}], "/@", "yellowvertices"}], ",", 
                RowBox[{
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"#", "\[Rule]", 
                    RowBox[{"OptionValue", "[", "\"\<LabelStyle\>\"", "]"}]}],
                    ")"}], "&"}], "/@", " ", "bluevertices"}]}], "]"}]}], ",",
              "\[IndentingNewLine]", 
             RowBox[{"VertexSize", "->", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"NumberQ", "[", 
                 RowBox[{"OptionValue", "[", "\"\<Size Scaling\>\"", "]"}], 
                 "]"}], ",", 
                RowBox[{"OptionValue", "[", "\"\<Size Scaling\>\"", "]"}], 
                ",", "Automatic"}], "]"}]}], ",", "\[IndentingNewLine]", 
             RowBox[{"VertexStyle", "->", 
              RowBox[{"Join", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"#", "->", " ", 
                    RowBox[{"Directive", "[", 
                    RowBox[{
                    RowBox[{"EdgeForm", "[", "None", "]"}], ",", "Blue", ",", 
                    
                    RowBox[{"Opacity", "[", 
                    RowBox[{
                    "OptionValue", "[", "\"\<Base Vertex Opacity\>\"", "]"}], 
                    "]"}]}], "]"}]}], ")"}], "&"}], "/@", "bluevertices"}], 
                ",", 
                RowBox[{
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"#", "->", " ", 
                    RowBox[{"Directive", "[", 
                    RowBox[{
                    RowBox[{"EdgeForm", "[", "None", "]"}], ",", 
                    RowBox[{
                    "OptionValue", "[", "\"\<HighlightColor\>\"", "]"}], ",", 
                    
                    RowBox[{"Opacity", "[", "0.5", "]"}]}], "]"}]}], ")"}], 
                  "&"}], "/@", "yellowvertices"}]}], "]"}]}], " ", ",", 
             "\[IndentingNewLine]", 
             RowBox[{"VertexShapeFunction", "\[Rule]", 
              RowBox[{"Join", "[", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"#", "\[Rule]", "  ", 
                    RowBox[{
                    "OptionValue", "[", " ", "\"\<HighlightShape\>\"", 
                    "]"}]}], "&"}], "/@", "yellowvertices"}], ")"}], ",", " ", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"#", "\[Rule]", " ", "Automatic"}], "&"}], "/@", 
                  "bluevertices"}], ")"}]}], "]"}]}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"EdgeStyle", "->", "es"}], ",", "\[IndentingNewLine]", 
             RowBox[{"EdgeShapeFunction", "\[Rule]", "ef1"}]}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"PlotRange", "->", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{
                 RowBox[{"centerpoint", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "+", 
                 RowBox[{
                  RowBox[{"OptionValue", "[", "\"\<Pan x\>\"", "]"}], 
                  "\[Delta]x"}], "-", " ", 
                 FractionBox["\[Delta]x", 
                  RowBox[{"OptionValue", "[", "\"\<Zoom In\>\"", "]"}]]}], 
                ",", " ", 
                RowBox[{
                 RowBox[{"centerpoint", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "+", 
                 RowBox[{
                  RowBox[{"OptionValue", "[", "\"\<Pan x\>\"", "]"}], 
                  "\[Delta]x"}], "+", 
                 FractionBox["\[Delta]x", 
                  RowBox[{"OptionValue", "[", "\"\<Zoom In\>\"", "]"}]]}]}], 
               "}"}], ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{
                 RowBox[{"centerpoint", "[", 
                  RowBox[{"[", "2", "]"}], "]"}], "+", 
                 RowBox[{
                  RowBox[{"OptionValue", "[", "\"\<Pan y\>\"", "]"}], 
                  "\[Delta]y"}], "-", " ", 
                 FractionBox["\[Delta]y", 
                  RowBox[{"OptionValue", "[", "\"\<Zoom In\>\"", "]"}]]}], 
                ",", " ", 
                RowBox[{
                 RowBox[{"centerpoint", "[", 
                  RowBox[{"[", "2", "]"}], "]"}], "+", 
                 RowBox[{
                  RowBox[{"OptionValue", "[", "\"\<Pan y\>\"", "]"}], 
                  "\[Delta]y"}], "+", " ", 
                 FractionBox["\[Delta]y", 
                  RowBox[{"OptionValue", "[", "\"\<Zoom In\>\"", "]"}]]}]}], 
               "}"}]}], "}"}]}], " ", ",", " ", 
           RowBox[{"ImageSize", "->", " ", 
            RowBox[{"OptionValue", "[", "ImageSize", "]"}]}]}], "]"}], ",", 
         RowBox[{"First", "/@", 
          RowBox[{"Values", "[", "newvertexlabels", "]"}]}]}], "]"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"NewPlotDouble", "[", 
   RowBox[{
   "gNO_", ",", "  ", "genes1_", ",", "genes2_", ",", "expressiondata_", ",", 
    "cutoff_", ",", "shift_", ",", "  ", 
    RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
  "\[IndentingNewLine]", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"gno", "=", 
       RowBox[{"GeneSubsetGNO", "[", 
        RowBox[{"gNO", ",", " ", 
         RowBox[{"Flatten", "[", 
          RowBox[{"{", 
           RowBox[{"genes1", ",", " ", "genes2"}], "}"}], "]"}], ",", " ", 
         RowBox[{"\"\<Purge\>\"", "->", " ", "True"}]}], "]"}]}], ",", 
      RowBox[{"gno1", "=", 
       RowBox[{"GeneSubsetGNO", "[", 
        RowBox[{"gNO", ",", " ", 
         RowBox[{"Flatten", "[", "genes1", "]"}], ",", " ", 
         RowBox[{"\"\<Purge\>\"", "->", " ", "True"}]}], "]"}]}], ",", 
      RowBox[{"gno2", "=", 
       RowBox[{"GeneSubsetGNO", "[", 
        RowBox[{"gNO", ",", " ", "genes2", ",", " ", 
         RowBox[{"\"\<Purge\>\"", "->", " ", "True"}]}], "]"}]}], ",", 
      "fullmat", ",", "fullmat1", ",", " ", "fullmat2", ",", "indices1", ",", 
      " ", "indices2", ",", "posmatrix1", ",", "posposns1", ",", "posgenes1", 
      ",", " ", "posplot1", ",", " ", "vertexcoords1", ",", "posmatrix2", ",",
       " ", "posposns2", ",", "posgenes2", ",", "posplot2", ",", 
      "vertexcoords2", ",", "vertexcoords", ",", "  ", "allyellowvertices", 
      ",", " ", "allvertexlabels", ",", " ", "vertexsizes", ",", "workingmat",
       ",", "es", ",", " ", "workingvertices", ",", " ", "yellowvertices", 
      ",", "bluevertices", ",", " ", "newvertexcoords", ",", 
      "newvertexlabels", ",", "datarange", ",", "centerpoint", ",", 
      "\[Delta]x", ",", "\[Delta]y", ",", " ", "newallposns", ",", 
      "newnegposns", ",", "  ", "greenedges", ",", " ", "rededges", ",", 
      "cp"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"fullmat", "=", 
      RowBox[{"gno", "[", 
       RowBox[{"[", "3", "]"}], "]"}]}], ";", 
     RowBox[{"fullmat1", "=", 
      RowBox[{"gno1", "[", 
       RowBox[{"[", "3", "]"}], "]"}]}], ";", " ", 
     RowBox[{"fullmat2", "=", 
      RowBox[{"gno2", "[", 
       RowBox[{"[", "3", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"posmatrix1", "=", " ", 
      RowBox[{"SparseArray", "[", 
       RowBox[{"BoolEval", "[", 
        RowBox[{"fullmat1", ">", "0"}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"posposns1", " ", "=", " ", 
      RowBox[{"Sort", "[", 
       RowBox[{"Union", "[", 
        RowBox[{"Flatten", "[", 
         RowBox[{"posmatrix1", "[", "\"\<ExplicitPositions\>\"", "]"}], "]"}],
         "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"posgenes1", "=", 
      RowBox[{
       RowBox[{"gno1", "[", 
        RowBox[{"[", "2", "]"}], "]"}], "[", 
       RowBox[{"[", "posposns1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"posplot1", "=", 
      RowBox[{"UndirectedGraph", "[", 
       RowBox[{"AdjacencyGraph", "[", 
        RowBox[{"posmatrix1", ",", 
         RowBox[{"GraphLayout", "->", 
          RowBox[{"OptionValue", "[", "\"\<Layout\>\"", "]"}]}]}], "]"}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"vertexcoords1", " ", "=", " ", 
      RowBox[{"Thread", "[", 
       RowBox[{"posgenes1", "->", " ", 
        RowBox[{
         RowBox[{"GraphEmbedding", "[", "posplot1", "]"}], "[", 
         RowBox[{"[", "posposns1", "]"}], "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"posmatrix2", "=", " ", 
      RowBox[{"SparseArray", "[", 
       RowBox[{"BoolEval", "[", 
        RowBox[{"fullmat2", ">", "0"}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"posposns2", " ", "=", " ", 
      RowBox[{"Sort", "[", 
       RowBox[{"Union", "[", 
        RowBox[{"Flatten", "[", 
         RowBox[{"posmatrix2", "[", "\"\<ExplicitPositions\>\"", "]"}], "]"}],
         "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"posgenes2", "=", 
      RowBox[{
       RowBox[{"gno2", "[", 
        RowBox[{"[", "2", "]"}], "]"}], "[", 
       RowBox[{"[", "posposns2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"posplot2", "=", 
      RowBox[{"UndirectedGraph", "[", 
       RowBox[{"AdjacencyGraph", "[", 
        RowBox[{"posmatrix2", ",", 
         RowBox[{"GraphLayout", "->", 
          RowBox[{"OptionValue", "[", "\"\<Layout\>\"", "]"}]}]}], "]"}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"vertexcoords2", " ", "=", " ", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "shift", "]"}], "==", "2"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"Thread", "[", 
         RowBox[{"posgenes2", "->", " ", 
          RowBox[{"Map", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Plus", "[", 
              RowBox[{"#", ",", "shift"}], "]"}], "&"}], ",", 
            RowBox[{
             RowBox[{"GraphEmbedding", "[", "posplot2", "]"}], "[", 
             RowBox[{"[", "posposns2", "]"}], "]"}]}], "]"}]}], "]"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"Thread", "[", 
         RowBox[{"posgenes2", "->", " ", 
          RowBox[{"MapAt", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Plus", "[", 
              RowBox[{"#", ",", "shift"}], "]"}], "&"}], ",", 
            RowBox[{
             RowBox[{"GraphEmbedding", "[", "posplot2", "]"}], "[", 
             RowBox[{"[", "posposns2", "]"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"All", ",", "1"}], "}"}]}], "]"}]}], "]"}]}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"vertexcoords", " ", "=", " ", 
      RowBox[{
       RowBox[{"Join", "[", 
        RowBox[{"vertexcoords1", ",", " ", "vertexcoords2"}], "]"}], "/.", 
       RowBox[{"Thread", "[", 
        RowBox[{
         RowBox[{"gno", "[", 
          RowBox[{"[", "2", "]"}], "]"}], "->", " ", 
         RowBox[{"Range", "[", 
          RowBox[{"Length", "[", 
           RowBox[{"gno", "[", 
            RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}]}], "]"}]}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"vertexsizes", "=", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"NumberQ", "[", 
         RowBox[{"OptionValue", "[", "\"\<Size Scaling\>\"", "]"}], "]"}], 
        ",", 
        RowBox[{"Thread", "[", 
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"Length", "[", 
            RowBox[{"gno", "[", 
             RowBox[{"[", "2", "]"}], "]"}], "]"}], " ", "]"}], "->", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"OptionValue", "[", "\"\<Size Scaling\>\"", "]"}], 
              SqrtBox[
               RowBox[{"expressiondata", "[", "#", "]"}]]}], "&"}], "/@", 
            RowBox[{"gno", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], ")"}]}], "]"}], ",", 
        RowBox[{"{", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"allyellowvertices", "=", " ", 
      RowBox[{"Flatten", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Position", "[", 
          RowBox[{
           RowBox[{"gno", "[", 
            RowBox[{"[", "2", "]"}], "]"}], ",", "#"}], "]"}], "&"}], "/@", 
        RowBox[{"OptionValue", "[", "\"\<Highlight\>\"", "]"}]}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"allvertexlabels", "=", 
      RowBox[{"Thread", "[", 
       RowBox[{
        RowBox[{"Range", "[", 
         RowBox[{"Length", "[", 
          RowBox[{"gno", "[", 
           RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], "->", "  ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"Placed", "[", 
            RowBox[{"#", ",", "Center"}], "]"}], "&"}], "/@", 
          RowBox[{"gno", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}], ")"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"OptionValue", "[", "\"\<Positive Only\>\"", "]"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"workingmat", " ", "=", "  ", 
         RowBox[{"SparseArray", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"BoolEval", "[", 
             RowBox[{"fullmat", ">", "cutoff"}], "]"}], "*", "fullmat"}], ",",
            " ", 
           RowBox[{"Dimensions", "[", "fullmat", "]"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"rededges", "=", 
         RowBox[{"{", "}"}]}], ";", 
        RowBox[{"greenedges", "=", 
         RowBox[{"EdgeList", "[", 
          RowBox[{"Graph", "[", 
           RowBox[{"workingmat", "[", "\"\<ExplicitPositions\>\"", "]"}], 
           "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"es", " ", "=", 
         RowBox[{"Directive", "[", 
          RowBox[{"{", 
           RowBox[{"Green", ",", " ", 
            RowBox[{"Opacity", "[", 
             RowBox[{"OptionValue", "[", "\"\<GreenOpacity\>\"", "]"}], "]"}],
             ",", " ", 
            RowBox[{"Thickness", "[", 
             RowBox[{"OptionValue", "[", "\"\<EdgeThickness\>\"", "]"}], 
             "]"}]}], "}"}], "]"}]}]}], " ", ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"workingmat", " ", "=", " ", 
         RowBox[{"SparseArray", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"BoolEval", "[", 
             RowBox[{
              RowBox[{"Abs", "[", "fullmat", "]"}], ">", "cutoff"}], "]"}], 
            "*", "fullmat"}], ",", " ", 
           RowBox[{"Dimensions", "[", "fullmat", "]"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"rededges", "=", 
         RowBox[{"EdgeList", "[", 
          RowBox[{"Graph", "[", 
           RowBox[{
            RowBox[{"SparseArray", "[", 
             RowBox[{"BoolEval", "[", 
              RowBox[{"workingmat", "<", "0"}], "]"}], "]"}], "[", 
            "\"\<ExplicitPositions\>\"", "]"}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"greenedges", "=", 
         RowBox[{"EdgeList", "[", 
          RowBox[{"Graph", "[", 
           RowBox[{
            RowBox[{"SparseArray", "[", 
             RowBox[{"BoolEval", "[", 
              RowBox[{"workingmat", ">", "0"}], "]"}], "]"}], "[", 
            "\"\<ExplicitPositions\>\"", "]"}], "]"}], "]"}]}], ";", " ", 
        "\[IndentingNewLine]", 
        RowBox[{"es", " ", "=", " ", 
         RowBox[{"Join", "[", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{"#", "->", " ", 
               RowBox[{"Directive", "[", 
                RowBox[{"{", 
                 RowBox[{"Green", ",", " ", 
                  RowBox[{"Opacity", "[", 
                   RowBox[{"OptionValue", "[", "\"\<GreenOpacity\>\"", "]"}], 
                   "]"}], ",", " ", 
                  RowBox[{"Thickness", "[", 
                   RowBox[{"OptionValue", "[", "\"\<EdgeThickness\>\"", "]"}],
                    "]"}]}], "}"}], "]"}]}], "&"}], "/@", "greenedges"}], 
            ")"}], ",", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{"#", "->", " ", 
               RowBox[{"Directive", "[", 
                RowBox[{"{", 
                 RowBox[{"Pink", ",", " ", 
                  RowBox[{"Opacity", "[", 
                   RowBox[{"OptionValue", "[", "\"\<PinkOpacity\>\"", "]"}], 
                   "]"}], ",", " ", 
                  RowBox[{"Thickness", "[", 
                   RowBox[{"OptionValue", "[", "\"\<EdgeThickness\>\"", "]"}],
                    "]"}]}], "}"}], "]"}]}], "&"}], "/@", "rededges"}], 
            ")"}]}], "]"}]}]}]}], " ", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"workingvertices", "=", 
      RowBox[{"Sort", "[", 
       RowBox[{"Union", "[", 
        RowBox[{"Flatten", "[", 
         RowBox[{"workingmat", "[", "\"\<ExplicitPositions\>\"", "]"}], "]"}],
         "]"}], "]"}]}], ";", "\[IndentingNewLine]", "\t", 
     RowBox[{"yellowvertices", "=", 
      RowBox[{"Intersection", "[", 
       RowBox[{"workingvertices", ",", " ", "allyellowvertices"}], "]"}]}], 
     ";", "\[IndentingNewLine]", "\t", 
     RowBox[{"bluevertices", "=", " ", 
      RowBox[{"Complement", "[", 
       RowBox[{"workingvertices", ",", " ", "yellowvertices"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"newvertexcoords", " ", "=", " ", 
      RowBox[{"Select", "[", 
       RowBox[{"vertexcoords", ",", " ", 
        RowBox[{
         RowBox[{"MemberQ", "[", 
          RowBox[{"workingvertices", ",", " ", 
           RowBox[{"First", "[", "#", "]"}]}], "]"}], "&"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"newvertexlabels", "=", 
      RowBox[{"Select", "[", 
       RowBox[{"allvertexlabels", ",", " ", 
        RowBox[{
         RowBox[{"MemberQ", "[", 
          RowBox[{"workingvertices", ",", " ", 
           RowBox[{"First", "[", "#", "]"}]}], "]"}], "&"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"datarange", "=", 
      RowBox[{"MinMax", "/@", 
       RowBox[{"Transpose", "[", 
        RowBox[{"Values", "[", "vertexcoords", "]"}], "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"centerpoint", "=", 
      RowBox[{"Mean", "/@", "datarange"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"\[Delta]x", ",", "\[Delta]y"}], "}"}], "=", 
      RowBox[{
       RowBox[{"Last", "/@", "datarange"}], " ", "-", " ", "centerpoint"}]}], 
     ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"OptionValue", "[", "\"\<Show Graph\>\"", "]"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"GraphPlot", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Graph", "[", 
          RowBox[{
           RowBox[{"workingmat", "[", "\"\<ExplicitPositions\>\"", "]"}], ",",
            "\[IndentingNewLine]", 
           RowBox[{"VertexCoordinates", "->", "newvertexcoords"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"VertexLabels", "->", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"OptionValue", "[", "\"\<Vertex Labeling\>\"", "]"}], 
              ",", " ", "newvertexlabels", ",", "None"}], "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"VertexLabelStyle", "\[Rule]", " ", 
            RowBox[{"Join", "[", " ", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"#", "\[Rule]", 
                  RowBox[{
                  "OptionValue", "[", "\"\<HighlightLabelStyle\>\"", "]"}]}], 
                 ")"}], "&"}], "/@", "yellowvertices"}], ",", 
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"#", "\[Rule]", 
                  RowBox[{"OptionValue", "[", "\"\<LabelStyle\>\"", "]"}]}], 
                 ")"}], "&"}], "/@", " ", "bluevertices"}]}], "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"VertexSize", "->", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"NumberQ", "[", 
               RowBox[{"OptionValue", "[", "\"\<Size Scaling\>\"", "]"}], 
               "]"}], ",", 
              RowBox[{"Select", "[", 
               RowBox[{"vertexsizes", ",", 
                RowBox[{
                 RowBox[{"MemberQ", "[", 
                  RowBox[{"workingvertices", ",", " ", 
                   RowBox[{"First", "[", "#", "]"}]}], "]"}], "&"}]}], "]"}], 
              ",", "Automatic"}], "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"VertexStyle", "->", 
            RowBox[{"Join", "[", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"#", "->", " ", 
                  RowBox[{"Directive", "[", 
                   RowBox[{
                    RowBox[{"EdgeForm", "[", "None", "]"}], ",", "Blue", ",", 
                    
                    RowBox[{"Opacity", "[", 
                    RowBox[{
                    "OptionValue", "[", "\"\<Base Vertex Opacity\>\"", "]"}], 
                    "]"}]}], "]"}]}], ")"}], "&"}], "/@", "bluevertices"}], 
              ",", 
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"#", "->", " ", 
                  RowBox[{"Directive", "[", 
                   RowBox[{
                    RowBox[{"EdgeForm", "[", "None", "]"}], ",", 
                    RowBox[{
                    "OptionValue", "[", "\"\<HighlightColor\>\"", "]"}], ",", 
                    
                    RowBox[{"Opacity", "[", "0.5", "]"}]}], "]"}]}], ")"}], 
                "&"}], "/@", "yellowvertices"}]}], "]"}]}], " ", ",", 
           "\[IndentingNewLine]", 
           RowBox[{"VertexShapeFunction", "\[Rule]", 
            RowBox[{"Join", "[", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"#", "\[Rule]", "  ", 
                  RowBox[{
                  "OptionValue", "[", " ", "\"\<HighlightShape\>\"", "]"}]}], 
                 "&"}], "/@", "yellowvertices"}], ")"}], ",", " ", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"#", "\[Rule]", " ", "Automatic"}], "&"}], "/@", 
                "bluevertices"}], ")"}]}], "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"EdgeStyle", "->", "es"}], ",", "\[IndentingNewLine]", 
           RowBox[{"EdgeShapeFunction", "\[Rule]", "ef1"}]}], "]"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"PlotRange", "->", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{
               RowBox[{"centerpoint", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "+", 
               RowBox[{
                RowBox[{"OptionValue", "[", "\"\<Pan x\>\"", "]"}], 
                "\[Delta]x"}], "-", " ", 
               FractionBox["\[Delta]x", 
                RowBox[{"OptionValue", "[", "\"\<Zoom In\>\"", "]"}]]}], ",", 
              " ", 
              RowBox[{
               RowBox[{"centerpoint", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "+", 
               RowBox[{
                RowBox[{"OptionValue", "[", "\"\<Pan x\>\"", "]"}], 
                "\[Delta]x"}], "+", 
               FractionBox["\[Delta]x", 
                RowBox[{"OptionValue", "[", "\"\<Zoom In\>\"", "]"}]]}]}], 
             "}"}], ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{
               RowBox[{"centerpoint", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "+", 
               RowBox[{
                RowBox[{"OptionValue", "[", "\"\<Pan y\>\"", "]"}], 
                "\[Delta]y"}], "-", " ", 
               FractionBox["\[Delta]y", 
                RowBox[{"OptionValue", "[", "\"\<Zoom In\>\"", "]"}]]}], ",", 
              " ", 
              RowBox[{
               RowBox[{"centerpoint", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "+", 
               RowBox[{
                RowBox[{"OptionValue", "[", "\"\<Pan y\>\"", "]"}], 
                "\[Delta]y"}], "+", " ", 
               FractionBox["\[Delta]y", 
                RowBox[{"OptionValue", "[", "\"\<Zoom In\>\"", "]"}]]}]}], 
             "}"}]}], "}"}]}], " ", ",", " ", 
         RowBox[{"ImageSize", "->", " ", 
          RowBox[{"OptionValue", "[", "ImageSize", "]"}]}]}], "]"}], ",", 
       RowBox[{"First", "/@", 
        RowBox[{"Values", "[", "newvertexlabels", "]"}]}]}], 
      "\[IndentingNewLine]", "]"}]}]}], "]"}]}]}], "Input",
 CellChangeTimes->{{3.883201225917623*^9, 3.883201252950534*^9}, 
   3.883201312741091*^9, {3.883201353433324*^9, 3.883201356776845*^9}, {
   3.8832013868604097`*^9, 3.883201415990326*^9}, {3.88320144818403*^9, 
   3.88320154840558*^9}, {3.883201607596208*^9, 3.883201652551071*^9}, {
   3.883201735081502*^9, 3.883201760276821*^9}, {3.883201792247123*^9, 
   3.883201854214505*^9}, {3.883201903023486*^9, 3.883201948502438*^9}, {
   3.883201982379232*^9, 3.883202163799109*^9}, {3.88320221362753*^9, 
   3.883202249103838*^9}, {3.8832022871076307`*^9, 3.883202288909778*^9}, {
   3.8832023371793337`*^9, 3.883202340811707*^9}, {3.8832023743082457`*^9, 
   3.883202431693077*^9}, {3.883202468500141*^9, 3.88320266976005*^9}, {
   3.883202708257831*^9, 3.883202978973674*^9}, {3.883203054925151*^9, 
   3.8832031089850483`*^9}, {3.883203141792696*^9, 3.883203367773835*^9}, 
   3.8832034455933943`*^9, {3.8832035347446423`*^9, 3.88320357017616*^9}, {
   3.883203668084154*^9, 3.88320367245516*^9}, {3.883203846323085*^9, 
   3.883203983425969*^9}, {3.8832040438741007`*^9, 3.883204050312766*^9}, 
   3.883204088846979*^9, {3.883204159852405*^9, 3.8832042044107847`*^9}, 
   3.883204241687594*^9, {3.883204332773177*^9, 3.883204395146668*^9}, {
   3.8832044624210157`*^9, 3.883204474105771*^9}, {3.8832056240500298`*^9, 
   3.883205627334725*^9}, {3.8832059617569513`*^9, 3.883205962803083*^9}, 
   3.883206049712163*^9, {3.883207172073612*^9, 3.883207173828871*^9}, {
   3.8832072407561893`*^9, 3.8832072716757593`*^9}, 3.883207312580124*^9, {
   3.883207393058263*^9, 3.8832074009105*^9}, {3.88320744594241*^9, 
   3.8832074577279367`*^9}, {3.8832075672025557`*^9, 3.883207606940481*^9}, {
   3.883207810806254*^9, 3.883207873157489*^9}, {3.8832079255017023`*^9, 
   3.8832079636321774`*^9}, {3.8832082048300467`*^9, 
   3.8832082072434397`*^9}, {3.883210832870088*^9, 3.883210832950634*^9}, {
   3.883211060442213*^9, 3.883211109351589*^9}, {3.883211142542302*^9, 
   3.883211213519608*^9}, {3.883225110839889*^9, 3.883225140978795*^9}, {
   3.8832252389417953`*^9, 3.883225242574387*^9}, {3.883225298556458*^9, 
   3.883225301514381*^9}, {3.883225356806801*^9, 3.883225383761656*^9}, {
   3.883225555059163*^9, 3.883225557786159*^9}, {3.8832259080390863`*^9, 
   3.883225961714192*^9}, 3.883226035609137*^9, 3.883226088660104*^9, {
   3.883249065729739*^9, 3.883249070584437*^9}, {3.883249141509108*^9, 
   3.883249176458398*^9}, {3.8832504974169807`*^9, 3.8832505671774817`*^9}, {
   3.883250598586381*^9, 3.883250627329722*^9}, {3.883252553984827*^9, 
   3.883252557485589*^9}, {3.88325259242873*^9, 3.8832526018712177`*^9}, 
   3.883252948681991*^9, {3.883253005238302*^9, 3.883253012762748*^9}, {
   3.883253057183381*^9, 3.883253148300898*^9}, {3.883253554767707*^9, 
   3.883253564568516*^9}, {3.8832536251542997`*^9, 3.8832536779577093`*^9}, {
   3.883253709001761*^9, 3.883253719283688*^9}, {3.8832537841675873`*^9, 
   3.8832538190993757`*^9}, {3.883253862292984*^9, 3.883253862681231*^9}, {
   3.8832982338722153`*^9, 3.883298255934463*^9}, {3.883486871092332*^9, 
   3.883486955315319*^9}, {3.883487056777437*^9, 3.883487118068801*^9}, 
   3.883487386526026*^9, {3.88358582587306*^9, 3.8835858544839897`*^9}, {
   3.883585955069922*^9, 3.88358600908314*^9}, {3.884091957879158*^9, 
   3.8840919845850353`*^9}, {3.884191297066621*^9, 3.8841912975822783`*^9}, {
   3.8843696278787622`*^9, 3.884369628929069*^9}, {3.884373951661519*^9, 
   3.884373967691248*^9}, {3.8843741177576427`*^9, 3.884374207832416*^9}, {
   3.884374272457116*^9, 3.884374320009658*^9}, {3.884374354486763*^9, 
   3.884374360525839*^9}, {3.884374518123103*^9, 3.88437460541232*^9}, {
   3.884510878585099*^9, 3.884510978364189*^9}, {3.8845110123105793`*^9, 
   3.8845110526912947`*^9}, {3.884511100056781*^9, 3.884511150956419*^9}, {
   3.884511193016028*^9, 3.884511306877974*^9}, {3.8845113617457857`*^9, 
   3.8845113788186626`*^9}, {3.884511577328163*^9, 3.88451161449501*^9}, {
   3.884512029869356*^9, 3.884512073974478*^9}, {3.88451211166434*^9, 
   3.884512339190219*^9}, 3.8845124589048567`*^9, {3.884512602275798*^9, 
   3.884512691596212*^9}, {3.8845127589730377`*^9, 3.884512784882226*^9}, {
   3.884512855415984*^9, 3.884512868539662*^9}, 3.884513112123452*^9, {
   3.884513351022971*^9, 3.884513412295336*^9}, {3.884513455517275*^9, 
   3.88451353812702*^9}, {3.884513577137617*^9, 3.884513673180923*^9}, {
   3.884513720604013*^9, 3.884513721122381*^9}, {3.884513756358282*^9, 
   3.884513823031246*^9}, 3.8845138582302027`*^9, {3.8845139012699347`*^9, 
   3.8845141188987427`*^9}, {3.884514158466504*^9, 3.8845141752447243`*^9}, {
   3.884514232443974*^9, 3.8845142355297728`*^9}, {3.884515710411027*^9, 
   3.8845157258772917`*^9}, {3.884515807971828*^9, 3.884515811238446*^9}, {
   3.884515842407877*^9, 3.884515853563635*^9}, {3.884518090714587*^9, 
   3.884518193253139*^9}, {3.8845185004624023`*^9, 3.8845185642849092`*^9}, 
   3.884518627057234*^9, {3.885688894919783*^9, 3.8856889145478163`*^9}, {
   3.88574104581708*^9, 3.8857410573779383`*^9}, {3.8858223244108477`*^9, 
   3.885822406332685*^9}, {3.885823480225329*^9, 3.8858235395256433`*^9}, {
   3.891561314180398*^9, 3.8915613560821447`*^9}, {3.8915614187286053`*^9, 
   3.891561426910016*^9}, {3.8915615552607*^9, 3.8915615670628347`*^9}, {
   3.891561612969652*^9, 3.891561613615287*^9}, {3.891561656614521*^9, 
   3.891561713695139*^9}, {3.891561772479829*^9, 3.8915617767256517`*^9}, {
   3.891561831605916*^9, 3.891561877516205*^9}, {3.891562001318294*^9, 
   3.891562070419162*^9}, {3.891562101739182*^9, 3.891562260948347*^9}, {
   3.891562346840107*^9, 3.891562407138768*^9}, {3.891562621014106*^9, 
   3.89156271648724*^9}, {3.891562773195818*^9, 3.891562890801659*^9}, {
   3.891562941078557*^9, 3.891562977130533*^9}, {3.89156303919694*^9, 
   3.891563152424597*^9}, {3.8915967459625673`*^9, 3.8915967564235477`*^9}, {
   3.893527291822196*^9, 3.893527351533525*^9}},
 Background->RGBColor[1, 1, 0],
 CellLabel->
  "In[114]:=",ExpressionUUID->"8f596a03-aebb-44b1-9712-f741097d9f0a"]
}, Closed]],

Cell[CellGroupData[{

Cell["WeightedPlot2", "Subsubsection",
 CellChangeTimes->{{3.89591490532694*^9, 3.895914908232359*^9}, 
   3.8959240863582*^9},ExpressionUUID->"cf2b450e-d6ce-4e24-bcc9-120c44e0bf08"],

Cell["\<\
This is a version of NewPlotSingle that adjusts the spring weighting to take \
into account the strengths of the correlations.  The option \
\[OpenCurlyDoubleQuote]Exponent\[CloseCurlyDoubleQuote] adjusts the steepness \
of the relationship between the correlation strength and how much to increase \
the attraction between points.    Only the positive correlations are used in \
adjusting the springs.  \
\>", "Text",
 CellChangeTimes->{{3.895914911591362*^9, 3.895914918091613*^9}, {
  3.895914966518326*^9, 
  3.895915094324478*^9}},ExpressionUUID->"6baf322d-e151-4ff2-94fa-\
9f77703a524d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "WeightedPlot2", "]"}], " ", "=", " ", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"\"\<Exponent\>\"", "->", " ", "2"}], ",", " ", 
      RowBox[{"\"\<Show Graph\>\"", "->", " ", "True"}], ",", 
      RowBox[{"\"\<Highlight\>\"", "->", " ", 
       RowBox[{"{", "}"}]}], ",", " ", 
      RowBox[{"\"\<Layout\>\"", "->", " ", "\"\<SpringEmbedding\>\""}], ",", 
      " ", 
      RowBox[{"\"\<Size Scaling\>\"", "->", " ", "25"}], ",", " ", 
      RowBox[{"\"\<Automatic Partitioning\>\"", "->", " ", "True"}], ",", 
      RowBox[{"\"\<Vertex Labeling\>\"", "->", " ", "True"}], ",", " ", 
      RowBox[{"\"\<LabelStyle\>\"", "->", "Automatic"}], ",", 
      RowBox[{"\"\<HighlightLabelStyle\>\"", "->", 
       RowBox[{"Directive", "[", 
        RowBox[{"Blue", ",", " ", "Larger"}], "]"}]}], ",", " ", 
      RowBox[{"\"\<HighlightShape\>\"", "->", " ", "\"\<Square\>\""}], ",", 
      RowBox[{"\"\<HighlightColor\>\"", "->", " ", "Yellow"}], ",", " ", 
      RowBox[{"\"\<Base Vertex Opacity\>\"", "->", " ", "0.05"}], ",", 
      RowBox[{"\"\<Positive Only\>\"", "->", " ", "False"}], ",", 
      RowBox[{"\"\<GreenOpacity\>\"", "->", " ", "0.5"}], ",", " ", 
      RowBox[{"\"\<PinkOpacity\>\"", "->", "0.5"}], " ", ",", 
      RowBox[{"\"\<EdgeThickness\>\"", "->", " ", "0.003"}], ",", " ", 
      RowBox[{"ImageSize", "->", " ", "Automatic"}], ",", 
      RowBox[{"\"\<Zoom In\>\"", "->", " ", "1"}], ",", " ", 
      RowBox[{"\"\<Pan x\>\"", "->", " ", "0"}], ",", " ", 
      RowBox[{"\"\<Pan y\>\"", "->", " ", "0"}]}], "}"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"WeightedPlot2", "[", 
   RowBox[{
   "gNO_", ",", " ", "genes_", ",", "expressiondata_", ",", "cutoff_", ",", 
    " ", 
    RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"gno", "=", 
       RowBox[{"GeneSubsetGNO", "[", 
        RowBox[{"gNO", ",", " ", 
         RowBox[{"Flatten", "[", "genes", "]"}], ",", " ", 
         RowBox[{"\"\<Purge\>\"", "->", " ", "True"}]}], "]"}]}], ",", " ", 
      "fullmat", ",", "posns", ",", " ", "plot", ",", " ", "vertexcoords", 
      ",", " ", "allyellowvertices", ",", " ", "allvertexlabels", ",", " ", 
      "vertexsizes", ",", "workingmat", ",", "es", ",", " ", 
      "workingvertices", ",", " ", "yellowvertices", ",", "bluevertices", ",",
       " ", "newvertexcoords", ",", "newvertexlabels", ",", "datarange", ",", 
      "centerpoint", ",", "\[Delta]x", ",", "\[Delta]y", ",", " ", 
      "newallposns", ",", "newnegposns", ",", "  ", "greenedges", ",", " ", 
      "rededges", ",", "cp"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"fullmat", "=", 
      RowBox[{"gno", "[", 
       RowBox[{"[", "3", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"posns", " ", "=", " ", 
      RowBox[{"Sort", "[", 
       RowBox[{"Union", "[", 
        RowBox[{"Flatten", "[", 
         RowBox[{"fullmat", "[", "\"\<ExplicitPositions\>\"", "]"}], "]"}], 
        "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"plot", "=", 
      RowBox[{"UndirectedGraph", "[", 
       RowBox[{"AdjacencyGraph", "[", 
        RowBox[{"fullmat", ",", 
         RowBox[{"EdgeWeight", "->", " ", 
          RowBox[{"10", "^", 
           RowBox[{"-", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"OptionValue", "[", "\"\<Exponent\>\"", "]"}], "*", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"fullmat", "[", 
                  RowBox[{"[", 
                   RowBox[{"#1", ",", " ", "#2"}], "]"}], "]"}], "&"}], "@@@", 
                RowBox[{"fullmat", "[", "\"\<ExplicitPositions\>\"", "]"}]}], 
               ")"}]}], ")"}]}]}]}], ",", 
         RowBox[{"GraphLayout", "->", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"OptionValue", "[", "\"\<Layout\>\"", "]"}], ",", " ", 
            RowBox[{"\"\<EdgeWeighted\>\"", "\[Rule]", "True"}]}], "}"}]}]}], 
        "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"vertexcoords", " ", "=", " ", 
      RowBox[{"Thread", "[", 
       RowBox[{"posns", "->", " ", 
        RowBox[{
         RowBox[{"GraphEmbedding", "[", "plot", "]"}], "[", 
         RowBox[{"[", "posns", "]"}], "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"vertexsizes", "=", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"NumberQ", "[", 
         RowBox[{"OptionValue", "[", "\"\<Size Scaling\>\"", "]"}], "]"}], 
        ",", 
        RowBox[{"Thread", "[", 
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"Length", "[", 
            RowBox[{"gno", "[", 
             RowBox[{"[", "2", "]"}], "]"}], "]"}], " ", "]"}], "->", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"OptionValue", "[", "\"\<Size Scaling\>\"", "]"}], 
              SqrtBox[
               RowBox[{"expressiondata", "[", "#", "]"}]]}], "&"}], "/@", 
            RowBox[{"gno", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], ")"}]}], "]"}], ",", 
        RowBox[{"{", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"allyellowvertices", "=", " ", 
      RowBox[{"Flatten", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Position", "[", 
          RowBox[{
           RowBox[{"gno", "[", 
            RowBox[{"[", "2", "]"}], "]"}], ",", "#"}], "]"}], "&"}], "/@", 
        RowBox[{"OptionValue", "[", "\"\<Highlight\>\"", "]"}]}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"allvertexlabels", "=", 
      RowBox[{"Thread", "[", 
       RowBox[{
        RowBox[{"Range", "[", 
         RowBox[{"Length", "[", 
          RowBox[{"gno", "[", 
           RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], "->", "  ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"Placed", "[", 
            RowBox[{"#", ",", "Center"}], "]"}], "&"}], "/@", 
          RowBox[{"gno", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}], ")"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"OptionValue", "[", "\"\<Positive Only\>\"", "]"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"workingmat", " ", "=", "  ", 
         RowBox[{"SparseArray", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"BoolEval", "[", 
             RowBox[{"fullmat", ">", "cutoff"}], "]"}], "*", "fullmat"}], ",",
            " ", 
           RowBox[{"Dimensions", "[", "fullmat", "]"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"rededges", "=", 
         RowBox[{"{", "}"}]}], ";", 
        RowBox[{"greenedges", "=", 
         RowBox[{"EdgeList", "[", 
          RowBox[{"Graph", "[", 
           RowBox[{"workingmat", "[", "\"\<ExplicitPositions\>\"", "]"}], 
           "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"es", " ", "=", 
         RowBox[{"Directive", "[", 
          RowBox[{"{", 
           RowBox[{"Green", ",", " ", 
            RowBox[{"Opacity", "[", 
             RowBox[{"OptionValue", "[", "\"\<GreenOpacity\>\"", "]"}], "]"}],
             ",", " ", 
            RowBox[{"Thickness", "[", 
             RowBox[{"OptionValue", "[", "\"\<EdgeThickness\>\"", "]"}], 
             "]"}]}], "}"}], "]"}]}]}], " ", ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"workingmat", " ", "=", " ", 
         RowBox[{"SparseArray", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"BoolEval", "[", 
             RowBox[{
              RowBox[{"Abs", "[", "fullmat", "]"}], ">", "cutoff"}], "]"}], 
            "*", "fullmat"}], ",", " ", 
           RowBox[{"Dimensions", "[", "fullmat", "]"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"rededges", "=", 
         RowBox[{"EdgeList", "[", 
          RowBox[{"Graph", "[", 
           RowBox[{
            RowBox[{"SparseArray", "[", 
             RowBox[{"BoolEval", "[", 
              RowBox[{"workingmat", "<", "0"}], "]"}], "]"}], "[", 
            "\"\<ExplicitPositions\>\"", "]"}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"greenedges", "=", 
         RowBox[{"EdgeList", "[", 
          RowBox[{"Graph", "[", 
           RowBox[{
            RowBox[{"SparseArray", "[", 
             RowBox[{"BoolEval", "[", 
              RowBox[{"workingmat", ">", "0"}], "]"}], "]"}], "[", 
            "\"\<ExplicitPositions\>\"", "]"}], "]"}], "]"}]}], ";", " ", 
        "\[IndentingNewLine]", 
        RowBox[{"es", " ", "=", " ", 
         RowBox[{"Join", "[", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{"#", "->", " ", 
               RowBox[{"Directive", "[", 
                RowBox[{"{", 
                 RowBox[{"Green", ",", " ", 
                  RowBox[{"Opacity", "[", 
                   RowBox[{"OptionValue", "[", "\"\<GreenOpacity\>\"", "]"}], 
                   "]"}], ",", " ", 
                  RowBox[{"Thickness", "[", 
                   RowBox[{"OptionValue", "[", "\"\<EdgeThickness\>\"", "]"}],
                    "]"}]}], "}"}], "]"}]}], "&"}], "/@", "greenedges"}], 
            ")"}], ",", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{"#", "->", " ", 
               RowBox[{"Directive", "[", 
                RowBox[{"{", 
                 RowBox[{"Pink", ",", " ", 
                  RowBox[{"Opacity", "[", 
                   RowBox[{"OptionValue", "[", "\"\<PinkOpacity\>\"", "]"}], 
                   "]"}], ",", " ", 
                  RowBox[{"Thickness", "[", 
                   RowBox[{"OptionValue", "[", "\"\<EdgeThickness\>\"", "]"}],
                    "]"}]}], "}"}], "]"}]}], "&"}], "/@", "rededges"}], 
            ")"}]}], "]"}]}]}]}], " ", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"workingvertices", "=", 
      RowBox[{"Sort", "[", 
       RowBox[{"Union", "[", 
        RowBox[{"Flatten", "[", 
         RowBox[{"workingmat", "[", "\"\<ExplicitPositions\>\"", "]"}], "]"}],
         "]"}], "]"}]}], ";", "\[IndentingNewLine]", "\t", 
     RowBox[{"yellowvertices", "=", 
      RowBox[{"Intersection", "[", 
       RowBox[{"workingvertices", ",", " ", "allyellowvertices"}], "]"}]}], 
     ";", "\[IndentingNewLine]", "\t", 
     RowBox[{"bluevertices", "=", " ", 
      RowBox[{"Complement", "[", 
       RowBox[{"workingvertices", ",", " ", "yellowvertices"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"newvertexcoords", " ", "=", " ", 
      RowBox[{"Select", "[", 
       RowBox[{"vertexcoords", ",", " ", 
        RowBox[{
         RowBox[{"MemberQ", "[", 
          RowBox[{"workingvertices", ",", " ", 
           RowBox[{"First", "[", "#", "]"}]}], "]"}], "&"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"newvertexlabels", "=", 
      RowBox[{"Select", "[", 
       RowBox[{"allvertexlabels", ",", " ", 
        RowBox[{
         RowBox[{"MemberQ", "[", 
          RowBox[{"workingvertices", ",", " ", 
           RowBox[{"First", "[", "#", "]"}]}], "]"}], "&"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"datarange", "=", 
      RowBox[{"MinMax", "/@", 
       RowBox[{"Transpose", "[", 
        RowBox[{"Values", "[", "vertexcoords", "]"}], "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"centerpoint", "=", 
      RowBox[{"Mean", "/@", "datarange"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"\[Delta]x", ",", "\[Delta]y"}], "}"}], "=", 
      RowBox[{
       RowBox[{"Last", "/@", "datarange"}], " ", "-", " ", "centerpoint"}]}], 
     ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"OptionValue", "[", "\"\<Show Graph\>\"", "]"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Print", "[", 
         RowBox[{"First", "/@", 
          RowBox[{"Values", "[", "newvertexlabels", "]"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"GraphPlot", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Graph", "[", 
           RowBox[{
            RowBox[{"workingmat", "[", "\"\<ExplicitPositions\>\"", "]"}], 
            ",", "\[IndentingNewLine]", 
            RowBox[{"VertexCoordinates", "->", "newvertexcoords"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"VertexLabels", "->", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"OptionValue", "[", "\"\<Vertex Labeling\>\"", "]"}], 
               ",", " ", "newvertexlabels", ",", "None"}], "]"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"VertexLabelStyle", "\[Rule]", " ", 
             RowBox[{"Join", "[", " ", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"#", "\[Rule]", 
                   RowBox[{
                   "OptionValue", "[", "\"\<HighlightLabelStyle\>\"", "]"}]}],
                   ")"}], "&"}], "/@", "yellowvertices"}], ",", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"#", "\[Rule]", 
                   RowBox[{"OptionValue", "[", "\"\<LabelStyle\>\"", "]"}]}], 
                  ")"}], "&"}], "/@", " ", "bluevertices"}]}], "]"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"VertexSize", "->", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"NumberQ", "[", 
                RowBox[{"OptionValue", "[", "\"\<Size Scaling\>\"", "]"}], 
                "]"}], ",", 
               RowBox[{"Select", "[", 
                RowBox[{"vertexsizes", ",", 
                 RowBox[{
                  RowBox[{"MemberQ", "[", 
                   RowBox[{"workingvertices", ",", " ", 
                    RowBox[{"First", "[", "#", "]"}]}], "]"}], "&"}]}], "]"}],
                ",", "Automatic"}], "]"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"VertexStyle", "->", 
             RowBox[{"Join", "[", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"#", "->", " ", 
                   RowBox[{"Directive", "[", 
                    RowBox[{
                    RowBox[{"EdgeForm", "[", "None", "]"}], ",", "Blue", ",", 
                    
                    RowBox[{"Opacity", "[", 
                    RowBox[{
                    "OptionValue", "[", "\"\<Base Vertex Opacity\>\"", "]"}], 
                    "]"}]}], "]"}]}], ")"}], "&"}], "/@", "bluevertices"}], 
               ",", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"#", "->", " ", 
                   RowBox[{"Directive", "[", 
                    RowBox[{
                    RowBox[{"EdgeForm", "[", "None", "]"}], ",", 
                    RowBox[{
                    "OptionValue", "[", "\"\<HighlightColor\>\"", "]"}], ",", 
                    
                    RowBox[{"Opacity", "[", "0.5", "]"}]}], "]"}]}], ")"}], 
                 "&"}], "/@", "yellowvertices"}]}], "]"}]}], " ", ",", 
            "\[IndentingNewLine]", 
            RowBox[{"VertexShapeFunction", "\[Rule]", 
             RowBox[{"Join", "[", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{"#", "\[Rule]", "  ", 
                   RowBox[{
                   "OptionValue", "[", " ", "\"\<HighlightShape\>\"", "]"}]}],
                   "&"}], "/@", "yellowvertices"}], ")"}], ",", " ", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{"#", "\[Rule]", " ", "Automatic"}], "&"}], "/@", 
                 "bluevertices"}], ")"}]}], "]"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"EdgeStyle", "->", "es"}], ",", "\[IndentingNewLine]", 
            RowBox[{"EdgeShapeFunction", "\[Rule]", "ef1"}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"PlotRange", "->", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{"centerpoint", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "+", 
                RowBox[{
                 RowBox[{"OptionValue", "[", "\"\<Pan x\>\"", "]"}], 
                 "\[Delta]x"}], "-", " ", 
                FractionBox["\[Delta]x", 
                 RowBox[{"OptionValue", "[", "\"\<Zoom In\>\"", "]"}]]}], ",",
                " ", 
               RowBox[{
                RowBox[{"centerpoint", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "+", 
                RowBox[{
                 RowBox[{"OptionValue", "[", "\"\<Pan x\>\"", "]"}], 
                 "\[Delta]x"}], "+", 
                FractionBox["\[Delta]x", 
                 RowBox[{"OptionValue", "[", "\"\<Zoom In\>\"", "]"}]]}]}], 
              "}"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{"centerpoint", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], "+", 
                RowBox[{
                 RowBox[{"OptionValue", "[", "\"\<Pan y\>\"", "]"}], 
                 "\[Delta]y"}], "-", " ", 
                FractionBox["\[Delta]y", 
                 RowBox[{"OptionValue", "[", "\"\<Zoom In\>\"", "]"}]]}], ",",
                " ", 
               RowBox[{
                RowBox[{"centerpoint", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], "+", 
                RowBox[{
                 RowBox[{"OptionValue", "[", "\"\<Pan y\>\"", "]"}], 
                 "\[Delta]y"}], "+", " ", 
                FractionBox["\[Delta]y", 
                 RowBox[{"OptionValue", "[", "\"\<Zoom In\>\"", "]"}]]}]}], 
              "}"}]}], "}"}]}], " ", ",", " ", 
          RowBox[{"ImageSize", "->", " ", 
           RowBox[{"OptionValue", "[", "ImageSize", "]"}]}]}], "]"}]}], ",", 
       RowBox[{"First", "/@", 
        RowBox[{"Values", "[", "newvertexlabels", "]"}]}]}], 
      "\[IndentingNewLine]", "]"}]}]}], 
   "]"}]}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.894203790947541*^9, 3.89420384523131*^9}, {
   3.8942054992336893`*^9, 3.894205612592044*^9}, {3.894206191221455*^9, 
   3.8942062046165733`*^9}, {3.8959148346057463`*^9, 3.895914844326357*^9}, 
   3.895916091130837*^9, {3.895918267520767*^9, 3.8959182872605047`*^9}, {
   3.8959240930848713`*^9, 3.895924105072996*^9}, {3.895924182279787*^9, 
   3.89592425364141*^9}},
 Background->RGBColor[1, 1, 0],
 CellLabel->
  "In[127]:=",ExpressionUUID->"4a2be414-73c0-485c-bd74-bd01588797c6"]
}, Closed]],

Cell[CellGroupData[{

Cell["RetrieveGenePairs", "Subsubsection",
 CellChangeTimes->{{3.8779487346006317`*^9, 
  3.877948742236352*^9}},ExpressionUUID->"9f8374b2-4e30-4f0e-b3c3-\
a2077a78a026"],

Cell["\<\
This code takes a gNO and a list of genes, and returns the names of the \
pair-wise connections between those genes that were identified in the gNO, as \
a list of pairs of gene names.  It only returns genes that are given to it as \
input, i.e. it doesn\[CloseCurlyQuote]t tell you other genes linked to the \
ones you put it.   It can pull both positive and negative connections, but \
the default setting is to pull only positive ones.  
Note that the code sorts each pair alphanumerically.  \
\>", "Text",
 CellChangeTimes->{{3.877948758915432*^9, 3.8779488170422087`*^9}, {
  3.884718112612488*^9, 3.884718112952507*^9}, {3.884718242675969*^9, 
  3.8847182566022863`*^9}, {3.884733954304563*^9, 3.884733967849009*^9}, {
  3.905162315847067*^9, 3.905162336657888*^9}, {3.906463643204399*^9, 
  3.906463647253478*^9}},ExpressionUUID->"1610d95c-bde0-426a-b979-\
c83b0c9429d7"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "RetrieveGenePairs", "]"}], "=", " ", 
   RowBox[{"{", 
    RowBox[{"\"\<Positive Only\>\"", "->", " ", "True"}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"RetrieveGenePairs", "[", 
   RowBox[{"gNO_", ",", " ", "genes_", ",", " ", 
    RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"subgno", " ", "=", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"OptionValue", "[", "\"\<Positive Only\>\"", "]"}], ",", 
        RowBox[{"GeneSubsetGNO", "[", 
         RowBox[{
          RowBox[{"TruncateGNO", "[", 
           RowBox[{"gNO", ",", " ", "0", ",", " ", 
            RowBox[{"\"\<Positive Only\>\"", "->", " ", "True"}]}], "]"}], 
          ",", " ", "genes"}], "]"}], ",", 
        RowBox[{"GeneSubsetGNO", "[", 
         RowBox[{"gNO", ",", " ", "genes"}], "]"}]}], "]"}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Sort", "/@", 
     RowBox[{"Evaluate", "[", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"subgno", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "[", "\"\<ExplicitPositions\>\"", 
         "]"}], ")"}], "/.", 
       RowBox[{"Dispatch", "[", 
        RowBox[{"Thread", "[", 
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"Length", "[", 
            RowBox[{"subgno", "[", 
             RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], "->", " ", 
          RowBox[{"subgno", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}]}], "]"}]}]}], 
   "]"}]}]}], "Input",
 CellChangeTimes->{{3.877948363123439*^9, 3.87794845996126*^9}, {
   3.884718117331985*^9, 3.884718231314208*^9}, 3.8847182708794737`*^9, {
   3.884733940737355*^9, 3.88473394872119*^9}, {3.884735794564743*^9, 
   3.884735799434568*^9}, {3.884735874383819*^9, 3.884735905224135*^9}, {
   3.8847359665886383`*^9, 3.884736180346134*^9}, {3.88473623238587*^9, 
   3.884736238654624*^9}, {3.88473630038372*^9, 3.8847363324167*^9}, {
   3.884736384667585*^9, 3.884736456201901*^9}, {3.884736546915268*^9, 
   3.884736549526698*^9}, {3.884736873804493*^9, 3.884736891392128*^9}, {
   3.884736936615636*^9, 3.884736989079615*^9}, {3.904155974098366*^9, 
   3.9041559786383533`*^9}},
 Background->RGBColor[1, 1, 0],
 CellLabel->
  "In[190]:=",ExpressionUUID->"fd5521d6-659f-4e0d-8cc7-4e50d99d3b31"]
}, Closed]]
}, Open  ]]
},
WindowSize->{1279, 773},
WindowMargins->{{Automatic, 126}, {Automatic, 0}},
FrontEndVersion->"13.1 for Mac OS X ARM (64-bit) (June 16, 2022)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"2ab86330-7ed8-4d72-ba11-bf953d03ebfc"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 189, 3, 69, "Chapter",ExpressionUUID->"3db8fb27-6483-45ce-b776-4108798d1d96"],
Cell[772, 27, 218, 5, 35, "Text",ExpressionUUID->"8597c54a-d859-45eb-8fc6-6365814bcf39"],
Cell[CellGroupData[{
Cell[1015, 36, 154, 3, 45, "Subsubsection",ExpressionUUID->"8259914b-1619-4383-8239-58ce18800b79"],
Cell[1172, 41, 716, 13, 127, "Text",ExpressionUUID->"61c0a899-33a8-49d4-984c-3bd5c96c6cd8"],
Cell[1891, 56, 731, 12, 81, "Text",ExpressionUUID->"d557a322-b90b-4996-89b4-c79b8e514d3b"],
Cell[2625, 70, 1192, 18, 150, "Text",ExpressionUUID->"b0646bd8-5341-4d97-9b91-f5f79e1ff602"],
Cell[3820, 90, 367, 9, 35, "Text",ExpressionUUID->"b7c53e66-5489-48ba-87d6-22dab4f0af40"],
Cell[4190, 101, 700, 18, 46, "Input",ExpressionUUID->"e6b3d604-e802-477c-a5f0-c6b1606aa65d"],
Cell[4893, 121, 965, 20, 104, "Text",ExpressionUUID->"f85bdcaa-3f73-44e6-9374-4e123cbc563f"],
Cell[5861, 143, 1860, 45, 89, "Input",ExpressionUUID->"2c019a5a-86fb-45dc-ac5b-ec1a728bf5c0"],
Cell[7724, 190, 1196, 34, 89, "Input",ExpressionUUID->"df8a50c7-64b9-48fd-a16b-5b7fbc6c7f29"],
Cell[8923, 226, 542, 13, 46, "Input",ExpressionUUID->"1b1752e8-e497-4618-b9fb-a41b74338f14"],
Cell[9468, 241, 662, 17, 68, "Input",ExpressionUUID->"4112b786-e39a-46cd-806c-659898b40afd"],
Cell[10133, 260, 607, 17, 68, "Input",ExpressionUUID->"faf673a4-376d-4c50-ad3a-e8da33c8959c"],
Cell[10743, 279, 512, 13, 68, "Input",ExpressionUUID->"8ffc0d73-4d93-4d64-8ae2-2c8819d3e59f"],
Cell[11258, 294, 1863, 30, 242, "Text",ExpressionUUID->"7f3173cc-b36f-4f6f-a9ed-021b6005752d"],
Cell[13124, 326, 8444, 188, 572, "Input",ExpressionUUID->"e37c3025-4ef0-45de-bb1e-a548db2eca4b"],
Cell[21571, 516, 8427, 188, 572, "Input",ExpressionUUID->"0d4eef79-aa67-4ef2-a4bd-a20b6a102801"]
}, Closed]],
Cell[CellGroupData[{
Cell[30035, 709, 177, 3, 37, "Subsubsection",ExpressionUUID->"8ab7d9f5-ac1e-4ee7-ba79-7967dcd65e28"],
Cell[30215, 714, 1965, 30, 242, "Text",ExpressionUUID->"e4b91d1a-40b4-43f3-beb0-47b8f68bb2cf"],
Cell[32183, 746, 30042, 680, 1286, "Input",ExpressionUUID->"6b01a9a2-5756-485a-832e-1755ef844e5a"]
}, Closed]],
Cell[CellGroupData[{
Cell[62262, 1431, 174, 3, 37, "Subsubsection",ExpressionUUID->"514a1ec5-a59e-43ca-b0aa-4071fb8dff6b"],
Cell[62439, 1436, 1001, 16, 104, "Text",ExpressionUUID->"3bb22392-91b9-4eed-9bfb-817ef3a228cd"],
Cell[63443, 1454, 2147, 57, 169, "Input",ExpressionUUID->"d050fbbc-79e9-412c-b656-e7f529dd8238"]
}, Closed]],
Cell[CellGroupData[{
Cell[65627, 1516, 157, 3, 37, "Subsubsection",ExpressionUUID->"3ffc28a5-ff89-4ba7-8b8e-9f4c7665ddb8"],
Cell[65787, 1521, 2610, 45, 426, "Text",ExpressionUUID->"01ffef5a-d68a-4b41-bb41-4d3a199611e3"],
Cell[68400, 1568, 44573, 983, 2483, "Input",ExpressionUUID->"c3468fe6-c60c-4841-8a4a-7c98cf15a8e9"]
}, Closed]],
Cell[CellGroupData[{
Cell[113010, 2556, 164, 3, 37, "Subsubsection",ExpressionUUID->"659368af-ce92-4dca-ba1b-8d5782bc9930"],
Cell[113177, 2561, 511, 9, 58, "Text",ExpressionUUID->"dbc55a1b-38a8-492c-b576-f40b166283f1"],
Cell[113691, 2572, 46102, 992, 2794, "Input",ExpressionUUID->"65aa8ff4-495a-4fb0-828f-8932a24fc6ea"]
}, Closed]],
Cell[CellGroupData[{
Cell[159830, 3569, 215, 4, 37, "Subsubsection",ExpressionUUID->"880e16f2-797b-4218-8188-e321db80382d"],
Cell[160048, 3575, 847, 15, 127, "Text",ExpressionUUID->"2cc3286a-9f91-4b9a-be0b-3080e716c0d4"],
Cell[160898, 3592, 47519, 1044, 2933, "Input",ExpressionUUID->"8f596a03-aebb-44b1-9712-f741097d9f0a"]
}, Closed]],
Cell[CellGroupData[{
Cell[208454, 4641, 182, 2, 37, "Subsubsection",ExpressionUUID->"cf2b450e-d6ce-4e24-bcc9-120c44e0bf08"],
Cell[208639, 4645, 603, 11, 58, "Text",ExpressionUUID->"6baf322d-e151-4ff2-94fa-9f77703a524d"],
Cell[209245, 4658, 18884, 435, 1298, "Input",ExpressionUUID->"4a2be414-73c0-485c-bd74-bd01588797c6"]
}, Closed]],
Cell[CellGroupData[{
Cell[228166, 5098, 170, 3, 37, "Subsubsection",ExpressionUUID->"9f8374b2-4e30-4f0e-b3c3-a2077a78a026"],
Cell[228339, 5103, 888, 14, 104, "Text",ExpressionUUID->"1610d95c-bde0-426a-b979-c83b0c9429d7"],
Cell[229230, 5119, 2419, 57, 110, "Input",ExpressionUUID->"fd5521d6-659f-4e0d-8cc7-4e50d99d3b31"]
}, Closed]]
}, Open  ]]
}
]
*)

